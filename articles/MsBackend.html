<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Spectra">
<title>Creating new `MsBackend` classes • Spectra</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating new `MsBackend` classes">
<meta property="og:description" content="Spectra">
<meta property="og:image" content="https://rformassspectrometry.github.io/Spectra/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Spectra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.11.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/Spectra.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/MsBackend.html">Creating new `MsBackend` classes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/Spectra/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Creating new `MsBackend` classes</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/Spectra/blob/HEAD/vignettes/MsBackend.Rmd" class="external-link"><code>vignettes/MsBackend.Rmd</code></a></small>
      <div class="d-none name"><code>MsBackend.Rmd</code></div>
    </div>

    
    
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><p><strong>Package</strong>: <em><a href="https://bioconductor.org/packages/3.18/Spectra" class="external-link">Spectra</a></em><br><strong>Authors</strong>: RforMassSpectrometry Package Maintainer [cre],
Laurent Gatto [aut] (<a href="https://orcid.org/0000-0002-1520-2268" class="external-link uri">https://orcid.org/0000-0002-1520-2268</a>), Johannes Rainer
[aut] (<a href="https://orcid.org/0000-0002-6977-7147" class="external-link uri">https://orcid.org/0000-0002-6977-7147</a>), Sebastian Gibb
[aut] (<a href="https://orcid.org/0000-0001-7406-4443" class="external-link uri">https://orcid.org/0000-0001-7406-4443</a>), Jan Stanstrup
[ctb] (<a href="https://orcid.org/0000-0003-0541-7369" class="external-link uri">https://orcid.org/0000-0003-0541-7369</a>), Nir Shahaf
[ctb]<br><strong>Last modified:</strong> 2023-08-10
07:25:31.896843<br><strong>Compiled</strong>: Thu Aug 10 07:42:22
2023</p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette briefly describes the <code>MsBackend</code> class
which is used by the <code>Spectra</code> package to <em>represent</em>
and provide Mass Spectrometry (MS) data and illustrates how a new such
<em>backend</em> class can be created and tested for validity.</p>
<p>Contributions to this vignette (content or correction of typos) or
requests for additional details and information are highly welcome
(ideally <em>via</em> pull requests or github issues).</p>
</div>
<div class="section level2">
<h2 id="what-is-a-msbackend">What is a <code>MsBackend</code>?<a class="anchor" aria-label="anchor" href="#what-is-a-msbackend"></a>
</h2>
<p>The <code>Spectra</code> package separates the code for the analysis
of MS data from the code needed to import, represent and provide the
data. The former is implemented for the <code>Spectra</code> class which
is the main object users will use for their analyses. The
<code>Spectra</code> object relies on a so-called <em>backend</em> to
provide the MS data. The <code>MsBackend</code> virtual class defines
the API that new <em>backend</em> classes need to implement in order to
be used with the <code>Spectra</code> object. Each <code>Spectra</code>
object contains an implementation of such a <code>MsBackend</code>
within its <code>@backend</code> slot which provides the MS data to the
<code>Spectra</code> object. All data management is thus hidden from the
user. In addition this separation allows to define new, alternative,
data representations and integrate them seamlessly into a
<code>Spectra</code>-based data analysis workflow.</p>
<p>This concept is an extension of the of <em>in-memory</em> and
<em>on-disk</em> data representations from the <em><a href="https://bioconductor.org/packages/3.18/MSnbase" class="external-link">MSnbase</a></em>
package <span class="citation">(Gatto, Gibb, and Rainer
2020)</span>.</p>
<div class="section level3">
<h3 id="conventions-and-definitions">Conventions and definitions<a class="anchor" aria-label="anchor" href="#conventions-and-definitions"></a>
</h3>
<p>General conventions for MS data of a <code>Spectra</code> are:</p>
<ul>
<li>One <code>Spectra</code> object is supposed to contain MS (spectral)
data of multiple MS spectra.</li>
<li>m/z values within each spectrum are expected to be sorted
increasingly.</li>
<li>Missing values (<code>NA</code>) for m/z values are not
supported.</li>
<li>Properties of a spectrum are called <em>spectra variables</em>.
While backends can define their own properties, a minimum required set
of spectra variables <strong>must</strong> be provided by each backend
(even if their values are empty). These <em>core spectra variables</em>
are listed (along with their expected data type) by the
<code><a href="../reference/Spectra.html">coreSpectraVariables()</a></code> function.</li>
<li>
<code>dataStorage</code> and <code>dataOrigin</code> are two special
spectra variables that define for each spectrum where the data is stored
and from where the data derived (or was loaded, such as the data
origin). Both are expected to be of type<code>character</code> and need
to be defined by the backend (i.e., they can not be empty or
missing).</li>
<li>
<code>MsBackend</code> implementations can also represent purely
<em>read-only</em> data resources. In this case only data accessor
methods need to be implemented but not data replacement methods. Whether
a backend is read-only can be set with the <code>@readonly</code> slot
of the virtual <code>MsBackend</code> class (the <code>isReadOnly</code>
function can be used to retrieve the value for this slot). The default
is <code>@readonly = FALSE</code> and thus all data replacement method
listed in section <em>Data replacement methods</em> have to be
implemented. For read-only backends (<code>@readonly = TRUE</code>) only
the methods in section <em>Required methods</em> need to be implemented.
Backends can also be <em>partially</em> read-only, such as the
<code>MsBackendMzR</code>. This backend allows for example to change
spectra variables, but not the peaks data (i.e. the m/z and intensity
values). Also, backends for purely read-only resources could extend the
<code>MsBackendCached</code> from the <em><a href="https://bioconductor.org/packages/3.18/Spectra" class="external-link">Spectra</a></em>
package to enable support for modifying (or adding) spectra variables.
Any changes to spectra variables will be internally cached by the
<code>MsBackendCached</code> without the need of them being propagating
to the underlying data resource (see for example the
<code>MsBackendMassbankSql</code> from the <em><a href="https://bioconductor.org/packages/3.18/MsBackendMassbank" class="external-link">MsBackendMassbank</a></em>
package).</li>
</ul>
</div>
<div class="section level3">
<h3 id="notes-on-parallel-processing">Notes on parallel processing<a class="anchor" aria-label="anchor" href="#notes-on-parallel-processing"></a>
</h3>
<p>The default parallel processing of <code>Spectra</code> splits
backends by their <code>dataStorage</code> and performs the processing
in parallel on the subsets. Not all backends will support such parallel
processing (or any parallel processing) and thus unexpected errors might
occur (depending on the user’s settings). A new function allowing to
evaluate the parallel processing capabilities of a backend will be added
to help avoiding such issues.</p>
</div>
</div>
<div class="section level2">
<h2 id="api">API<a class="anchor" aria-label="anchor" href="#api"></a>
</h2>
<p>The <code>MsBackend</code> class defines core methods that have to be
implemented by a MS <em>backend</em> as well as <em>optional</em>
methods with default implementations that might be implemented for a new
backend but don’t necessarily have to. These functions are described in
sections <em>Required methods</em> and <em>Optional methods</em>,
respectively.</p>
<p>To create a new backend a class extending the virtual
<code>MsBackend</code> needs to be implemented. In the example below we
create thus a simple class with a <code>data.frame</code> to contain
general spectral properties (<em>spectra variables</em>) and two slots
for m/z and intensity values. These are stored as
<code>NumericList</code> objects since both m/z and intensity values are
expected to be of type <code>numeric</code> and to allow to store data
from multiple spectra into a single backend object. We also define a
simple constructor function that returns an empty instance of our new
class.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/Spectra" class="external-link">Spectra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/IRanges" class="external-link">IRanges</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/methods/setClass.html" class="external-link">setClass</a></span><span class="op">(</span><span class="st">"MsBackendTest"</span>,</span>
<span>         contains <span class="op">=</span> <span class="st">"MsBackend"</span>,</span>
<span>         slots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>             spectraVars <span class="op">=</span> <span class="st">"data.frame"</span>,</span>
<span>             mz <span class="op">=</span> <span class="st">"NumericList"</span>,</span>
<span>             intensity <span class="op">=</span> <span class="st">"NumericList"</span></span>
<span>         <span class="op">)</span>,</span>
<span>         prototype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/methods/representation.html" class="external-link">prototype</a></span><span class="op">(</span></span>
<span>             spectraVars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>             mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span>compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>             intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span>compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>         <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">MsBackendTest</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"MsBackendTest"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The 3 slots <code>spectraVars</code>, <code>mz</code> and
<code>intensity</code> will be used to store our MS data, each row in
<code>spectraVars</code> being data for one spectrum with the columns
being the different <em>spectra variables</em> (i.e. additional
properties of a spectrum such as its retention time or MS level) and
each element in <code>mz</code> and <code>intensity</code> being a
<code>numeric</code> with the m/z and intensity values of the respective
spectrum.</p>
<p>We should ideally also add some basic validity function that ensures
the data to be OK. The function below simply checks that the number of
rows of the <code>spectraVars</code> slot matches the length of the
<code>mz</code> and <code>intensity</code> slot.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/validObject.html" class="external-link">setValidity</a></span><span class="op">(</span><span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">mz</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">intensity</span><span class="op">)</span> <span class="op">||</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">mz</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">spectraVars</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"length of 'mz' and 'intensity' has to match the number of "</span>,</span>
<span>               <span class="st">"rows of 'spectraVars'"</span><span class="op">)</span></span>
<span>    <span class="cn">NULL</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Class "MsBackendTest" [in ".GlobalEnv"]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slots:</span></span>
<span><span class="co">##                                                                   </span></span>
<span><span class="co">## Name:  spectraVars          mz   intensity    readonly     version</span></span>
<span><span class="co">## Class:  data.frame NumericList NumericList     logical   character</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Extends: "MsBackend"</span></span></code></pre>
<p>We can now create an instance of our new class with the
<code>MsBackendTest</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">MsBackendTest</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class "MsBackendTest"</span></span>
<span><span class="co">## Slot "spectraVars":</span></span>
<span><span class="co">## data frame with 0 columns and 0 rows</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "mz":</span></span>
<span><span class="co">## NumericList of length 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "intensity":</span></span>
<span><span class="co">## NumericList of length 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "readonly":</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "version":</span></span>
<span><span class="co">## [1] "0.1"</span></span></code></pre>
<p>Note that a <em>backend</em> class does not necessarily need to
contain all the data like the one from our example. Backends such as the
<code>MsBackendMzR</code> for example retrieve the data on the fly from
the raw MS data files or the <code>MsBackendSql</code> from the <em><a href="https://bioconductor.org/packages/3.18/MsBackendSql" class="external-link">MsBackendSql</a></em>
a SQL database.</p>
<div class="section level3">
<h3 id="required-methods">Required methods<a class="anchor" aria-label="anchor" href="#required-methods"></a>
</h3>
<p>Methods listed in this section must be implemented for a new class
extending <code>MsBackend</code>. Methods should ideally also
implemented in the order they are listed here. Also, it is strongly
advised to write dedicated unit tests for each newly implemented method
or function already <strong>during</strong> the development.</p>
<div class="section level4">
<h4 id="datastorage">
<code>dataStorage</code><a class="anchor" aria-label="anchor" href="#datastorage"></a>
</h4>
<p>The <code>dataStorage</code> spectra variable of a spectrum provides
some information how or where the data is stored. The
<code>dataStorage</code> method should therefor return a
<code>character</code> vector with length equal to the number of spectra
of a backend object with that information. For most backends the data
storage information can be a simple string such as <code>"memory"</code>
or <code>"database"</code> to specify that the data of a spectrum is
stored within the object itself or in a database, respectively.</p>
<p>Backend classes that keep only a subset of the MS data in memory and
need to load data from data files upon request will use this spectra
variable to store and keep track of the original data file for each
spectrum. An example is the <code>MsBackendMzR</code> backend that
retrieves the MS data on-the-fly from the original data file(s) whenever
m/z or intensity values are requested from the backend. Calling
<code>dataStorage</code> on an <code>MsBackendMzR</code> returns thus
the names from the originating files.</p>
<p>For our example backend we define a simple <code>dataStorage</code>
method that simply returns the column <code>"dataStorage"</code> from
the <code>@svars</code> (as a <code>character</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"dataStorage"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">spectraVars</span><span class="op">$</span><span class="va">dataStorage</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="length">
<code>length</code><a class="anchor" aria-label="anchor" href="#length"></a>
</h4>
<p><code>length</code> is expected to return a single
<code>integer</code> with the total number of spectra that are available
through the backend class. For our example backend we simply return the
number of rows of the <code>data.frame</code> stored in the
<code>@spectraVars</code> slot.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"length"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">@</span><span class="va">spectraVars</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="backendinitialize">
<code>backendInitialize</code><a class="anchor" aria-label="anchor" href="#backendinitialize"></a>
</h4>
<p>The <code>backendInitialize</code> method is expected to be called
after creating an instance of the backend class and should prepare
(initialize) the backend which in most cases means that MS data is
loaded. This method can take any parameters needed by the backend to get
loaded/initialized with data (which can be file names from which to load
the data, a database connection or object(s) containing the data).
During <code>backendInitialize</code> usually also the special spectra
variables <code>dataStorage</code> and <code>dataOrigin</code> are
set.</p>
<p>Below we define a <code>backendInitialize</code> method that takes as
arguments a <code>data.frame</code> with spectra variables and two
<code>list</code>s with the m/z and intensity values for each
spectrum.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span></span>
<span>    <span class="st">"backendInitialize"</span>, <span class="st">"MsBackendTest"</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">svars</span>, <span class="va">mz</span>, <span class="va">intensity</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">svars</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'svars' needs to be a 'data.frame' with spectra variables"</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">svars</span><span class="op">$</span><span class="va">dataStorage</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">svars</span><span class="op">$</span><span class="va">dataStorage</span> <span class="op">&lt;-</span> <span class="st">"&lt;memory&gt;"</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">svars</span><span class="op">$</span><span class="va">dataOrigin</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">svars</span><span class="op">$</span><span class="va">dataOrigin</span> <span class="op">&lt;-</span> <span class="st">"&lt;user provided&gt;"</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">spectraVars</span> <span class="op">&lt;-</span> <span class="va">svars</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span><span class="va">mz</span>, compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span><span class="va">intensity</span>, compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/methods/validObject.html" class="external-link">validObject</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span>        <span class="va">object</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>In addition to adding the data to object, the function also defined
the <code>dataStorage</code> and <code>dataOrigin</code> spectra
variables. The purpose of these two variables is to provide some
information on where the data is stored (<em>in memory</em> as in our
example) and from where the data is originating. The
<code>dataOrigin</code> would for example allow to specify from which
original data files individual spectra derive.</p>
<p>We can now create an instance of our backend class and fill it with
data. We thus first define our MS data and pass this to the
<code>backendInitialize</code> method.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## A data.frame with spectra variables.</span></span>
<span><span class="va">svars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>msLevel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span>, <span class="fl">2L</span><span class="op">)</span>,</span>
<span>                    rtime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">1.3</span>, <span class="fl">1.4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## m/z values for each spectrum.</span></span>
<span><span class="va">mzs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.3</span>, <span class="fl">13.5</span>, <span class="fl">16.5</span>, <span class="fl">17.5</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">45.1</span>, <span class="fl">45.2</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">64.4</span>, <span class="fl">123.1</span>, <span class="fl">124.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## intensity values for each spectrum.</span></span>
<span><span class="va">ints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">123.3</span>, <span class="fl">153.6</span>, <span class="fl">2354.3</span>, <span class="fl">243.4</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">80.1</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.3</span>, <span class="fl">35.2</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Create and initialize the backend</span></span>
<span><span class="va">be</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MsBackend.html">backendInitialize</a></span><span class="op">(</span><span class="fu">MsBackendTest</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                        svars <span class="op">=</span> <span class="va">svars</span>, mz <span class="op">=</span> <span class="va">mzs</span>, intensity <span class="op">=</span> <span class="va">ints</span><span class="op">)</span></span>
<span><span class="va">be</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class "MsBackendTest"</span></span>
<span><span class="co">## Slot "spectraVars":</span></span>
<span><span class="co">##   msLevel rtime dataStorage      dataOrigin</span></span>
<span><span class="co">## 1       1   1.2    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## 2       2   1.3    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## 3       2   1.4    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "mz":</span></span>
<span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] 12.3 13.5 16.5 17.5</span></span>
<span><span class="co">## [[2]] 45.1 45.2</span></span>
<span><span class="co">## [[3]] 64.4 123.1 124.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "intensity":</span></span>
<span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] 123.3 153.6 2354.3 243.4</span></span>
<span><span class="co">## [[2]] 100 80.1</span></span>
<span><span class="co">## [[3]] 12.3 35.2 100</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "readonly":</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "version":</span></span>
<span><span class="co">## [1] "0.1"</span></span></code></pre>
<p>While this method works and is compliant with the
<code>MsBackend</code> API (because there is no requirement on the input
parameters for the <code>backendInitialize</code> method), it would be
good practice for backends that are supposed to support replacing data,
to add an optional additional parameter <code>data</code> that would
allow passing the <em>complete</em> MS data (including m/z and intensity
values) to the function as a <code>DataFrame</code>. This would simplify
the implementation of some replacement methods and would in addition
also allow to change the backend of a <code>Spectra</code> using the
<code>setBackend</code> to our new backend. We thus re-implement the
<code>backendInitialize</code> method supporting also to initialize the
backend with such a data frame and we also implement a helper function
that checks spectra variables for the correct data type.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Helper function to check if core spectra variables have the correct</span></span>
<span><span class="co">#' data type.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x `data.frame` with the data for spectra variables.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param name `character` defining the column names (spectra variables) of `x`</span></span>
<span><span class="co">#'     for which the correct data type should be evaluated.</span></span>
<span><span class="va">.sv_valid_data_type</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Spectra.html">coreSpectraVariables</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/Spectra.html">coreSpectraVariables</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">name</span><span class="op">]</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sv</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/methods/is.html" class="external-link">is</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sv</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">]</span>, <span class="va">sv</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Spectra variabe \""</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sv</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="st">"\" is not of type "</span>,</span>
<span>                 <span class="va">sv</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="cn">TRUE</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This function is then used to check the input data in our new
<code>backendInitialize</code> method.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span></span>
<span>    <span class="st">"backendInitialize"</span>, <span class="st">"MsBackendTest"</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">svars</span>, <span class="va">mz</span>, <span class="va">intensity</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">svars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span></span>
<span>                <span class="va">data</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"intensity"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"mz"</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="va">mz</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">mz</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"intensity"</span><span class="op">)</span><span class="op">)</span></span>
<span>                <span class="va">intensity</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">intensity</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">svars</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'svars' needs to be a 'data.frame' with spectra variables"</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">svars</span><span class="op">$</span><span class="va">dataStorage</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">svars</span><span class="op">$</span><span class="va">dataStorage</span> <span class="op">&lt;-</span> <span class="st">"&lt;memory&gt;"</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">svars</span><span class="op">$</span><span class="va">dataOrigin</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">svars</span><span class="op">$</span><span class="va">dataOrigin</span> <span class="op">&lt;-</span> <span class="st">"&lt;user provided&gt;"</span></span>
<span>        <span class="fu">.sv_valid_data_type</span><span class="op">(</span><span class="va">svars</span><span class="op">)</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">spectraVars</span> <span class="op">&lt;-</span> <span class="va">svars</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span><span class="va">mz</span>, compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span><span class="va">intensity</span>, compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/methods/validObject.html" class="external-link">validObject</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span>        <span class="va">object</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We below create the backend again with the updated
<code>backendInitialize</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create and initialize the backend</span></span>
<span><span class="va">be</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MsBackend.html">backendInitialize</a></span><span class="op">(</span><span class="fu">MsBackendTest</span><span class="op">(</span><span class="op">)</span>,</span>
<span>                        svars <span class="op">=</span> <span class="va">svars</span>, mz <span class="op">=</span> <span class="va">mzs</span>, intensity <span class="op">=</span> <span class="va">ints</span><span class="op">)</span></span>
<span><span class="va">be</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class "MsBackendTest"</span></span>
<span><span class="co">## Slot "spectraVars":</span></span>
<span><span class="co">##   msLevel rtime dataStorage      dataOrigin</span></span>
<span><span class="co">## 1       1   1.2    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## 2       2   1.3    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## 3       2   1.4    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "mz":</span></span>
<span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] 12.3 13.5 16.5 17.5</span></span>
<span><span class="co">## [[2]] 45.1 45.2</span></span>
<span><span class="co">## [[3]] 64.4 123.1 124.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "intensity":</span></span>
<span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] 123.3 153.6 2354.3 243.4</span></span>
<span><span class="co">## [[2]] 100 80.1</span></span>
<span><span class="co">## [[3]] 12.3 35.2 100</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "readonly":</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "version":</span></span>
<span><span class="co">## [1] "0.1"</span></span></code></pre>
<p>The <code>backendInitialize</code> method that we implemented for our
backend class expects the user to provide the full MS data. This does
however not always have to be the case. The
<code>backendInitialize</code> method of the <code>MsBackendMzR</code>
backend takes for example the file names of the raw mzML, mzXML or CDF
files as input and initializes the backend by importing part of the data
from these. Also the backends defined by the <em><a href="https://bioconductor.org/packages/3.18/MsBackendMgf" class="external-link">MsBackendMgf</a></em>
or <em><a href="https://bioconductor.org/packages/3.18/MsBackendMsp" class="external-link">MsBackendMsp</a></em>
packages work in the same way and thus allow to import MS data from
these specific file formats. The <code>backendInitialize</code> method
of the backend defined in the <em><a href="https://bioconductor.org/packages/3.18/MsBackendSql" class="external-link">MsBackendSql</a></em>
on the other hand takes only the connection to a database containing the
data as input and performs some sanity checks on the data but does not
load the data into the backend. Any subsequent data access is handled by
the methods of the backend class through SQL calls to the database.</p>
<p>The purpose of the <code>backendInitialize</code> method is to
<em>initialize</em> and prepare the data in a way that it can be
accessed by a <code>Spectra</code> object (through the initialized
backend class). Whether the data is loaded by the
<code>backendInitialize</code> method into memory or simply referenced
to within the backend class does not matter as long as the backend is
able to provide the data with its accessor methods.</p>
<p>Note also that a <code>backendInitialize</code> function should
ideally also perform some data sanity checks (e.g. whether spectra
variables have the correct data type etc).</p>
</div>
<div class="section level4">
<h4 id="spectravariables">
<code>spectraVariables</code><a class="anchor" aria-label="anchor" href="#spectravariables"></a>
</h4>
<p>The <code>spectraVariables</code> method should return a
<code>character</code> vector with the names of all available spectra
variables of the backend. While a backend class should support defining
and providing their own spectra variables, each <code>MsBackend</code>
class <strong>must</strong> provide also the <em>core spectra
variables</em> (in the correct data type). Since not all data file
formats provide values for all these spectra variables they can however
also be <code>NA</code> (with the exception of the spectra variable
<code>"dataStorage"</code>).</p>
<p>The <code><a href="../reference/Spectra.html">coreSpectraVariables()</a></code> function returns the full
list of mandatory spectra variables along with their expected data
type.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Spectra.html">coreSpectraVariables</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 msLevel                   rtime          acquisitionNum </span></span>
<span><span class="co">##               "integer"               "numeric"               "integer" </span></span>
<span><span class="co">##               scanIndex                      mz               intensity </span></span>
<span><span class="co">##               "integer"           "NumericList"           "NumericList" </span></span>
<span><span class="co">##             dataStorage              dataOrigin              centroided </span></span>
<span><span class="co">##             "character"             "character"               "logical" </span></span>
<span><span class="co">##                smoothed                polarity             precScanNum </span></span>
<span><span class="co">##               "logical"               "integer"               "integer" </span></span>
<span><span class="co">##             precursorMz      precursorIntensity         precursorCharge </span></span>
<span><span class="co">##               "numeric"               "numeric"               "integer" </span></span>
<span><span class="co">##         collisionEnergy  isolationWindowLowerMz isolationWindowTargetMz </span></span>
<span><span class="co">##               "numeric"               "numeric"               "numeric" </span></span>
<span><span class="co">##  isolationWindowUpperMz </span></span>
<span><span class="co">##               "numeric"</span></span></code></pre>
<p>A typical <code>spectraVariables</code> method for a
<code>MsBackend</code> class will thus be implemented similarly to the
one for our <code>MsBackendTest</code> test backend: it will return the
union of the core spectra variables and the names for all available
spectra variables within the backend object.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"spectraVariables"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/sets.html" class="external-link">union</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/Spectra.html">coreSpectraVariables</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">spectraVars</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "msLevel"                 "rtime"                  </span></span>
<span><span class="co">##  [3] "acquisitionNum"          "scanIndex"              </span></span>
<span><span class="co">##  [5] "mz"                      "intensity"              </span></span>
<span><span class="co">##  [7] "dataStorage"             "dataOrigin"             </span></span>
<span><span class="co">##  [9] "centroided"              "smoothed"               </span></span>
<span><span class="co">## [11] "polarity"                "precScanNum"            </span></span>
<span><span class="co">## [13] "precursorMz"             "precursorIntensity"     </span></span>
<span><span class="co">## [15] "precursorCharge"         "collisionEnergy"        </span></span>
<span><span class="co">## [17] "isolationWindowLowerMz"  "isolationWindowTargetMz"</span></span>
<span><span class="co">## [19] "isolationWindowUpperMz"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="spectradata">
<code>spectraData</code><a class="anchor" aria-label="anchor" href="#spectradata"></a>
</h4>
<p>The <code>spectraData</code> method should return the
<strong>full</strong> spectra data within a backend as a
<code>DataFrame</code> object (defined in the <em><a href="https://bioconductor.org/packages/3.18/S4Vectors" class="external-link">S4Vectors</a></em>
package). The second parameter <code>columns</code> allows to define the
names of the spectra variables that should be returned in the
<code>DataFrame</code>. Each row in this data frame should represent one
spectrum, each column a spectra variable. Columns <code>"mz"</code> and
<code>"intensity"</code> (if requested) have to contain each a
<code>NumericList</code> with the m/z and intensity values of the
spectra. The <code>DataFrame</code> <strong>must</strong> provide values
(even if they are <code>NA</code>) for <strong>all</strong> requested
spectra variables of the backend (<strong>including</strong> the core
spectra variables).</p>
<p>This is now a first problem for our toy backend class, since we keep
the spectra variable data in a simple <code>data.frame</code> without
any constraints such as required columns etc. A simple solution to this
(which is also used by all backend classes in the <code>Spectra</code>
package) is to <em>fill</em> missing spectra variables on-the-fly into
the returned <code>DataFrame</code>. We thus define below a simple
helper function that adds columns with missing values (of the correct
data type) for core spectra variables that are not available within the
backend to the result.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' @description Add columns with missing core spectra variables.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param x `data.frame` or `DataFrame` with some spectra variables.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param core_vars `character` with core spectra variable names that should</span></span>
<span><span class="co">#'     be added to `x` if not already present.</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">.fill_core_variables</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">core_vars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/Spectra.html">coreSpectraVariables</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fill_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">core_vars</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">core_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Spectra.html">coreSpectraVariables</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fill_vars</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">fill</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">fill_vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">core_type</span><span class="op">[</span><span class="va">z</span><span class="op">]</span><span class="op">)</span>, <span class="va">n</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fill</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">fill_vars</span></span>
<span>        <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">fill</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">x</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We next implement the <code>spectraData</code> method that uses this
helper function to fill eventually missing core spectra variables. Note
also that this function should return a <code>DataFrame</code> even for
a single column.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span></span>
<span>    <span class="st">"spectraData"</span>, <span class="st">"MsBackendTest"</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">columns</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">columns</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Some of the requested spectra variables are not available"</span><span class="op">)</span></span>
<span>        <span class="co">## Add m/z and intensity values to the result</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/DataFrame-class.html" class="external-link">DataFrame</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">spectraVars</span><span class="op">)</span></span>
<span>        <span class="va">res</span><span class="op">$</span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="va">object</span><span class="op">@</span><span class="va">mz</span></span>
<span>        <span class="va">res</span><span class="op">$</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="va">object</span><span class="op">@</span><span class="va">intensity</span></span>
<span>        <span class="co">## Fill with eventually missing core variables</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">.fill_core_variables</span><span class="op">(</span></span>
<span>            <span class="va">res</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">columns</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/Spectra.html">coreSpectraVariables</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">res</span><span class="op">[</span>, <span class="va">columns</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>As an alternative, we could also initialize the
<code>@spectraVars</code> data frame within the
<code>backendInitialize</code> method adding columns for spectra
variables that are not provided by the user and require that this data
frame always contains all core spectra variables. Extracting spectra
data (single spectra variables or the full data) might thus be more
efficient then the on-the-fly initialization with eventual missing
spectra variables, but the backend class would also have a larger memory
footprint because even spectra variables with only missing values for
all spectra need to be stored within the object.</p>
<p>We can now use <code>spectraData</code> to either extract the full
spectra data from the backend, or only the data for selected spectra
variables.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Full data</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 3 rows and 19 columns</span></span>
<span><span class="co">##     msLevel     rtime acquisitionNum scanIndex                 mz</span></span>
<span><span class="co">##   &lt;integer&gt; &lt;numeric&gt;      &lt;integer&gt; &lt;integer&gt;      &lt;NumericList&gt;</span></span>
<span><span class="co">## 1         1       1.2             NA        NA 12.3,13.5,16.5,...</span></span>
<span><span class="co">## 2         2       1.3             NA        NA          45.1,45.2</span></span>
<span><span class="co">## 3         2       1.4             NA        NA   64.4,123.1,124.1</span></span>
<span><span class="co">##                  intensity dataStorage      dataOrigin centroided  smoothed</span></span>
<span><span class="co">##              &lt;NumericList&gt; &lt;character&gt;     &lt;character&gt;  &lt;logical&gt; &lt;logical&gt;</span></span>
<span><span class="co">## 1  123.3, 153.6,2354.3,...    &lt;memory&gt; &lt;user provided&gt;         NA        NA</span></span>
<span><span class="co">## 2              100.0, 80.1    &lt;memory&gt; &lt;user provided&gt;         NA        NA</span></span>
<span><span class="co">## 3         12.3, 35.2,100.0    &lt;memory&gt; &lt;user provided&gt;         NA        NA</span></span>
<span><span class="co">##    polarity precScanNum precursorMz precursorIntensity precursorCharge</span></span>
<span><span class="co">##   &lt;integer&gt;   &lt;integer&gt;   &lt;numeric&gt;          &lt;numeric&gt;       &lt;integer&gt;</span></span>
<span><span class="co">## 1        NA          NA          NA                 NA              NA</span></span>
<span><span class="co">## 2        NA          NA          NA                 NA              NA</span></span>
<span><span class="co">## 3        NA          NA          NA                 NA              NA</span></span>
<span><span class="co">##   collisionEnergy isolationWindowLowerMz isolationWindowTargetMz</span></span>
<span><span class="co">##         &lt;numeric&gt;              &lt;numeric&gt;               &lt;numeric&gt;</span></span>
<span><span class="co">## 1              NA                     NA                      NA</span></span>
<span><span class="co">## 2              NA                     NA                      NA</span></span>
<span><span class="co">## 3              NA                     NA                      NA</span></span>
<span><span class="co">##   isolationWindowUpperMz</span></span>
<span><span class="co">##                &lt;numeric&gt;</span></span>
<span><span class="co">## 1                     NA</span></span>
<span><span class="co">## 2                     NA</span></span>
<span><span class="co">## 3                     NA</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Selected variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">be</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"mz"</span>, <span class="st">"centroided"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 3 rows and 3 columns</span></span>
<span><span class="co">##       rtime                 mz centroided</span></span>
<span><span class="co">##   &lt;numeric&gt;      &lt;NumericList&gt;  &lt;logical&gt;</span></span>
<span><span class="co">## 1       1.2 12.3,13.5,16.5,...         NA</span></span>
<span><span class="co">## 2       1.3          45.1,45.2         NA</span></span>
<span><span class="co">## 3       1.4   64.4,123.1,124.1         NA</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Only missing core spectra variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">be</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"centroided"</span>, <span class="st">"polarity"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 3 rows and 2 columns</span></span>
<span><span class="co">##   centroided  polarity</span></span>
<span><span class="co">##    &lt;logical&gt; &lt;integer&gt;</span></span>
<span><span class="co">## 1         NA        NA</span></span>
<span><span class="co">## 2         NA        NA</span></span>
<span><span class="co">## 3         NA        NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="peaksdata">
<code>peaksData</code><a class="anchor" aria-label="anchor" href="#peaksdata"></a>
</h4>
<p>The <code>peaksData</code> method extracts the MS peaks data from a
backend, which includes the m/z and intensity values of each MS peak of
a spectrum. These are expected to be returned as a <code>List</code> of
numerical matrices with columns in each <code>matrix</code> being the
requested <em>peaks variables</em> (with the default being
<code>"mz"</code> and <code>"intensity"</code>) of one spectrum.
Backends must provide at least these two peaks variables.</p>
<p>Below we implement the <code>peaksData</code> method for our backend.
We need to loop over the <code>@mz</code> and <code>@intensity</code>
slots to merge the m/z and intensity of each spectrum into a
<code>matrix</code>. Also, for simplicity reasons, we accept only
<code>c("mz", "intensity")</code> for the <code>columns</code>
parameter. This is the expected default behavior for a
<code>MsBackend</code>, but in general the <code>columns</code>
parameter is thought to allow the user to specify which peaks variables
should be returned in each <code>matrix</code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span></span>
<span>    <span class="st">"peaksData"</span>, <span class="st">"MsBackendTest"</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">columns</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"intensity"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">columns</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">2</span> <span class="op">&amp;&amp;</span> <span class="va">columns</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"intensity"</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'columns' supports only \"mz\" and \"intensity\""</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/mapply.html" class="external-link">mapply</a></span><span class="op">(</span>mz <span class="op">=</span> <span class="va">object</span><span class="op">@</span><span class="va">mz</span>, intensity <span class="op">=</span> <span class="va">object</span><span class="op">@</span><span class="va">intensity</span>,</span>
<span>               FUN <span class="op">=</span> <span class="va">cbind</span>, SIMPLIFY <span class="op">=</span> <span class="cn">FALSE</span>, USE.NAMES <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>And with this method we can now extract the peaks data from our
backend.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hidden_aliases.html">peaksData</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">##        mz intensity</span></span>
<span><span class="co">## [1,] 12.3     123.3</span></span>
<span><span class="co">## [2,] 13.5     153.6</span></span>
<span><span class="co">## [3,] 16.5    2354.3</span></span>
<span><span class="co">## [4,] 17.5     243.4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">##        mz intensity</span></span>
<span><span class="co">## [1,] 45.1     100.0</span></span>
<span><span class="co">## [2,] 45.2      80.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">##         mz intensity</span></span>
<span><span class="co">## [1,]  64.4      12.3</span></span>
<span><span class="co">## [2,] 123.1      35.2</span></span>
<span><span class="co">## [3,] 124.1     100.0</span></span></code></pre>
<p>The <code>peaksData</code> method is used in many data analysis
functions of the <code>Spectra</code> object to extract the MS data,
thus ideally this method should be implemented in an efficient way. For
our backend we need to loop over the lists of m/z and intensity values
which is obviously not ideal. Thus, storing the m/z and intensity values
in separate slots as done in this backend might not be ideal. The
<code>MsBackendMemory</code> backend for example stores the MS data
already as a <code>list</code> of matrices which results in a more
efficient <code>peaksData</code> method (but comes also with a larger
overhead when adding, replacing or checking MS data).</p>
<p>Note also that while a backend needs to provide m/z and intensity
values, additional peak variables would also be supported. The
<code>MsBackendMemory</code> class for example allows to store and
provide additional peak variables that can then be added as additional
columns to each returned <code>matrix</code>. In this case the default
<code>peaksVariables</code> method should also be overwritten to list
the additionally available variables and the <code>columns</code>
parameter of the <code>peaksData</code> method should allow selection of
these additional peaks variables (in addition to the required
<code>"mz"</code> and <code>"intensity"</code> variables).</p>
</div>
<div class="section level4">
<h4 id="section">
<code>[</code><a class="anchor" aria-label="anchor" href="#section"></a>
</h4>
<p>The <code>[</code> method allows to subset <code>MsBackend</code>
objects. This operation is expected to reduce a <code>MsBackend</code>
object to the selected spectra. The method should support to subset by
indices or logical vectors and should also support duplicating elements
(i.e. when duplicated indices are used) as well as to subset in
arbitrary order. An error should be thrown if indices are out of bounds,
but the method should also support returning an empty backend with
<code>[integer()]</code>. Note that the
<code><a href="https://rdrr.io/pkg/MsCoreUtils/man/i2index.html" class="external-link">MsCoreUtils::i2index</a></code> function can be used to check for
correct input (and convert the input to an <code>integer</code>
index).</p>
<p>Below we implement a possible <code>[</code> for our test backend
class. We ignore the parameters <code>j</code> from the definition of
the <code>[</code> generic, since we treat our data to be
one-dimensional (with each spectrum being one element).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"["</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span>, <span class="va">j</span>, <span class="va">...</span>, <span class="va">drop</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">i</span> <span class="op">&lt;-</span> <span class="fu">MsCoreUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MsCoreUtils/man/i2index.html" class="external-link">i2index</a></span><span class="op">(</span><span class="va">i</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">x</span><span class="op">@</span><span class="va">spectraVars</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">@</span><span class="va">spectraVars</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span></span>
<span>    <span class="va">x</span><span class="op">@</span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">@</span><span class="va">mz</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">x</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">@</span><span class="va">intensity</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">x</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We can now subset our backend to the last two spectra.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">be</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 2 rows and 19 columns</span></span>
<span><span class="co">##     msLevel     rtime acquisitionNum scanIndex                mz</span></span>
<span><span class="co">##   &lt;integer&gt; &lt;numeric&gt;      &lt;integer&gt; &lt;integer&gt;     &lt;NumericList&gt;</span></span>
<span><span class="co">## 1         2       1.3             NA        NA         45.1,45.2</span></span>
<span><span class="co">## 2         2       1.4             NA        NA  64.4,123.1,124.1</span></span>
<span><span class="co">##           intensity dataStorage      dataOrigin centroided  smoothed  polarity</span></span>
<span><span class="co">##       &lt;NumericList&gt; &lt;character&gt;     &lt;character&gt;  &lt;logical&gt; &lt;logical&gt; &lt;integer&gt;</span></span>
<span><span class="co">## 1       100.0, 80.1    &lt;memory&gt; &lt;user provided&gt;         NA        NA        NA</span></span>
<span><span class="co">## 2  12.3, 35.2,100.0    &lt;memory&gt; &lt;user provided&gt;         NA        NA        NA</span></span>
<span><span class="co">##   precScanNum precursorMz precursorIntensity precursorCharge collisionEnergy</span></span>
<span><span class="co">##     &lt;integer&gt;   &lt;numeric&gt;          &lt;numeric&gt;       &lt;integer&gt;       &lt;numeric&gt;</span></span>
<span><span class="co">## 1          NA          NA                 NA              NA              NA</span></span>
<span><span class="co">## 2          NA          NA                 NA              NA              NA</span></span>
<span><span class="co">##   isolationWindowLowerMz isolationWindowTargetMz isolationWindowUpperMz</span></span>
<span><span class="co">##                &lt;numeric&gt;               &lt;numeric&gt;              &lt;numeric&gt;</span></span>
<span><span class="co">## 1                     NA                      NA                     NA</span></span>
<span><span class="co">## 2                     NA                      NA                     NA</span></span></code></pre>
<p>Or extracting the second spectrum multiple times.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">be</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 3 rows and 19 columns</span></span>
<span><span class="co">##       msLevel     rtime acquisitionNum scanIndex            mz     intensity</span></span>
<span><span class="co">##     &lt;integer&gt; &lt;numeric&gt;      &lt;integer&gt; &lt;integer&gt; &lt;NumericList&gt; &lt;NumericList&gt;</span></span>
<span><span class="co">## 2           2       1.3             NA        NA     45.1,45.2   100.0, 80.1</span></span>
<span><span class="co">## 2.1         2       1.3             NA        NA     45.1,45.2   100.0, 80.1</span></span>
<span><span class="co">## 2.2         2       1.3             NA        NA     45.1,45.2   100.0, 80.1</span></span>
<span><span class="co">##     dataStorage      dataOrigin centroided  smoothed  polarity precScanNum</span></span>
<span><span class="co">##     &lt;character&gt;     &lt;character&gt;  &lt;logical&gt; &lt;logical&gt; &lt;integer&gt;   &lt;integer&gt;</span></span>
<span><span class="co">## 2      &lt;memory&gt; &lt;user provided&gt;         NA        NA        NA          NA</span></span>
<span><span class="co">## 2.1    &lt;memory&gt; &lt;user provided&gt;         NA        NA        NA          NA</span></span>
<span><span class="co">## 2.2    &lt;memory&gt; &lt;user provided&gt;         NA        NA        NA          NA</span></span>
<span><span class="co">##     precursorMz precursorIntensity precursorCharge collisionEnergy</span></span>
<span><span class="co">##       &lt;numeric&gt;          &lt;numeric&gt;       &lt;integer&gt;       &lt;numeric&gt;</span></span>
<span><span class="co">## 2            NA                 NA              NA              NA</span></span>
<span><span class="co">## 2.1          NA                 NA              NA              NA</span></span>
<span><span class="co">## 2.2          NA                 NA              NA              NA</span></span>
<span><span class="co">##     isolationWindowLowerMz isolationWindowTargetMz isolationWindowUpperMz</span></span>
<span><span class="co">##                  &lt;numeric&gt;               &lt;numeric&gt;              &lt;numeric&gt;</span></span>
<span><span class="co">## 2                       NA                      NA                     NA</span></span>
<span><span class="co">## 2.1                     NA                      NA                     NA</span></span>
<span><span class="co">## 2.2                     NA                      NA                     NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="backendmerge">
<code>backendMerge</code><a class="anchor" aria-label="anchor" href="#backendmerge"></a>
</h4>
<p>The <code>backendMerge</code> method merges (combines)
<code>MsBackend</code> objects (of the same type!) into a single
instance. For our test backend we thus need to combine the values in the
<code>@spectraVars</code>, <code>@mz</code> and <code>@intensity</code>
slots. To support also merging of <code>data.frame</code>s with
different set of columns we use the <code><a href="https://rdrr.io/pkg/MsCoreUtils/man/rbindFill.html" class="external-link">MsCoreUtils::rbindFill</a></code>
function instead of a simple <code>rbind</code> (this function joins
data frames making an union of all available columns).</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"backendMerge"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="va">object</span></span>
<span>    <span class="va">object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">res</span><span class="op">@</span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">object</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">@</span><span class="va">mz</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">res</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">c</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">object</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">@</span><span class="va">intensity</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">res</span><span class="op">@</span><span class="va">spectraVars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu">MsCoreUtils</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/MsCoreUtils/man/rbindFill.html" class="external-link">rbindFill</a></span>,</span>
<span>                               <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">object</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="va">z</span><span class="op">@</span><span class="va">spectraVars</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/methods/validObject.html" class="external-link">validObject</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>    <span class="va">res</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Again, this implementation which requires 3 loops might not be the
most efficient - but it allows to merge backends of the type
<code>MsBackendTest</code>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hidden_aliases.html">backendMerge</a></span><span class="op">(</span><span class="va">be</span>, <span class="va">be</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">be</span><span class="op">)</span></span>
<span><span class="va">a</span></span></code></pre></div>
<pre><code><span><span class="co">## An object of class "MsBackendTest"</span></span>
<span><span class="co">## Slot "spectraVars":</span></span>
<span><span class="co">##    msLevel rtime dataStorage      dataOrigin</span></span>
<span><span class="co">## 1        1   1.2    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## 2        2   1.3    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## 3        2   1.4    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## 21       2   1.3    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## 11       1   1.2    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## 22       2   1.3    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## 31       2   1.4    &lt;memory&gt; &lt;user provided&gt;</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "mz":</span></span>
<span><span class="co">## NumericList of length 7</span></span>
<span><span class="co">## [[1]] 12.3 13.5 16.5 17.5</span></span>
<span><span class="co">## [[2]] 45.1 45.2</span></span>
<span><span class="co">## [[3]] 64.4 123.1 124.1</span></span>
<span><span class="co">## [[4]] 45.1 45.2</span></span>
<span><span class="co">## [[5]] 12.3 13.5 16.5 17.5</span></span>
<span><span class="co">## [[6]] 45.1 45.2</span></span>
<span><span class="co">## [[7]] 64.4 123.1 124.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "intensity":</span></span>
<span><span class="co">## NumericList of length 7</span></span>
<span><span class="co">## [[1]] 123.3 153.6 2354.3 243.4</span></span>
<span><span class="co">## [[2]] 100 80.1</span></span>
<span><span class="co">## [[3]] 12.3 35.2 100</span></span>
<span><span class="co">## [[4]] 100 80.1</span></span>
<span><span class="co">## [[5]] 123.3 153.6 2354.3 243.4</span></span>
<span><span class="co">## [[6]] 100 80.1</span></span>
<span><span class="co">## [[7]] 12.3 35.2 100</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "readonly":</span></span>
<span><span class="co">## [1] FALSE</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Slot "version":</span></span>
<span><span class="co">## [1] "0.1"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="section-1">
<code>$</code><a class="anchor" aria-label="anchor" href="#section-1"></a>
</h4>
<p>The <code>$</code> method is expected to extract a single spectra
variable from a backend. Parameter <code>name</code> should allow to
name the spectra variable to return. Each <code>MsBackend</code>
<strong>must</strong> support extracting the core spectra variables with
this method (even if no data might be available for that variable). In
our example implementation below we make use of the
<code>spectraData</code> method, but more efficient implementations
might be available as well (that would not require to first
subset/create a <code>DataFrame</code> with the full data and to then
subset that again). Also, the <code>$</code> method should check if the
requested spectra variable is available and should throw an error
otherwise.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"$"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">name</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">x</span>, columns <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>With this we can now extract the MS levels</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">be</span><span class="op">$</span><span class="va">msLevel</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 2 2</span></span></code></pre>
<p>or a core spectra variable that is not available within the
backend.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">be</span><span class="op">$</span><span class="va">precursorMz</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
<p>or also the m/z values</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">be</span><span class="op">$</span><span class="va">mz</span></span></code></pre></div>
<pre><code><span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] 12.3 13.5 16.5 17.5</span></span>
<span><span class="co">## [[2]] 45.1 45.2</span></span>
<span><span class="co">## [[3]] 64.4 123.1 124.1</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="lengths">
<code>lengths</code><a class="anchor" aria-label="anchor" href="#lengths"></a>
</h4>
<p>The <code>lengths</code> method is expected to return an
<code>integer</code> vector (same length as the number of spectra in the
backend) with the total number of peaks per spectrum.</p>
<p>For our <code>MsBackendTest</code> we can simply use the
<code>lengths</code> method on the m/z or intensity values for that.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"lengths"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">use.names</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">x</span><span class="op">@</span><span class="va">mz</span>, use.names <span class="op">=</span> <span class="va">use.names</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>And we can now get the peaks count per spectrum:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4 2 3</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="isempty">
<code>isEmpty</code><a class="anchor" aria-label="anchor" href="#isempty"></a>
</h4>
<p>The <code>isEmpty</code> method is expected to return for each
spectrum the information whether it is <em>empty</em>, i.e. does not
contain any MS peaks (and hence m/z or intensity values). The result of
the method has to be a <code>logical</code> of length equal to the
number of spectra represented by the backend with <code>TRUE</code>
indicating whether a spectrum is empty and <code>FALSE</code> otherwise.
For our implementation of the <code>isEmpty</code> method we use the
<code>lenghts</code> method defined above that returns the number of MS
peaks per spectrum.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"isEmpty"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0L</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/List-class.html" class="external-link">isEmpty</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE FALSE FALSE</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="acquisitionnum">
<code>acquisitionNum</code><a class="anchor" aria-label="anchor" href="#acquisitionnum"></a>
</h4>
<p>Extract the <code>acquisitionNum</code> core spectra variable. The
method is expected to return an <code>integer</code> vector with the
same length as there are spectra represented by the backend. For our
backend we simply re-use the <code>spectraData</code> method.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"acquisitionNum"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"acquisitionNum"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">acquisitionNum</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="centroided">
<code>centroided</code><a class="anchor" aria-label="anchor" href="#centroided"></a>
</h4>
<p>Extract for each spectrum the information whether it contains
<em>centroided</em> data. The method is expected to return a
<code>logical</code> vector with the same length as there are spectra
represented by the backend.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"centroided"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"centroided"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">centroided</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="collisionenergy">
<code>collisionEnergy</code><a class="anchor" aria-label="anchor" href="#collisionenergy"></a>
</h4>
<p>Extract for each spectrum the collision energy applied to generate
the fragment spectrum. The method is expected to return a
<code>numeric</code> vector with the same length as there are spectra
represented by the backend (with <code>NA_real_</code> for spectra for
which this information is not available, such as MS1 spectra).</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"collisionEnergy"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"collisionEnergy"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">collisionEnergy</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="dataorigin">
<code>dataOrigin</code><a class="anchor" aria-label="anchor" href="#dataorigin"></a>
</h4>
<p>Extract the <em>data origin</em> spectra variable for each spectrum.
This spectra variable can be used to store the origin of each spectra.
The method is expected to return a <code>character</code> vector of
length equal to the number of spectra represented by the backend.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"dataOrigin"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"dataOrigin"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "&lt;user provided&gt;" "&lt;user provided&gt;" "&lt;user provided&gt;"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="intensity">
<code>intensity</code><a class="anchor" aria-label="anchor" href="#intensity"></a>
</h4>
<p>Extract the intensity values for each spectrum in the backend. The
result is expected to be a <code>NumericList</code> of length equal to
the number of spectra represented by the backend. For our test backend
we can simply return the <code>@intensity</code> slot since the data is
already stored within a <code>NumericList</code>.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"intensity"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">@</span><span class="va">intensity</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] 123.3 153.6 2354.3 243.4</span></span>
<span><span class="co">## [[2]] 100 80.1</span></span>
<span><span class="co">## [[3]] 12.3 35.2 100</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="isolationwindowlowermz">
<code>isolationWindowLowerMz</code><a class="anchor" aria-label="anchor" href="#isolationwindowlowermz"></a>
</h4>
<p>Extract the core spectra variable <code>isolationWindowLowerMz</code>
from the backend. This information is usually provided for each spectrum
in the raw mzML files. The method is expected to return a
<code>numeric</code> vector of length equal to the number of spectra
represented by the backend.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"isolationWindowLowerMz"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"isolationWindowLowerMz"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">isolationWindowLowerMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="isolationwindowtargetmz">
<code>isolationWindowTargetMz</code><a class="anchor" aria-label="anchor" href="#isolationwindowtargetmz"></a>
</h4>
<p>Extract the core spectra variable
<code>isolationWindowTargetMz</code> from the backend. This information
is usually provided for each spectrum in the raw mzML files. The method
is expected to return a <code>numeric</code> vector of length equal to
the number of spectra represented by the backend.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"isolationWindowTargetMz"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"isolationWindowTargetMz"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">isolationWindowTargetMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="isolationwindowuppermz">
<code>isolationWindowUpperMz</code><a class="anchor" aria-label="anchor" href="#isolationwindowuppermz"></a>
</h4>
<p>Extract the core spectra variable <code>isolationWindowUpperMz</code>
from the backend. This information is usually provided for each spectrum
in the raw mzML files. The method is expected to return a
<code>numeric</code> vector of length equal to the number of spectra
represented by the backend.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"isolationWindowUpperMz"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"isolationWindowUpperMz"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">isolationWindowUpperMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="mslevel">
<code>msLevel</code><a class="anchor" aria-label="anchor" href="#mslevel"></a>
</h4>
<p>Extract the MS level for each spectrum in the backend. This method is
expected to return an <code>integer</code> of length equal to the number
of spectra represented by the backend.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"msLevel"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"msLevel"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">msLevel</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 2 2</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="mz">
<code>mz</code><a class="anchor" aria-label="anchor" href="#mz"></a>
</h4>
<p>Extract the m/z values for each spectrum in the backend. The result
is expected to be a <code>NumericList</code> of length equal to the
number of spectra represented by the backend. Also, the m/z values are
expected to be ordered increasingly for each element (spectrum).</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">@</span><span class="va">mz</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] 12.3 13.5 16.5 17.5</span></span>
<span><span class="co">## [[2]] 45.1 45.2</span></span>
<span><span class="co">## [[3]] 64.4 123.1 124.1</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="polarity">
<code>polarity</code><a class="anchor" aria-label="anchor" href="#polarity"></a>
</h4>
<p>Extract the <code>polarity</code> core spectra variable for each
spectrum in the backend. This method is expected to return an
<code>integer</code> of length equal to the number of spectra
represented by the backend. Negative and positive polarity are expected
to be encoded by <code>0L</code> and <code>1L</code>, respectively.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"polarity"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"polarity"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">polarity</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="precscannum">
<code>precScanNum</code><a class="anchor" aria-label="anchor" href="#precscannum"></a>
</h4>
<p>Extract the acquisition number of the precursor for each spectrum.
This method is expected to return an <code>integer</code> of length
equal to the number of spectra represented by the backend. For MS1
spectra (or if the acquisition number of the precursor is not provided)
<code>NA_integer_</code> has to be returned.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"precScanNum"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"precScanNum"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">precScanNum</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="precursorcharge">
<code>precursorCharge</code><a class="anchor" aria-label="anchor" href="#precursorcharge"></a>
</h4>
<p>Extract the charge of the precursor for each spectrum. This method is
expected to return an <code>integer</code> of length equal to the number
of spectra represented by the backend. For MS1 spectra (or if the charge
of the precursor is not provided) <code>NA_integer_</code> has to be
returned.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"precursorCharge"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"precursorCharge"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">precursorCharge</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="precursorintensity">
<code>precursorIntensity</code><a class="anchor" aria-label="anchor" href="#precursorintensity"></a>
</h4>
<p>Extract the intensity of the precursor for each spectrum. This method
is expected to return an <code>numeric</code> of length equal to the
number of spectra represented by the backend. For MS1 spectra (or if the
precursor intensity for a fragment spectrum is not provided)
<code>NA_real_</code> has to be returned.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"precursorIntensity"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"precursorIntensity"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">precursorIntensity</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="precursormz">
<code>precursorMz</code><a class="anchor" aria-label="anchor" href="#precursormz"></a>
</h4>
<p>Extract the precursor m/z for each spectrum. This method is expected
to return an <code>numeric</code> of length equal to the number of
spectra represented by the backend. For MS1 spectra (or if the precursor
m/z for a fragment spectrum is not provided) <code>NA_real_</code> has
to be returned.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"precursorMz"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"precursorMz"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">precursorMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="rtime">
<code>rtime</code><a class="anchor" aria-label="anchor" href="#rtime"></a>
</h4>
<p>Extract the retention time of each spectrum. This method is expected
to return a <code>numeric</code> of length equal to the number of
spectra represented by the backend.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"rtime"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.2 1.3 1.4</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="scanindex">
<code>scanIndex</code><a class="anchor" aria-label="anchor" href="#scanindex"></a>
</h4>
<p>Extract the <em>scan index</em> core spectra variable. The scan index
represents the relative index of the spectrum within the respective raw
data file and can be different than the <code>acquisitionNum</code>
(which is the index of a spectrum as recorded by the MS instrument).
This method is expected to return a <code>integer</code> of length equal
to the number of spectra represented by the backend.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"scanIndex"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"scanIndex"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">scanIndex</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="smoothed">
<code>smoothed</code><a class="anchor" aria-label="anchor" href="#smoothed"></a>
</h4>
<p>Extract the <code>smoothed</code> core spectra variable that
indicates whether a spectrum was <em>smoothed</em>. This variable is
supported for backward compatibility but seldomly used. The method is
expected to return a <code>logical</code> with length equal to the
number of spectra represented by the backend.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"smoothed"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"smoothed"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">smoothed</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="spectranames">
<code>spectraNames</code><a class="anchor" aria-label="anchor" href="#spectranames"></a>
</h4>
<p>The <code>spectraNames</code> can be used to extract (optional) names
(or IDs) for individual spectra of a backend, or <code>NULL</code> if
not set. For our test backend we can use the <code>rownames</code> of
the <code>@spectraVars</code> slot to store spectra names.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"spectraNames"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">spectraVars</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraNames</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "1" "2" "3"</span></span></code></pre>
<p>These are all the methods that need to be implemented for a valid
<em>read-only</em> <code>MsBackend</code> class and running a test on
such an object as described in section <em>Testing the validity of the
backend</em> should not produce any errors. For backends that support
also data replacement also the methods listed in the next section need
to be implemented.</p>
</div>
<div class="section level4">
<h4 id="tic">
<code>tic</code><a class="anchor" aria-label="anchor" href="#tic"></a>
</h4>
<p>The <code>tic</code> method should return the total ion count
(i.e. the sum of intensities) for each spectrum. This information is
usually also provided by the raw MS data files, but can also be
calculated on the fly from the data. The parameter <code>initial</code>
(which is by default <code>TRUE</code>) allows to define whether the
provided <em>original</em> tic should be returned (for
<code>initial = TRUE</code>) or whether the tic should be calculated on
the actual data (<code>initial = FALSE</code>). The original tic values
are usually provided by a spectra variable <code>"totIonCurrent"</code>.
Thus, for <code>initial = TRUE</code>, in our implementation below we
return the value of such a spectra variable it it is avaialble or
<code>NA</code> if it is not.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"tic"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">initial</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">initial</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">==</span> <span class="st">"totIonCurrent"</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, <span class="st">"totIonCurrent"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span>        <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="va">sum</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We can now either return the original (initial) TIC (which is not
available).</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">tic</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
<p>Or calculate the TIC based on the actual intensity values.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">tic</a></span><span class="op">(</span><span class="va">be</span>, initial <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2874.6  180.1  147.5</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="data-replacement-methods">Data replacement methods<a class="anchor" aria-label="anchor" href="#data-replacement-methods"></a>
</h3>
<p>As stated in the general description, <code>MsBackend</code>
implementations can also be purely <em>read-only</em> resources allowing
to just access data, but not to replace the data. Thus, it is not
strictly required to implement these methods, but for a fully functional
backend it is suggested (as much as possible). A backend for a purely
read-only MS data resource might even extend the
<code>MsBackendCached</code> backend defined in the <code>Spectra</code>
package that provides a mechanism to cache (spectra variable) data in a
<code>data.frame</code> within the object. The
<code>MsBackendMassbankSql</code> implemented in the <em><a href="https://bioconductor.org/packages/3.18/MsBackendMassbank" class="external-link">MsBackendMassbank</a></em>
package extends for example this backend and thus allows modifying some
spectra variables without changing the original data in the MassBank SQL
database.</p>
<div class="section level4">
<h4 id="spectradata-">
<code>spectraData&lt;-</code><a class="anchor" aria-label="anchor" href="#spectradata-"></a>
</h4>
<p>The <code>spectraData&lt;-</code> method should allow to replace the
data within a backend. The method should take a <code>DataFrame</code>
with the full data as input value and is expected to replace the
<strong>full</strong> data within the backend, i.e. all spectra
variables as well as peak data. Also, importantly, the number of spectra
before and after calling the <code>spectraData&lt;-</code> method on an
object has to be the same. For our implementation we can make use of the
optional parameter <code>data</code> that we added to the
<code>backendInitialize</code> method and that allows to fill a
<code>MsBackendTest</code> object with the full data.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"spectraData"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"DataFrame"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'value' is expected to be a 'DataFrame'"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'value' has to be a 'DataFrame' with "</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="st">" rows"</span><span class="op">)</span></span>
<span>    <span class="va">object</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MsBackend.html">backendInitialize</a></span><span class="op">(</span><span class="fu">MsBackendTest</span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>To test this new method we extract the full spectra data, add an
additional column (spectra variable) and replace the data again.</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">new_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">d</span></span>
<span><span class="va">be</span><span class="op">$</span><span class="va">new_col</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "a" "b" "c"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="intensity-">
<code>intensity&lt;-</code><a class="anchor" aria-label="anchor" href="#intensity-"></a>
</h4>
<p>The <code>intensity&lt;-</code> method should allow to replace the
intensity values of all spectra in a backend. This method is expected to
only replace the <em>values</em> of the intensities, but must not change
the number of intensities (and hence peaks) of a spectrum (that could be
done with the <code>peaksData&lt;-</code> method that allows to replace
intensity <strong>and</strong> m/z values at the same time). The
<code>value</code> for the method should ideally be a
<code>NumericList</code> to ensure that all intensity values are indeed
<code>numeric</code>. In addition to the method we implement also a
simple helper function that checks for the correct length of
<code>value</code>. Each data replacement method needs to check for that
and this function thus reduces code duplication.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.match_length</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Length of 'value' has to match the length of 'object'"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"intensity"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">.match_length</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"NumericList"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'value' has to be a list or NumericList"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"lengths of 'value' has to match the number of peaks per spectrum"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"NumericList"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span><span class="va">value</span>, compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">object</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We could now use this method to replace the intensities in our
backend with modified intensities.</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] 123.3 153.6 2354.3 243.4</span></span>
<span><span class="co">## [[2]] 100 80.1</span></span>
<span><span class="co">## [[3]] 12.3 35.2 100</span></span></code></pre>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] 113.3 143.6 2344.3 233.4</span></span>
<span><span class="co">## [[2]] 90 70.1</span></span>
<span><span class="co">## [[3]] 2.3 25.2 90</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="mz-">
<code>mz&lt;-</code><a class="anchor" aria-label="anchor" href="#mz-"></a>
</h4>
<p>The <code>mz&lt;-</code> method should allow to replace the m/z
values of all spectra in a backend. The implementation can be the same
as for the <code>intensity&lt;-</code> method. m/z values within each
spectrum need to be increasingly ordered. We thus also check that this
is the case for the provided m/z values. We take here the advantage that
a efficient <code>is.unsorted</code> implementation for
<code>NumericList</code> is already available, which is faster than
e.g. calling <code>vapply(mz(be), is.unsorted, logical(1))</code>.</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">.match_length</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"NumericList"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'value' has to be a list or NumericList"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"lengths of 'value' has to match the number of peaks per spectrum"</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"NumericList"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span><span class="va">value</span>, compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/is.unsorted.html" class="external-link">is.unsorted</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"m/z values need to be increasingly sorted within each spectrum"</span><span class="op">)</span></span>
<span>    <span class="va">object</span><span class="op">@</span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="peaksdata-">
<code>peaksData&lt;-</code><a class="anchor" aria-label="anchor" href="#peaksdata-"></a>
</h4>
<p>The <code>peaksData&lt;-</code> should allow to replace the peaks
data (m/z and intensity values) of all spectra in a backend. In contrast
to the <code>mz&lt;-</code> and <code>intensity&lt;-</code> methods this
method should also support changing the number of peaks per spectrum
(e.g. due to filtering). Parameter <code>value</code> has to be a
<code>list</code> of <code>matrix</code> objects with columns
<code>"mz"</code> and <code>"intensity"</code>. The length of this list
has to match the number of spectra in the backend. In the implementation
for our backend class we need to loop over this list to extract the m/z
and intensity values and assign them to the <code>@mz</code> and
<code>@intensity</code> slots.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"peaksData"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"SimpleList"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'value' has to be a list-like object"</span><span class="op">)</span></span>
<span>    <span class="fu">.match_length</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span></span>
<span>    <span class="va">object</span><span class="op">@</span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"["</span>, , <span class="st">"mz"</span><span class="op">)</span>, compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">object</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">value</span>, <span class="st">"["</span>, , <span class="st">"intensity"</span><span class="op">)</span>,</span>
<span>                                    compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/methods/validObject.html" class="external-link">validObject</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Using the <code>peaksData&lt;-</code> method we can now also for
example remove peaks.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hidden_aliases.html">peaksData</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span>
<span><span class="co">## Remove the first peak from the first spectrum</span></span>
<span><span class="va">pd</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pd</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="fl">1L</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4 2 3</span></span></code></pre>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/hidden_aliases.html">peaksData</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">pd</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3 2 3</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="section-2">
<code>$&lt;-</code><a class="anchor" aria-label="anchor" href="#section-2"></a>
</h4>
<p>The <code>$&lt;-</code> method should allow to replace values for
spectra variables or also to add additional spectra variables to the
backend. As with all replacement methods, the <code>length</code> of
<code>value</code> has to match the number of spectra represented by the
backend.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"$"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">name</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">.match_length</span><span class="op">(</span><span class="va">x</span>, <span class="va">value</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"mz"</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"intensity"</span><span class="op">)</span> <span class="op">{</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">x</span><span class="op">@</span><span class="va">spectraVars</span><span class="op">[[</span><span class="va">name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu">.sv_valid_data_type</span><span class="op">(</span><span class="va">x</span><span class="op">@</span><span class="va">spectraVars</span>, <span class="va">name</span><span class="op">)</span></span>
<span>    <span class="va">x</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We can now replace for example existing spectra variables:</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">msLevel</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 2 2</span></span></code></pre>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">be</span><span class="op">$</span><span class="va">msLevel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">msLevel</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2 1 2</span></span></code></pre>
<p>Or even add new spectra variables.</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">be</span><span class="op">$</span><span class="va">new_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span></span>
<span><span class="va">be</span><span class="op">$</span><span class="va">new_var</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "a" "b" "c"</span></span></code></pre>
<p>Replacement methods for all <em>core</em> spectra variables can be
implemented similarly.</p>
</div>
<div class="section level4">
<h4 id="selectspectravariables">
<code>selectSpectraVariables</code><a class="anchor" aria-label="anchor" href="#selectspectravariables"></a>
</h4>
<p>The <code>selectSpectraVariables</code> should allow to reduce the
information within the backend (parameter <code>object</code>) to the
selected spectra variables (parameter <code>spectraVariables</code>).
This is equivalent to a subset by columns/variables. For core spectra
variables, if not specified by parameter <code>spectraVariables</code>,
only their values are expected to be removed (since core spectra
variables are expected to be available even if they are not defined
within a backend). The implementation for our backend will remove any
columns in the <code>@spectraVars</code> data frame not defined in the
<code>spectraVariables</code> parameter. Special care is given to the
<code>"mz"</code> and <code>"intensity"</code> spectra variables: if
they are not selected, the <code>@mz</code> and <code>@intensity</code>
slots are initialized with empty <code>NumericList</code> (of length
matching the number of spectra). Note also that some backends might
throw an error if a spectra variable required for the backend is removed
(such as <code>"dataStorage"</code> for a <code>MsBackendMzR</code>
backend, which is required by the backend to allow retrieval of m/z and
intensity values).</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span></span>
<span>    <span class="st">"selectSpectraVariables"</span>, <span class="st">"MsBackendTest"</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">spectraVariables</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">spectraVars</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">spectraVariables</span></span>
<span>        <span class="va">object</span><span class="op">@</span><span class="va">spectraVars</span> <span class="op">&lt;-</span> <span class="va">object</span><span class="op">@</span><span class="va">spectraVars</span><span class="op">[</span>, <span class="va">keep</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">spectraVariables</span> <span class="op">==</span> <span class="st">"mz"</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">object</span><span class="op">@</span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                     compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">spectraVariables</span> <span class="op">==</span> <span class="st">"intensity"</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">object</span><span class="op">@</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/IRanges/man/AtomicList-class.html" class="external-link">NumericList</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                            compress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/methods/validObject.html" class="external-link">validObject</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span>        <span class="va">object</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We can now use <code>selectSpectraVariables</code> to remove for
example the spectra variable <code>"new_var"</code> added above.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">be2</span> <span class="op">&lt;-</span> <span class="va">be</span></span>
<span><span class="va">be2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hidden_aliases.html">selectSpectraVariables</a></span><span class="op">(</span><span class="va">be2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"msLevel"</span>, <span class="st">"rtime"</span>, <span class="st">"mz"</span>,</span>
<span>                                     <span class="st">"intensity"</span>, <span class="st">"dataStorage"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">be2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "msLevel"                 "rtime"                  </span></span>
<span><span class="co">##  [3] "acquisitionNum"          "scanIndex"              </span></span>
<span><span class="co">##  [5] "mz"                      "intensity"              </span></span>
<span><span class="co">##  [7] "dataStorage"             "dataOrigin"             </span></span>
<span><span class="co">##  [9] "centroided"              "smoothed"               </span></span>
<span><span class="co">## [11] "polarity"                "precScanNum"            </span></span>
<span><span class="co">## [13] "precursorMz"             "precursorIntensity"     </span></span>
<span><span class="co">## [15] "precursorCharge"         "collisionEnergy"        </span></span>
<span><span class="co">## [17] "isolationWindowLowerMz"  "isolationWindowTargetMz"</span></span>
<span><span class="co">## [19] "isolationWindowUpperMz"</span></span></code></pre>
<p>The spectra variable <code>"new_var"</code> is now no longer be
available. Note however that still <strong>all</strong> core spectra
variables are listed, even if they were not selected with the
<code>spectraVariables</code> parameter. While these variables (such as
<code>"dataOrigin"</code>) are still listed by
<code>spectraVariables(be2)</code>, their actual values have been
removed:</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "&lt;user provided&gt;" "&lt;user provided&gt;" "&lt;user provided&gt;"</span></span></code></pre>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin</a></span><span class="op">(</span><span class="va">be2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA NA NA</span></span></code></pre>
<p>If <code>"mz"</code> and <code>"intensitity"</code> are not selected,
the m/z and intensity values get removed.</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">be2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hidden_aliases.html">selectSpectraVariables</a></span><span class="op">(</span><span class="va">be2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"msLevel"</span>, <span class="st">"rtime"</span>, <span class="st">"dataStorage"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz</a></span><span class="op">(</span><span class="va">be2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] numeric(0)</span></span>
<span><span class="co">## [[2]] numeric(0)</span></span>
<span><span class="co">## [[3]] numeric(0)</span></span></code></pre>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">be2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NumericList of length 3</span></span>
<span><span class="co">## [[1]] numeric(0)</span></span>
<span><span class="co">## [[2]] numeric(0)</span></span>
<span><span class="co">## [[3]] numeric(0)</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="centroided-">
<code>centroided&lt;-</code><a class="anchor" aria-label="anchor" href="#centroided-"></a>
</h4>
<p>Replace the value for the <em>centroided</em> core spectra variable.
The provided data type <strong>must</strong> be a logical. We re-use the
function <code>.sv_valid_data_type</code> which was defined above for
<code>backendInitialize</code> to check for the correct data type of
core spectra variables.</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"centroided"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">@</span><span class="va">spectraVars</span><span class="op">[[</span><span class="st">"centroided"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="fu">.sv_valid_data_type</span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">spectraVars</span>, <span class="st">"centroided"</span><span class="op">)</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, we could also simply re-use the <code>$&lt;-</code>
replacement method above. This would make the whole code base for our
backend cleaner as replacing or adding spectra variables would be
handled in a single central function.</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"centroided"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">centroided</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">centroided</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">centroided</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  TRUE FALSE  TRUE</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="collisionenergy-">
<code>collisionEnergy&lt;-</code><a class="anchor" aria-label="anchor" href="#collisionenergy-"></a>
</h4>
<p>Replace the values for the collision energy. Parameter
<code>value</code> has to be of type <code>numeric</code>.</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"collisionEnergy"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">collisionEnergy</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">collisionEnergy</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="fl">20.0</span>, <span class="fl">20.0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">collisionEnergy</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] NA 20 20</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="dataorigin-">
<code>dataOrigin&lt;-</code><a class="anchor" aria-label="anchor" href="#dataorigin-"></a>
</h4>
<p>Replace the values for the data origin spectra variable. Parameter
<code>value</code> has to be of type <code>character</code>.</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"dataOrigin"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">dataOrigin</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "&lt;user provided&gt;" "&lt;user provided&gt;" "&lt;user provided&gt;"</span></span></code></pre>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"unknown"</span>, <span class="st">"file a"</span>, <span class="st">"file b"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "unknown" "file a"  "file b"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="datastorage-">
<code>dataStorage&lt;-</code><a class="anchor" aria-label="anchor" href="#datastorage-"></a>
</h4>
<p>Replace the values for the data storage spectra variable. Parameter
<code>value</code> has to be of type <code>character</code>. Since our
backend does not really make any use of this spectra variable, we can
accept any character value. For other backends, that for example need to
load data on-the-fly from data files, this spectra variable could be
used to store the name of the data files and hence we would need to
perform some additional checks within this replacement function.</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"dataStorage"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">dataStorage</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;"</span></span></code></pre>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "" "" ""</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="isolationwindowlowermz-">
<code>isolationWindowLowerMz&lt;-</code><a class="anchor" aria-label="anchor" href="#isolationwindowlowermz-"></a>
</h4>
<p>Replace the values for the <em>isolation window lower m/z</em>
spectra variable. Parameter <code>value</code> has to be of type
<code>numeric</code> (<code>NA_real_</code> missing values are
supported, e.g. for MS1 spectra).</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span></span>
<span>    <span class="st">"isolationWindowLowerMz"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">object</span><span class="op">$</span><span class="va">isolationWindowLowerMz</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>        <span class="va">object</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">isolationWindowLowerMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="fl">245.3</span>, <span class="cn">NA_real_</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">isolationWindowLowerMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]    NA 245.3    NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="isolationwindowtargetmz-">
<code>isolationWindowTargetMz&lt;-</code><a class="anchor" aria-label="anchor" href="#isolationwindowtargetmz-"></a>
</h4>
<p>Replace the values for the <em>isolation window target m/z</em>
spectra variable. Parameter <code>value</code> has to be of type
<code>numeric</code> (<code>NA_real_</code> missing values are
supported, e.g. for MS1 spectra).</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span></span>
<span>    <span class="st">"isolationWindowTargetMz"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">object</span><span class="op">$</span><span class="va">isolationWindowTargetMz</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>        <span class="va">object</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">isolationWindowTargetMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="fl">245.4</span>, <span class="cn">NA_real_</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">isolationWindowTargetMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]    NA 245.4    NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="isolationwindowuppermz-">
<code>isolationWindowUpperMz&lt;-</code><a class="anchor" aria-label="anchor" href="#isolationwindowuppermz-"></a>
</h4>
<p>Replace the values for the <em>isolation window upper m/z</em>
spectra variable. Parameter <code>value</code> has to be of type
<code>numeric</code> (<code>NA_real_</code> missing values are
supported, e.g. for MS1 spectra).</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span></span>
<span>    <span class="st">"isolationWindowUpperMz"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">object</span><span class="op">$</span><span class="va">isolationWindowUpperMz</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>        <span class="va">object</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">isolationWindowUpperMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA_real_</span>, <span class="fl">245.5</span>, <span class="cn">NA_real_</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">isolationWindowUpperMz</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]    NA 245.5    NA</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="mslevel-">
<code>msLevel&lt;-</code><a class="anchor" aria-label="anchor" href="#mslevel-"></a>
</h4>
<p>Replace the MS level of spectra in a backend. Parameter
<code>value</code> has to be of type <code>integer</code>. Missing
values (<code>NA_integer_</code>) are supported.</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"msLevel"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">msLevel</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">msLevel</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2 1 2</span></span></code></pre>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">msLevel</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">msLevel</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1 1 2</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="polarity-">
<code>polarity&lt;-</code><a class="anchor" aria-label="anchor" href="#polarity-"></a>
</h4>
<p>Replace the values for the polarity spectra variables. Parameter
<code>value</code> has to be of type <code>integer</code> and should
ideally also use the <em>standard</em> encoding <code>0L</code> and
<code>1L</code> for negative and positive polarity (and
<code>NA_integer</code> for missing). Thus, in our implementation we
also make sure the input parameter contains the expected values
(although this is not a strictly required).</p>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"polarity"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">value</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'polarity' should be encoded as 0L (negative), 1L (positive) "</span>,</span>
<span>             <span class="st">"with missing values being NA_integer_"</span><span class="op">)</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">polarity</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">polarity</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0L</span>, <span class="fl">0L</span>, <span class="fl">0L</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">polarity</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0 0 0</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="rtime-">
<code>rtime&lt;-</code><a class="anchor" aria-label="anchor" href="#rtime-"></a>
</h4>
<p>Replace the retention times for the spectra represented by the
backend. Parameter <code>value</code> must be of type
<code>numeric</code>. Also, although it is not a strict requirement,
retention times should ideally be ordered increasingly <em>per
sample</em> and their unit should be seconds.</p>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">rtime</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1.2 1.3 1.4</span></span></code></pre>
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3.2 3.3 3.4</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="smoothed-">
<code>smoothed&lt;-</code><a class="anchor" aria-label="anchor" href="#smoothed-"></a>
</h4>
<p>Replace the spectra variable <em>smoothed</em> that indicates whether
some data smoothing operation was performed on the spectra. Parameter
<code>value</code> must be of type <code>logical</code>.</p>
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"smoothed"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">$</span><span class="va">smoothed</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">smoothed</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">smoothed</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE TRUE TRUE</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="spectranames-">
<code>spectraNames&lt;-</code><a class="anchor" aria-label="anchor" href="#spectranames-"></a>
</h4>
<p>Replace the names of individual spectras within the backend. Same as
for <code>names</code>, <code>colnames</code> or <code>rownames</code>,
<code>spectraNames</code> are expected to be of type
<code>character</code>. In our backend implementation we store the
spectra names into the <code>rownames</code> of the
<code>@spectraVars</code> data frame.</p>
<div class="sourceCode" id="cb167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/methods/GenericFunctions.html" class="external-link">setReplaceMethod</a></span><span class="op">(</span><span class="st">"spectraNames"</span>, <span class="st">"MsBackendTest"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">object</span><span class="op">@</span><span class="va">spectraVars</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraNames</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraNames</a></span><span class="op">(</span><span class="va">be</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "a" "b" "c"</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="optional-methods">Optional methods<a class="anchor" aria-label="anchor" href="#optional-methods"></a>
</h3>
<p>Default implementations for these methods are available for
<code>MsBackend</code> classes, thus these methods don’t have to be
implemented for each new backend. For some backends, depending on how
the data is represented or accessed within it, different implementations
might however be more efficient.</p>
<div class="section level4">
<h4 id="backendbpparam">
<code>backendBpparam</code><a class="anchor" aria-label="anchor" href="#backendbpparam"></a>
</h4>
<p>The <code>backendBpparam</code> method is supposed to evaluate
whether a provided (or the default) parallel processing setup is
supported by the backend. Backends that do not support parallel
processing should return <code><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam()</a></code> instead.</p>
<p>The default implementation is shown below.</p>
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"backendBpparam"</span>, signature <span class="op">=</span> <span class="st">"MsBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">BPPARAM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">bpparam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="co">## Return SerialParam() instead to disable parallel processing</span></span>
<span>              <span class="va">BPPARAM</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="dropnaspectravariables">
<code>dropNaSpectraVariables</code><a class="anchor" aria-label="anchor" href="#dropnaspectravariables"></a>
</h4>
<p>The <code>dropNaSpectraVariables</code> is supposed to allow removing
all spectra variables from a data set (storage) that contain only
missing values (i.e. where the value of a spectra variable for each
spectrum is <code>NA</code>). This function is intended to reduce memory
requirements of backends such as the <code>MsBackendMzR</code> that load
values from all core spectra variables from the original data files,
even if their values are only <code>NA</code>. Removing these missing
values from the backend can hence reduce the size in memory of a backend
without data loss (because methods extracting core spectra variables are
supposed to always return <code>NA</code> values even if no data is
available for them - in such cases the <code>NA</code> values are
supposed to be created on-the-fly.</p>
<p>The default implementation is shown below.</p>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"dropNaSpectraVariables"</span>, <span class="st">"MsBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">svs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span>    <span class="va">svs</span> <span class="op">&lt;-</span> <span class="va">svs</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">svs</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"intensity"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="va">spd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">spectraData</a></span><span class="op">(</span><span class="va">object</span>, columns <span class="op">=</span> <span class="va">svs</span><span class="op">)</span></span>
<span>    <span class="va">keep</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu">vapply1l</span><span class="op">(</span><span class="va">spd</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/hidden_aliases.html">selectSpectraVariables</a></span><span class="op">(</span><span class="va">object</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">svs</span><span class="op">[</span><span class="va">keep</span><span class="op">]</span>, <span class="st">"mz"</span>, <span class="st">"intensity"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="isreadonly">
<code>isReadOnly</code><a class="anchor" aria-label="anchor" href="#isreadonly"></a>
</h4>
<p><code>isReadOnly</code> is expected to return a
<code>logical(1)</code> with either <code>TRUE</code> or
<code>FALSE</code> indicating whether the backend supports replacing
data or not. The default implementation is shown below.</p>
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"isReadOnly"</span>, <span class="st">"MsBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span><span class="op">@</span><span class="va">readonly</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="peaksvariables">
<code>peaksVariables</code><a class="anchor" aria-label="anchor" href="#peaksvariables"></a>
</h4>
<p>The <code>peaksVariables</code> is expected to return a
<code>character</code> vector with the names of the <em>peaks
variables</em> (i.e. information and properties of individual mass
peaks) available in the backend. The default implementation for
<code>MsBackend</code> returns by default
<code>c("mz", "intensity")</code>. This method should only be
implemented for backends that (eventually) also provide additional peaks
variables. The default implementation is shown below.</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"peaksVariables"</span>, <span class="st">"MsBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"intensity"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="uniquemslevels">
<code>uniqueMsLevels</code><a class="anchor" aria-label="anchor" href="#uniquemslevels"></a>
</h4>
<p>This method should return the unique MS level(s) of all spectra
within the backend. The default implementation is shown below.</p>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"uniqueMsLevels"</span>, <span class="st">"MsBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">msLevel</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>This method thus retrieves first the MS levels of all spectra and
then calls <code>unique</code> on them. Database-based backends might
avoid such an eventually heavy operation by selecting the unique MS
levels directly using an SQL call.</p>
</div>
<div class="section level4">
<h4 id="ioncount">
<code>ionCount</code><a class="anchor" aria-label="anchor" href="#ioncount"></a>
</h4>
<p>The <code>ionCount</code> method should return a <code>numeric</code>
(length equal to the number of spectra represented by the backend) with
the sum of all intensities within each spectrum. For empty spectra
<code>NA_real_</code> should be returned. The method below is the
default implementation of the method.</p>
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"ionCount"</span>, <span class="st">"MsBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">vapply1d</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="va">sum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="iscentroided">
<code>isCentroided</code><a class="anchor" aria-label="anchor" href="#iscentroided"></a>
</h4>
<p>This method should return the information for each spectrum whether
it is <em>centroided</em>. In contrast to the <code>centroided</code>
method a heuristic approach is used. The default implementation is shown
below.</p>
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"isCentroided"</span>, <span class="st">"MsBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">vapply1l</span><span class="op">(</span><span class="fu"><a href="../reference/hidden_aliases.html">peaksData</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="va">.peaks_is_centroided</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="reset">
<code>reset</code><a class="anchor" aria-label="anchor" href="#reset"></a>
</h4>
<p>This is a special method that backends may implement or support, but
don’t necessary have to. This method will be called by the
<code>reset,Spectra</code> method and is supposed to restore the data to
its original state. The default implementation for
<code>MsBackend</code> shown below simply returns the backend as-is. The
<code>MsBackendSql</code> backend from the <em><a href="https://bioconductor.org/packages/3.18/MsBackendSql" class="external-link">MsBackendSql</a></em>
package in contrast re-initializes the data using the data from the
database.</p>
<div class="sourceCode" id="cb177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"reset"</span>, <span class="st">"MsBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">object</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="export">
<code>export</code><a class="anchor" aria-label="anchor" href="#export"></a>
</h4>
<p>This method should <em>export</em> the data from a
<code>MsBackend</code>. The method is called by the
<code>export,Spectra</code> method that passes itself as a second
argument to the function. The <code>export,MsBackend</code>
implementation is thus expected to take a <code>Spectra</code> object as
second argument from which all data should be taken and exported.
Implementation of this method is optional. The implementation of the
method for the <code>MsBackendMzR</code> backend is shown below.</p>
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"export"</span>, <span class="st">"MsBackendMzR"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">x</span>, <span class="va">file</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                                             <span class="va">format</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mzML"</span>, <span class="st">"mzXML"</span><span class="op">)</span>,</span>
<span>                                             <span class="va">copy</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                             <span class="va">BPPARAM</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">bpparam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">file</span> <span class="op">&lt;-</span> <span class="fu">sanitize_file_name</span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span>        <span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep_len</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">l</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">!=</span> <span class="va">l</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Parameter 'file' has to be either of length 1 or "</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">", i.e. 'length(x)'."</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">file</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/bpmapply.html" class="external-link">bpmapply</a></span><span class="op">(</span><span class="va">.write_ms_data_mzR</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/splitAsList.html" class="external-link">split</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">f</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Factor-class.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>,</span>
<span>                    MoreArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>format <span class="op">=</span> <span class="va">format</span>, copy <span class="op">=</span> <span class="va">copy</span><span class="op">)</span>,</span>
<span>                    BPPARAM <span class="op">=</span> <span class="va">BPPARAM</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>See alternatively also the <em><a href="https://bioconductor.org/packages/3.18/MsBackendMgf" class="external-link">MsBackendMgf</a></em>
package for an implementation for the <code>MsBackendMgf</code>
backend.</p>
</div>
<div class="section level4">
<h4 id="split">
<code>split</code><a class="anchor" aria-label="anchor" href="#split"></a>
</h4>
<p>The <code>split</code> method should allow to split a
<code>MsBackend</code> into a <code>list</code> of
<code>MsBackend</code> objects. The default implementation is shown
below.</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"split"</span>, <span class="st">"MsBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">f</span>, <span class="va">drop</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split.default</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">f</span>, drop <span class="op">=</span> <span class="va">drop</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="supportssetbackend">
<code>supportsSetBackend</code><a class="anchor" aria-label="anchor" href="#supportssetbackend"></a>
</h4>
<p>Whether a <code>MsBackend</code> supports the <code>setBackend</code>
method that allows to change the backend of a <code>Spectra</code>
object from one to another backend. To support <code>setBackend</code>
the backend needs to have a parameter <code>data</code> in its
<code>backendInitialize</code> method that allows it to be initialized
with a <code>DataFrame</code> containing the full spectra data. The
default implementation is shown below.</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"supportsSetBackend"</span>, <span class="st">"MsBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="../reference/hidden_aliases.html">isReadOnly</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filterdataorigin">
<code>filterDataOrigin</code><a class="anchor" aria-label="anchor" href="#filterdataorigin"></a>
</h4>
<p>The <code>filter*</code> methods are expected to take a
<code>MsBackend</code> and to subset it based on some criteria. While
also the <code>[</code> method could be used to perform such subset
operation, these methods might allow more efficient ways to subset the
data e.g. by performing the operation within a database with a dedicated
SQL call. A default implementation is available for every filter
function and thus a method needs only to be implemented if the data
storage/representation within a backend would allow a more efficient
operation.</p>
<p>All filter methods are expected to return the subset backend (i.e. an
instance of the same backend class with the same, or less spectra).</p>
<p>The <code>filterDataOrigin</code> should subset the backend to
spectra with their <code>dataOrigin</code> spectra variable matching the
values provided with the <code>dataOrigin</code> parameter. The default
implementation for <code>MsBackend</code> is shown below.</p>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"filterDataOrigin"</span>, <span class="st">"MsBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">dataOrigin</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dataOrigin</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="va">object</span> <span class="op">&lt;-</span> <span class="va">object</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">dataOrigin</span><span class="op">]</span></span>
<span>                  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/is.unsorted.html" class="external-link">is.unsorted</a></span><span class="op">(</span><span class="va">dataOrigin</span><span class="op">)</span><span class="op">)</span></span>
<span>                      <span class="va">object</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="va">dataOrigin</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>                  <span class="kw">else</span> <span class="va">object</span></span>
<span>              <span class="op">}</span> <span class="kw">else</span> <span class="va">object</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filterdatastorage">
<code>filterDataStorage</code><a class="anchor" aria-label="anchor" href="#filterdatastorage"></a>
</h4>
<p>Similar to the <code>filterDataOrigin</code>, the
<code>filterDataStorage</code> should subset a backend to spectra with
their <code>dataStorage</code> spectra variable matching the values
provided with the <code>dataStorage</code> parameter.</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"filterDataStorage"</span>, <span class="st">"MsBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">dataStorage</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dataStorage</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="va">object</span> <span class="op">&lt;-</span> <span class="va">object</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">dataStorage</span><span class="op">]</span></span>
<span>                  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/is.unsorted.html" class="external-link">is.unsorted</a></span><span class="op">(</span><span class="va">dataStorage</span><span class="op">)</span><span class="op">)</span></span>
<span>                      <span class="va">object</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataStorage</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="va">dataStorage</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>                  <span class="kw">else</span> <span class="va">object</span></span>
<span>              <span class="op">}</span> <span class="kw">else</span> <span class="va">object</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filteremptyspectra">
<code>filterEmptySpectra</code><a class="anchor" aria-label="anchor" href="#filteremptyspectra"></a>
</h4>
<p>The <code>filterEmptySpectra</code> should remove all <em>empty</em>
spectra (i.e. spectra without any mass peaks) from the backend. The
method is expected to return the subset backend. The default
implementation for <code>MsBackend</code> is shown below.</p>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"filterEmptySpectra"</span>, <span class="st">"MsBackend"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span>    <span class="va">object</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filterisolationwindow">
<code>filterIsolationWindow</code><a class="anchor" aria-label="anchor" href="#filterisolationwindow"></a>
</h4>
<p>The <code>filterIsolationWindow</code> filters the backend to spectra
with the provided <code>mz</code> value being within their
<code>isolationWindowLowerMz</code> and
<code>isolationWindowUpperMz</code>. The parameter <code>mz</code>
defining this target m/z is expected to be a <code>numeric</code> of
length 1. The default implementation for <code>MsBackend</code> is shown
below.</p>
<div class="sourceCode" id="cb184"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"filterIsolationWindow"</span>, <span class="st">"MsBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">mz</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mz</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mz</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span>                      <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'mz' is expected to be a single m/z value"</span><span class="op">)</span></span>
<span>                  <span class="va">keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">isolationWindowLowerMz</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">mz</span> <span class="op">&amp;</span></span>
<span>                                <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">isolationWindowUpperMz</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">mz</span><span class="op">)</span></span>
<span>                  <span class="va">object</span><span class="op">[</span><span class="va">keep</span><span class="op">]</span></span>
<span>              <span class="op">}</span> <span class="kw">else</span> <span class="va">object</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filtermslevel">
<code>filterMsLevel</code><a class="anchor" aria-label="anchor" href="#filtermslevel"></a>
</h4>
<p>The <code>filterMsLevel</code> method is expected to reduce the
backend to spectra with the provided MS level(s). Parameter
<code>msLevel</code> has to be an <code>integer</code> (any length). The
default implementation for <code>MsBackend</code> is shown below.</p>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"filterMsLevel"</span>, <span class="st">"MsBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">msLevel</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">msLevel</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="va">object</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">msLevel</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">msLevel</span><span class="op">]</span></span>
<span>              <span class="op">}</span> <span class="kw">else</span> <span class="va">object</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filterpolarity">
<code>filterPolarity</code><a class="anchor" aria-label="anchor" href="#filterpolarity"></a>
</h4>
<p>The <code>filterPolarity</code> method is expected to subset the
backend to spectra matching the provided polarity (or polarities).
Parameter <code>polarity</code> has to be an <code>integer</code> (of
any length). The default implementation for <code>MsBackend</code> is
shown below.</p>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"filterPolarity"</span>, <span class="st">"MsBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">polarity</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">polarity</span><span class="op">)</span><span class="op">)</span></span>
<span>                  <span class="va">object</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">polarity</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">polarity</span><span class="op">]</span></span>
<span>              <span class="kw">else</span> <span class="va">object</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filterprecursormzrange">
<code>filterPrecursorMzRange</code><a class="anchor" aria-label="anchor" href="#filterprecursormzrange"></a>
</h4>
<p>The <code>filterPrecursorMzRange</code> method filters the backend to
spectra with their <code>precursorMz</code> being between the provided
m/z range (parameter <code>mz</code>). This method was previously named
<code>filterPrecursorMz</code>. Parameter <code>mz</code> is expected to
be a <code>numeric</code> of length 2 defining the lower and upper limit
of this precursor m/z range. The default implementation for
<code>MsBackend</code> is shown below.</p>
<div class="sourceCode" id="cb187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsCoreUtils" class="external-link">MsCoreUtils</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'MsCoreUtils'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:Spectra':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     bin, smooth</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:ProtGenerics':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     bin, smooth</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     smooth</span></span></code></pre>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"filterPrecursorMzRange"</span>, <span class="st">"MsBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">mz</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mz</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="va">mz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mz</span><span class="op">)</span></span>
<span>                  <span class="va">keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/MsCoreUtils/man/range.html" class="external-link">between</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">precursorMz</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="va">mz</span><span class="op">)</span><span class="op">)</span></span>
<span>                  <span class="va">object</span><span class="op">[</span><span class="va">keep</span><span class="op">]</span></span>
<span>              <span class="op">}</span> <span class="kw">else</span> <span class="va">object</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filterprecursormzvalues">
<code>filterPrecursorMzValues</code><a class="anchor" aria-label="anchor" href="#filterprecursormzvalues"></a>
</h4>
<p>The <code>filterPrecursorMzValues</code> method filters the backend
to spectra with their m/z values matching to the provided m/z value(s).
Parameters <code>ppm</code> and <code>tolerance</code> (both expected to
be <code>numeric</code> of length 1) allow to define the conditions for
the relaxed matching. Parameter <code>mz</code> has to be a
<code>numeric</code> (of any length). The default implementation for
<code>MsBackend</code> is shown below.</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"filterPrecursorMzValues"</span>, <span class="st">"MsBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">mz</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">ppm</span> <span class="op">=</span> <span class="fl">20</span>, <span class="va">tolerance</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mz</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="va">object</span><span class="op">[</span><span class="fu">.values_match_mz</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">precursorMz</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, mz <span class="op">=</span> <span class="va">mz</span>,</span>
<span>                                          ppm <span class="op">=</span> <span class="va">ppm</span>, tolerance <span class="op">=</span> <span class="va">tolerance</span><span class="op">)</span><span class="op">]</span></span>
<span>              <span class="op">}</span> <span class="kw">else</span> <span class="va">object</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The <code>.values_match_mz</code> function used by this function is
defined as:</p>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.values_match_mz</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">mz</span>, <span class="va">ppm</span> <span class="op">=</span> <span class="fl">20</span>, <span class="va">tolerance</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">x</span>, na.last <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>    <span class="va">cmn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MsCoreUtils/man/matching.html" class="external-link">common</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">o</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">mz</span><span class="op">)</span>, tolerance <span class="op">=</span> <span class="va">tolerance</span>, ppm <span class="op">=</span> <span class="va">ppm</span>,</span>
<span>                  duplicates <span class="op">=</span> <span class="st">"keep"</span>, .check <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">o</span><span class="op">[</span><span class="va">cmn</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filterprecursorcharge">
<code>filterPrecursorCharge</code><a class="anchor" aria-label="anchor" href="#filterprecursorcharge"></a>
</h4>
<p>The <code>filterPrecursorCharge</code> method filters the backend to
spectra with matching precursor charge. Parameter <code>z</code>
defining the requested precursor charge has to be an
<code>integer</code> (of any length). The default implementation for
<code>MsBackend</code> is shown below.</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"filterPrecursorCharge"</span>, <span class="st">"MsBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="va">keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">precursorCharge</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">z</span><span class="op">)</span></span>
<span>                  <span class="va">object</span><span class="op">[</span><span class="va">keep</span><span class="op">]</span></span>
<span>              <span class="op">}</span> <span class="kw">else</span> <span class="va">object</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filterprecursorscan">
<code>filterPrecursorScan</code><a class="anchor" aria-label="anchor" href="#filterprecursorscan"></a>
</h4>
<p>The <code>filterPrecursorScan</code> method filters the backend to
parent (e.g. MS1) and children scans (e.g. MS2) of acquisition number
<code>acquisitionNum</code>. Parameter <code>f</code> defines how the
backend should be split (by default by original data file) to avoid
selecting spectra from different samples/files. The default
implementation for <code>MsBackend</code> is shown below.</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"filterPrecursorScan"</span>, <span class="st">"MsBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">acquisitionNum</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">f</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">dataOrigin</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">acquisitionNum</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">is.factor</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span>                      <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">f</span>, exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>                  <span class="va">keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unsplit.html" class="external-link">unsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/splitAsList.html" class="external-link">split</a></span><span class="op">(</span><span class="va">object</span>, f <span class="op">=</span> <span class="va">f</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span>, <span class="va">an</span><span class="op">)</span> <span class="op">{</span></span>
<span>                      <span class="fu">.filterSpectraHierarchy</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">acquisitionNum</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>,</span>
<span>                                              <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">precScanNum</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>,</span>
<span>                                              <span class="va">an</span><span class="op">)</span></span>
<span>                  <span class="op">}</span>, an <span class="op">=</span> <span class="va">acquisitionNum</span><span class="op">)</span>, f <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span>                  <span class="va">object</span><span class="op">[</span><span class="va">keep</span><span class="op">]</span></span>
<span>              <span class="op">}</span> <span class="kw">else</span> <span class="va">object</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filterrt">
<code>filterRt</code><a class="anchor" aria-label="anchor" href="#filterrt"></a>
</h4>
<p>The <code>filterRt</code> method filters the backend to spectra with
their retention time being between the provided rt range. Parameter
<code>rt</code> is expected to be a <code>numeric</code> of length 2
defining the lower and upper bound of this range. Parameter
<code>msLevel.</code> (note the <code>.</code> in the name of the
parameter!) can be optionally used to restrict the filtering to the
selected MS levels (i.e. the RT filter is only applied to spectra of the
selected MS levels and all spectra with a different MS level are
returned as well). The default implementation for <code>MsBackend</code>
is shown below.</p>
<div class="sourceCode" id="cb197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"filterRt"</span>, <span class="st">"MsBackend"</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">rt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">msLevel.</span> <span class="op">=</span> <span class="fu"><a href="../reference/Spectra.html">uniqueMsLevels</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rt</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                  <span class="va">rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">rt</span><span class="op">)</span></span>
<span>                  <span class="va">sel_ms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">msLevel</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">msLevel.</span></span>
<span>                  <span class="va">sel_rt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MsCoreUtils/man/range.html" class="external-link">between</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="va">rt</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">sel_ms</span></span>
<span>                  <span class="va">object</span><span class="op">[</span><span class="va">sel_rt</span> <span class="op">|</span> <span class="op">!</span><span class="va">sel_ms</span><span class="op">]</span></span>
<span>              <span class="op">}</span> <span class="kw">else</span> <span class="va">object</span></span>
<span>          <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="implementation-notes">Implementation notes<a class="anchor" aria-label="anchor" href="#implementation-notes"></a>
</h3>
<p>In this tutorial we implemented a simple <em>in-memory</em>
<code>MsBackend</code> from scratch. For many real-life situation it
might however be better to extend some of the pre-defined backend
classes from the <code>Spectra</code> package to avoid duplicating
functionality. A good starting point might be the
<code>MsBackendMemory</code> backend for any <em>in-memory</em> data
representation, or the <code>MsBackendCached</code> for backends that
retrieve data from inherently read-only resources (such as database
connection or raw data files) but still would need to support adding
spectra variables or changing values of spectra variables. Similarly, if
the only purpose of a backend is to import or export data in a specific
format, the <code>MsBackendMemory</code> might be extended and a single
method (<code>backendInitialize</code>) would need to be implemented for
the new class: this new <code>backendInitialize</code> would then call
the code to import the data from the new file format and store it within
the available slots of the <code>MsBackendMemory</code> object. Examples
would be the backends provided by the <em><a href="https://bioconductor.org/packages/3.18/MsBackendMgf" class="external-link">MsBackendMgf</a></em>
and <em><a href="https://bioconductor.org/packages/3.18/MsBackendMsp" class="external-link">MsBackendMsp</a></em>
classes.</p>
</div>
</div>
<div class="section level2">
<h2 id="testing-the-validity-of-the-backend">Testing the validity of the backend<a class="anchor" aria-label="anchor" href="#testing-the-validity-of-the-backend"></a>
</h2>
<p>The <code>Spectra</code> package provides a set of unit tests that
allow to check a backend for compliance with <code>MsBackend</code>.
Below we load this test suite and call the tests. The tests will be
performed on a variable <code>be</code> in the current workspace (which
in our case is an instance of our <code>MsBackendTest</code> class).</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span>
<span><span class="va">test_suite</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"test_backends"</span>, <span class="st">"test_MsBackend"</span>,</span>
<span>                          package <span class="op">=</span> <span class="st">"Spectra"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_dir.html" class="external-link">test_dir</a></span><span class="op">(</span><span class="va">test_suite</span>, stop_on_failure <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.1 (2023-06-16)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.2 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] MsCoreUtils_1.13.1  IRanges_2.35.2      Spectra_1.11.8     </span></span>
<span><span class="co">## [4] ProtGenerics_1.33.1 BiocParallel_1.35.3 S4Vectors_0.39.1   </span></span>
<span><span class="co">## [7] BiocGenerics_0.47.0 BiocStyle_2.29.1   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] jsonlite_1.8.7        compiler_4.3.1        BiocManager_1.30.22  </span></span>
<span><span class="co">##  [4] stringr_1.5.0         parallel_4.3.1        cluster_2.1.4        </span></span>
<span><span class="co">##  [7] jquerylib_0.1.4       systemfonts_1.0.4     textshaping_0.3.6    </span></span>
<span><span class="co">## [10] yaml_2.3.7            fastmap_1.1.1         R6_2.5.1             </span></span>
<span><span class="co">## [13] knitr_1.43            MASS_7.3-60           bookdown_0.35        </span></span>
<span><span class="co">## [16] desc_1.4.2            rprojroot_2.0.3       bslib_0.5.0          </span></span>
<span><span class="co">## [19] rlang_1.1.1           cachem_1.0.8          stringi_1.7.12       </span></span>
<span><span class="co">## [22] xfun_0.40             fs_1.6.3              sass_0.4.7           </span></span>
<span><span class="co">## [25] memoise_2.0.1         cli_3.6.1             pkgdown_2.0.7.9000   </span></span>
<span><span class="co">## [28] magrittr_2.0.3        digest_0.6.33         MetaboCoreUtils_1.9.0</span></span>
<span><span class="co">## [31] clue_0.3-64           lifecycle_1.0.3       vctrs_0.6.3          </span></span>
<span><span class="co">## [34] evaluate_0.21         glue_1.6.2            codetools_0.2-19     </span></span>
<span><span class="co">## [37] ragg_1.2.5            rmarkdown_2.23        purrr_1.0.1          </span></span>
<span><span class="co">## [40] tools_4.3.1           htmltools_0.5.5</span></span></code></pre>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-gattoMSnbaseEfficientElegant2020a" class="csl-entry">
Gatto, Laurent, Sebastian Gibb, and Johannes Rainer. 2020.
<span>“<span>MSnbase</span>, <span>Efficient</span> and <span>Elegant
R</span>-<span>Based Processing</span> and <span>Visualization</span> of
<span>Raw Mass Spectrometry Data</span>.”</span> <em>Journal of Proteome
Research</em>, September. <a href="https://doi.org/10.1021/acs.jproteome.0c00313" class="external-link">https://doi.org/10.1021/acs.jproteome.0c00313</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by RforMassSpectrometry Package Maintainer, Laurent Gatto, Johannes Rainer, Sebastian Gibb.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
