<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Merging, aggregating and splitting Spectra — concatenateSpectra • Spectra</title><!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Merging, aggregating and splitting Spectra — concatenateSpectra"><meta name="description" content="Various functions are availabe to combine, aggregate or split data from one
of more Spectra objects. These are:
c() and concatenateSpectra(): combines several Spectra objects into
a single object. The resulting Spectra contains all data from all
individual Spectra, i.e. the union of all their spectra variables.
Concatenation will fail if the processing queue of any of the Spectra
objects is not empty or if different backends are used for the Spectra
objects. In such cases it is suggested to first change the backends of
all Spectra to the same type of backend (using the setBackend()
function and to eventually (if needed) apply the processing queue using
the applyProcessing() function.
cbind2(): Appends multiple spectra variables from a data.frame,
DataFrame or matrix to the Spectra object at once. The order of
the values (rows) in y has to match the order of spectra in x. The
function does not allow to replace existing spectra variables. cbind2()
returns a Spectra object with the appended spectra variables. For a more
controlled way of adding spectra variables, see the joinSpectraData()
function.
combineSpectra(): combines sets of spectra (defined with parameter f)
into a single spectrum per set aggregating their MS data (i.e. their
peaks data matrices with the m/z and intensity values of their
mass peaks). The spectra variable values of the first spectrum per set
are reported for the combined spectrum. The peak matrices of the spectra
per set are combined using the function specified with parameter FUN
which uses by default the combinePeaksData() function. See the
documentation of combinePeaksData() for details on the aggregation of
the peak data and the package vignette for examples.
The sets of spectra can be specified with parameter f which is expected
to be a factor or vector of length equal to the length of the
Spectra specifying to which set a spectrum belongs to. The function
returns a Spectra of length equal to the unique levels of f. The
optional parameter p allows to define how the Spectra should be
split for potential parallel processing. The default is
p = x$dataStorage and hence a per storage file parallel processing is
applied for Spectra with on disk data representations (such as the
MsBackendMzR()). This also prevents that spectra from different data
files/samples are combined (eventually use e.g. p = x$dataOrigin or any
other spectra variables defining the originating samples for a spectrum).
Before combining the peaks data, all eventual present processing steps are
applied (by calling applyProcessing() on the Spectra). This function
will replace the original m/z and intensity values of a Spectra hence
it can not be called on a Spectra with a read-only backend. In such
cases, the backend should be changed to a writeable backend before
using the setBackend() function (to e.g. a MsBackendMemory() backend).
joinSpectraData(): Individual spectra variables can be directly
added with the $&amp;lt;- or [[&amp;lt;- syntax. The joinSpectraData()
function allows to merge a DataFrame to the existing spectra
data of a Spectra. This function diverges from the merge() method in
two main ways:
The by.x and by.y column names must be of length 1.
If variable names are shared in x and y, the spectra
variables of x are not modified. It's only the y
variables that are appended with the suffix defined in
suffix.y. This is to avoid modifying any core spectra
variables that would lead to an invalid object.
Duplicated Spectra keys (i.e. x[[by.x]]) are not
allowed. Duplicated keys in the DataFrame (i.e y[[by.y]])
throw a warning and only the last occurrence is kept. These
should be explored and ideally be removed using for
QFeatures::reduceDataFrame(), PMS::reducePSMs() or similar
functions.
For a more general function that allows to append data.frame,
DataFrame and matrix see cbind2().

split(): splits the Spectra object based on parameter f into a list
of Spectra objects.

"><meta property="og:description" content="Various functions are availabe to combine, aggregate or split data from one
of more Spectra objects. These are:
c() and concatenateSpectra(): combines several Spectra objects into
a single object. The resulting Spectra contains all data from all
individual Spectra, i.e. the union of all their spectra variables.
Concatenation will fail if the processing queue of any of the Spectra
objects is not empty or if different backends are used for the Spectra
objects. In such cases it is suggested to first change the backends of
all Spectra to the same type of backend (using the setBackend()
function and to eventually (if needed) apply the processing queue using
the applyProcessing() function.
cbind2(): Appends multiple spectra variables from a data.frame,
DataFrame or matrix to the Spectra object at once. The order of
the values (rows) in y has to match the order of spectra in x. The
function does not allow to replace existing spectra variables. cbind2()
returns a Spectra object with the appended spectra variables. For a more
controlled way of adding spectra variables, see the joinSpectraData()
function.
combineSpectra(): combines sets of spectra (defined with parameter f)
into a single spectrum per set aggregating their MS data (i.e. their
peaks data matrices with the m/z and intensity values of their
mass peaks). The spectra variable values of the first spectrum per set
are reported for the combined spectrum. The peak matrices of the spectra
per set are combined using the function specified with parameter FUN
which uses by default the combinePeaksData() function. See the
documentation of combinePeaksData() for details on the aggregation of
the peak data and the package vignette for examples.
The sets of spectra can be specified with parameter f which is expected
to be a factor or vector of length equal to the length of the
Spectra specifying to which set a spectrum belongs to. The function
returns a Spectra of length equal to the unique levels of f. The
optional parameter p allows to define how the Spectra should be
split for potential parallel processing. The default is
p = x$dataStorage and hence a per storage file parallel processing is
applied for Spectra with on disk data representations (such as the
MsBackendMzR()). This also prevents that spectra from different data
files/samples are combined (eventually use e.g. p = x$dataOrigin or any
other spectra variables defining the originating samples for a spectrum).
Before combining the peaks data, all eventual present processing steps are
applied (by calling applyProcessing() on the Spectra). This function
will replace the original m/z and intensity values of a Spectra hence
it can not be called on a Spectra with a read-only backend. In such
cases, the backend should be changed to a writeable backend before
using the setBackend() function (to e.g. a MsBackendMemory() backend).
joinSpectraData(): Individual spectra variables can be directly
added with the $&amp;lt;- or [[&amp;lt;- syntax. The joinSpectraData()
function allows to merge a DataFrame to the existing spectra
data of a Spectra. This function diverges from the merge() method in
two main ways:
The by.x and by.y column names must be of length 1.
If variable names are shared in x and y, the spectra
variables of x are not modified. It's only the y
variables that are appended with the suffix defined in
suffix.y. This is to avoid modifying any core spectra
variables that would lead to an invalid object.
Duplicated Spectra keys (i.e. x[[by.x]]) are not
allowed. Duplicated keys in the DataFrame (i.e y[[by.y]])
throw a warning and only the last occurrence is kept. These
should be explored and ideally be removed using for
QFeatures::reduceDataFrame(), PMS::reducePSMs() or similar
functions.
For a more general function that allows to append data.frame,
DataFrame and matrix see cbind2().

split(): splits the Spectra object based on parameter f into a list
of Spectra objects.

"><meta property="og:image" content="https://rformassspectrometry.github.io/Spectra/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Spectra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.17.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/Spectra.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/MsBackend.html">Creating new `MsBackend` classes</a></li>
    <li><a class="dropdown-item" href="../articles/Spectra-large-scale.html">Large-scale data handling and processing with Spectra</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/Spectra/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Merging, aggregating and splitting Spectra</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/Spectra/blob/main/R/Spectra-functions.R" class="external-link"><code>R/Spectra-functions.R</code></a>, <a href="https://github.com/RforMassSpectrometry/Spectra/blob/main/R/Spectra.R" class="external-link"><code>R/Spectra.R</code></a></small>
      <div class="d-none name"><code>combineSpectra.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Various functions are availabe to combine, aggregate or split data from one
of more <code>Spectra</code> objects. These are:</p><ul><li><p><code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> and <code>concatenateSpectra()</code>: combines several <code>Spectra</code> objects into
a single object. The resulting <code>Spectra</code> contains all data from all
individual <code>Spectra</code>, i.e. the union of all their spectra variables.
Concatenation will fail if the processing queue of any of the <code>Spectra</code>
objects is not empty or if different backends are used for the <code>Spectra</code>
objects. In such cases it is suggested to first change the backends of
all <code>Spectra</code> to the same type of backend (using the <code><a href="Spectra.html">setBackend()</a></code>
function and to eventually (if needed) apply the processing queue using
the <code><a href="addProcessing.html">applyProcessing()</a></code> function.</p></li>
<li><p><code>cbind2()</code>: Appends multiple spectra variables from a <code>data.frame</code>,
<code>DataFrame</code> or <code>matrix</code> to the <code>Spectra</code> object at once. The order of
the values (rows) in <code>y</code> has to match the order of spectra in <code>x</code>. The
function does not allow to replace existing spectra variables. <code>cbind2()</code>
returns a <code>Spectra</code> object with the appended spectra variables. For a more
controlled way of adding spectra variables, see the <code>joinSpectraData()</code>
function.</p></li>
<li><p><code>combineSpectra()</code>: combines sets of spectra (defined with parameter <code>f</code>)
into a single spectrum per set aggregating their MS data (i.e. their
<em>peaks data</em> matrices with the <em>m/z</em> and intensity values of their
mass peaks). The spectra variable values of the first spectrum per set
are reported for the combined spectrum. The peak matrices of the spectra
per set are combined using the function specified with parameter <code>FUN</code>
which uses by default the <code><a href="combinePeaksData.html">combinePeaksData()</a></code> function. See the
documentation of <code><a href="combinePeaksData.html">combinePeaksData()</a></code> for details on the aggregation of
the peak data and the package vignette for examples.
The sets of spectra can be specified with parameter <code>f</code> which is expected
to be a <code>factor</code> or <code>vector</code> of length equal to the length of the
<code>Spectra</code> specifying to which set a spectrum belongs to. The function
returns a <code>Spectra</code> of length equal to the unique levels of <code>f</code>. The
optional parameter <code>p</code> allows to define how the <code>Spectra</code> should be
split for potential parallel processing. The default is
<code>p = x$dataStorage</code> and hence a per storage file parallel processing is
applied for <code>Spectra</code> with on disk data representations (such as the
<code><a href="MsBackend.html">MsBackendMzR()</a></code>). This also prevents that spectra from different data
files/samples are combined (eventually use e.g. <code>p = x$dataOrigin</code> or any
other spectra variables defining the originating samples for a spectrum).
Before combining the peaks data, all eventual present processing steps are
applied (by calling <code><a href="addProcessing.html">applyProcessing()</a></code> on the <code>Spectra</code>). This function
will replace the original <em>m/z</em> and intensity values of a <code>Spectra</code> hence
it can not be called on a <code>Spectra</code> with a <em>read-only</em> backend. In such
cases, the backend should be changed to a <em>writeable</em> backend before
using the <code><a href="Spectra.html">setBackend()</a></code> function (to e.g. a <code><a href="MsBackend.html">MsBackendMemory()</a></code> backend).</p></li>
<li><p><code>joinSpectraData()</code>: Individual spectra variables can be directly
added with the <code>$&lt;-</code> or <code>[[&lt;-</code> syntax. The <code>joinSpectraData()</code>
function allows to merge a <code>DataFrame</code> to the existing spectra
data of a <code>Spectra</code>. This function diverges from the <code><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge()</a></code> method in
two main ways:</p><ul><li><p>The <code>by.x</code> and <code>by.y</code> column names must be of length 1.</p></li>
<li><p>If variable names are shared in <code>x</code> and <code>y</code>, the spectra
variables of <code>x</code> are not modified. It's only the <code>y</code>
variables that are appended with the suffix defined in
<code>suffix.y</code>. This is to avoid modifying any core spectra
variables that would lead to an invalid object.</p></li>
<li><p>Duplicated Spectra keys (i.e. <code>x[[by.x]]</code>) are not
allowed. Duplicated keys in the <code>DataFrame</code> (i.e <code>y[[by.y]]</code>)
throw a warning and only the last occurrence is kept. These
should be explored and ideally be removed using for
<code>QFeatures::reduceDataFrame()</code>, <code>PMS::reducePSMs()</code> or similar
functions.
For a more general function that allows to append <code>data.frame</code>,
<code>DataFrame</code> and <code>matrix</code> see <code>cbind2()</code>.</p></li>
</ul></li>
<li><p><code>split()</code>: splits the <code>Spectra</code> object based on parameter <code>f</code> into a <code>list</code>
of <code>Spectra</code> objects.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">concatenateSpectra</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">combineSpectra</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  f <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">dataStorage</span>,</span>
<span>  p <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">dataStorage</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">combinePeaksData</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  BPPARAM <span class="op">=</span> <span class="fu">bpparam</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">joinSpectraData</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, by.x <span class="op">=</span> <span class="st">"spectrumId"</span>, <span class="va">by.y</span>, suffix.y <span class="op">=</span> <span class="st">".y"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra,dataframeOrDataFrameOrmatrix'</span></span>
<span><span class="fu">cbind2</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra,ANY'</span></span>
<span><span class="fu">split</span><span class="op">(</span><span class="va">x</span>, <span class="va">f</span>, drop <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A <code>Spectra</code> object.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments.</p></dd>


<dt id="arg-f">f<a class="anchor" aria-label="anchor" href="#arg-f"></a></dt>
<dd><p>For <code>split()</code>: factor defining how to split <code>x</code>. See <code><a href="https://rdrr.io/r/base/split.html" class="external-link">base::split()</a></code>
for details.
For <code>combineSpectra()</code>: <code>factor</code> defining the grouping of the spectra
that should be combined. Defaults to <code>x$dataStorage</code>.</p></dd>


<dt id="arg-p">p<a class="anchor" aria-label="anchor" href="#arg-p"></a></dt>
<dd><p>For <code>combineSpectra()</code>: <code>factor</code> defining how to split the input
<code>Spectra</code> for parallel processing. Defaults to <code>x$dataStorage</code>, i.e.,
depending on the used backend, per-file parallel processing will be
performed.</p></dd>


<dt id="arg-fun">FUN<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>For <code>combineSpectra()</code>: function to combine the (peak matrices)
of the spectra. Defaults to <code><a href="combinePeaksData.html">combinePeaksData()</a></code>.</p></dd>


<dt id="arg-bpparam">BPPARAM<a class="anchor" aria-label="anchor" href="#arg-bpparam"></a></dt>
<dd><p>Parallel setup configuration. See <code><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">BiocParallel::bpparam()</a></code>
for more information. This is passed directly to the
<code><a href="MsBackend.html">backendInitialize()</a></code> method of the <a href="MsBackend.html">MsBackend</a>.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>For <code>joinSpectraData()</code>: <code>DataFrame</code> with the spectra variables
to join/add. For <code>cbind2()</code>: a <code>data.frame</code>, <code>DataFrame</code> or
<code>matrix</code>. The number of rows and their order has to match the
number of spectra in <code>x</code>, respectively their order.</p></dd>


<dt id="arg-by-x">by.x<a class="anchor" aria-label="anchor" href="#arg-by-x"></a></dt>
<dd><p>A <code>character(1)</code> specifying the spectra variable used
for merging. Default is <code>"spectrumId"</code>.</p></dd>


<dt id="arg-by-y">by.y<a class="anchor" aria-label="anchor" href="#arg-by-y"></a></dt>
<dd><p>A <code>character(1)</code> specifying the column used for
merging. Set to <code>by.x</code> if missing.</p></dd>


<dt id="arg-suffix-y">suffix.y<a class="anchor" aria-label="anchor" href="#arg-suffix-y"></a></dt>
<dd><p>A <code>character(1)</code> specifying the suffix to be used
for making the names of columns in the merged spectra variables
unique. This suffix will be used to amend <code>names(y)</code>, while
<code>spectraVariables(x)</code> will remain unchanged.</p></dd>


<dt id="arg-drop">drop<a class="anchor" aria-label="anchor" href="#arg-drop"></a></dt>
<dd><p>For <code>split()</code>: not considered.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p><code><a href="combinePeaks.html">combinePeaks()</a></code> for functions to aggregate mass peaks data.</p></li>
<li><p><a href="Spectra.html">Spectra</a> for a general description of the <code>Spectra</code> object.</p></li>
</ul></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sebastian Gibb, Johannes Rainer, Laurent Gatto</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create a Spectra providing a `DataFrame` containing a MS data.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">spd</span> <span class="op">&lt;-</span> <span class="fu">DataFrame</span><span class="op">(</span>msLevel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span>, rtime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spd</span><span class="op">$</span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">103.2</span>, <span class="fl">104.3</span>, <span class="fl">106.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">45.6</span>, <span class="fl">120.4</span>, <span class="fl">190.2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spd</span><span class="op">$</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">400</span>, <span class="fl">34.2</span>, <span class="fl">17</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.3</span>, <span class="fl">15.2</span>, <span class="fl">6.8</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="Spectra.html">Spectra</a></span><span class="op">(</span><span class="va">spd</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 2 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1       1.1        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         2       1.2        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 16 more variables/columns.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create a second Spectra from mzML files and use the `MsBackendMzR`</span></span></span>
<span class="r-in"><span><span class="co">## on-disk backend.</span></span></span>
<span class="r-in"><span><span class="va">sciex_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sciex"</span>, package <span class="op">=</span> <span class="st">"msdata"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sciex</span> <span class="op">&lt;-</span> <span class="fu"><a href="Spectra.html">Spectra</a></span><span class="op">(</span><span class="va">sciex_file</span>, backend <span class="op">=</span> <span class="fu"><a href="MsBackend.html">MsBackendMzR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sciex</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 1862 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            1     0.280         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            1     0.559         2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            1     0.838         3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            1     1.117         4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            1     1.396         5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...        ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1858         1   258.636       927</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1859         1   258.915       928</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1860         1   259.194       929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1861         1   259.473       930</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1862         1   259.752       931</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20171016_POOL_POS_1_105-134.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20171016_POOL_POS_3_105-134.mzML</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Subset to the first 100 spectra to reduce running time of the examples</span></span></span>
<span class="r-in"><span><span class="va">sciex</span> <span class="op">&lt;-</span> <span class="va">sciex</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##  --------  COMBINE SPECTRA  --------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Combining the `Spectra` object `s` with the MS data from `sciex`.</span></span></span>
<span class="r-in"><span><span class="co">## Calling directly `c(s, sciex)` would result in an error because</span></span></span>
<span class="r-in"><span><span class="co">## both backends use a different backend. We thus have to first change</span></span></span>
<span class="r-in"><span><span class="co">## the backends to the same backend. We change the backend of the `sciex`</span></span></span>
<span class="r-in"><span><span class="co">## `Spectra` to a `MsBackendMemory`, the backend used by `s`.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sciex</span> <span class="op">&lt;-</span> <span class="fu"><a href="Spectra.html">setBackend</a></span><span class="op">(</span><span class="va">sciex</span>, <span class="fu"><a href="MsBackend.html">MsBackendMemory</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Combine the two `Spectra`</span></span></span>
<span class="r-in"><span><span class="va">all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">sciex</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">all</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 102 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           1     1.100        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           2     1.200        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           1     0.280         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           1     0.559         2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           1     0.838         3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...       ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 98          1    26.786        96</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 99          1    27.065        97</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 100         1    27.344        98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 101         1    27.623        99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 102         1    27.902       100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Switch backend from MsBackendMzR to MsBackendMemory [Fri Feb 21 11:11:19 2025]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Merge 2 Spectra into one [Fri Feb 21 11:11:19 2025] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The new `Spectra` objects contains the union of spectra variables from</span></span></span>
<span class="r-in"><span><span class="co">## both:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="spectraData.html">spectraVariables</a></span><span class="op">(</span><span class="va">all</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "msLevel"                  "rtime"                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3] "acquisitionNum"           "scanIndex"               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5] "dataStorage"              "dataOrigin"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "centroided"               "smoothed"                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] "polarity"                 "precScanNum"             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] "precursorMz"              "precursorIntensity"      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "precursorCharge"          "collisionEnergy"         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15] "isolationWindowLowerMz"   "isolationWindowTargetMz" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17] "isolationWindowUpperMz"   "peaksCount"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] "totIonCurrent"            "basePeakMZ"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21] "basePeakIntensity"        "ionisationEnergy"        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [23] "lowMZ"                    "highMZ"                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] "mergedScan"               "mergedResultScanNum"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [27] "mergedResultStartScanNum" "mergedResultEndScanNum"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [29] "injectionTime"            "filterString"            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] "spectrumId"               "ionMobilityDriftTime"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [33] "scanWindowLowerLimit"     "scanWindowUpperLimit"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [35] "electronBeamEnergy"      </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The spectra variables that were not present in `s`:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="spectraData.html">spectraVariables</a></span><span class="op">(</span><span class="va">all</span><span class="op">)</span>, <span class="fu"><a href="spectraData.html">spectraVariables</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "peaksCount"               "totIonCurrent"           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3] "basePeakMZ"               "basePeakIntensity"       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5] "ionisationEnergy"         "lowMZ"                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "highMZ"                   "mergedScan"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] "mergedResultScanNum"      "mergedResultStartScanNum"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] "mergedResultEndScanNum"   "injectionTime"           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "filterString"             "spectrumId"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15] "ionMobilityDriftTime"     "scanWindowLowerLimit"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17] "scanWindowUpperLimit"     "electronBeamEnergy"      </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The values for these were filled with missing values for spectra from</span></span></span>
<span class="r-in"><span><span class="co">## `s`:</span></span></span>
<span class="r-in"><span><span class="va">all</span><span class="op">$</span><span class="va">peaksCount</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]   NA   NA  578 1529 1600 1664</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##  --------  AGGREGATE SPECTRA  --------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Sets of spectra can be combined into a single, representative spectrum</span></span></span>
<span class="r-in"><span><span class="co">## per set using `combineSpectra()`. This aggregates the peaks data (i.e.</span></span></span>
<span class="r-in"><span><span class="co">## the spectra's m/z and intensity values) while using the values for all</span></span></span>
<span class="r-in"><span><span class="co">## spectra variables from the first spectrum per set. Below we define the</span></span></span>
<span class="r-in"><span><span class="co">## sets as all spectra measured in the *same second*, i.e. rounding their</span></span></span>
<span class="r-in"><span><span class="co">## retention time to the next closer integer value.</span></span></span>
<span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="spectraData.html">rtime</a></span><span class="op">(</span><span class="va">sciex</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0 1 1 1 1 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cmp</span> <span class="op">&lt;-</span> <span class="fu">combineSpectra</span><span class="op">(</span><span class="va">sciex</span>, f <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The length of `cmp` is now equal to the length of unique levels in `f`:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cmp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 29</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The spectra variable value from the first spectrum per set is used in</span></span></span>
<span class="r-in"><span><span class="co">## the representative/combined spectrum:</span></span></span>
<span class="r-in"><span><span class="va">cmp</span><span class="op">$</span><span class="va">rtime</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  0.280  0.559  1.675  2.512  3.628  4.744  5.581  6.697  7.534  8.650</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11]  9.766 10.603 11.719 12.556 13.672 14.509 15.625 16.741 17.578 18.694</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21] 19.531 20.647 21.763 22.601 23.717 24.554 25.670 26.507 27.623</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The peaks data was aggregated: the number of mass peaks of the first six</span></span></span>
<span class="r-in"><span><span class="co">## spectra from the original `Spectra`:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="spectraData.html">lengths</a></span><span class="op">(</span><span class="va">sciex</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  578 1529 1600 1664 1417 1602</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## and for the first aggreagated spectra:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="spectraData.html">lengths</a></span><span class="op">(</span><span class="va">cmp</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  578 3928 3177 3597 3928 3190</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The default peaks data aggregation method joins all mass peaks. See</span></span></span>
<span class="r-in"><span><span class="co">## documentation of the `combinePeaksData()` function for more options.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##  --------  SPLITTING DATA  --------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## A `Spectra` can be split into a `list` of `Spectra` objects using the</span></span></span>
<span class="r-in"><span><span class="co">## `split()` function defining the sets into which the `Spectra` should</span></span></span>
<span class="r-in"><span><span class="co">## be splitted into with parameter `f`.</span></span></span>
<span class="r-in"><span><span class="va">sciex_split</span> <span class="op">&lt;-</span> <span class="fu">split</span><span class="op">(</span><span class="va">sciex</span>, <span class="va">f</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sciex_split</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 29</span>
<span class="r-in"><span><span class="va">sciex_split</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $`0`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 1 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1      0.28         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Switch backend from MsBackendMzR to MsBackendMemory [Fri Feb 21 11:11:19 2025] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $`1`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 4 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1     0.559         2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         1     0.838         3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         1     1.117         4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         1     1.396         5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Switch backend from MsBackendMzR to MsBackendMemory [Fri Feb 21 11:11:19 2025] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $`2`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 3 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1     1.675         6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         1     1.954         7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         1     2.233         8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Switch backend from MsBackendMzR to MsBackendMemory [Fri Feb 21 11:11:19 2025] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $`3`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 4 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1     2.512         9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         1     2.791        10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         1     3.070        11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         1     3.349        12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Switch backend from MsBackendMzR to MsBackendMemory [Fri Feb 21 11:11:19 2025] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $`4`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 4 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1     3.628        13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         1     3.907        14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         1     4.186        15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         1     4.465        16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Switch backend from MsBackendMzR to MsBackendMemory [Fri Feb 21 11:11:19 2025] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $`5`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 3 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1     4.744        17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         1     5.023        18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         1     5.302        19</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Switch backend from MsBackendMzR to MsBackendMemory [Fri Feb 21 11:11:19 2025] </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##  --------  ADDING SPECTRA DATA  --------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Adding new spectra variables</span></span></span>
<span class="r-in"><span><span class="va">sciex1</span> <span class="op">&lt;-</span> <span class="fu"><a href="filterMsLevel.html">filterDataOrigin</a></span><span class="op">(</span><span class="va">sciex</span>, <span class="fu"><a href="spectraData.html">dataOrigin</a></span><span class="op">(</span><span class="va">sciex</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spv</span> <span class="op">&lt;-</span> <span class="fu">DataFrame</span><span class="op">(</span>spectrumId <span class="op">=</span> <span class="va">sciex1</span><span class="op">$</span><span class="va">spectrumId</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span>, <span class="co">## used for merging</span></span></span>
<span class="r-in"><span>                 var1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 var2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">letters</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spv</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 10 rows and 3 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                spectrumId       var1        var2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               &lt;character&gt;  &lt;numeric&gt; &lt;character&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  sample=1 period=1 cy.. -0.8468964           p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  sample=1 period=1 cy..  1.1970777           o</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  sample=1 period=1 cy.. -0.5486274           r</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  sample=1 period=1 cy..  0.3030457           q</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  sample=1 period=1 cy.. -0.0569705           z</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  sample=1 period=1 cy.. -0.9578494           e</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  sample=1 period=1 cy..  0.5910619           c</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  sample=1 period=1 cy..  0.1731049           f</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  sample=1 period=1 cy..  1.3997834           k</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 sample=1 period=1 cy..  0.1174596           x</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sciex2</span> <span class="op">&lt;-</span> <span class="fu">joinSpectraData</span><span class="op">(</span><span class="va">sciex1</span>, <span class="va">spv</span>, by.y <span class="op">=</span> <span class="st">"spectrumId"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="spectraData.html">spectraVariables</a></span><span class="op">(</span><span class="va">sciex2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "msLevel"                  "rtime"                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3] "acquisitionNum"           "scanIndex"               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5] "dataStorage"              "dataOrigin"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "centroided"               "smoothed"                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] "polarity"                 "precScanNum"             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] "precursorMz"              "precursorIntensity"      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "precursorCharge"          "collisionEnergy"         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15] "isolationWindowLowerMz"   "isolationWindowTargetMz" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17] "isolationWindowUpperMz"   "peaksCount"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] "totIonCurrent"            "basePeakMZ"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21] "basePeakIntensity"        "ionisationEnergy"        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [23] "lowMZ"                    "highMZ"                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] "mergedScan"               "mergedResultScanNum"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [27] "mergedResultStartScanNum" "mergedResultEndScanNum"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [29] "injectionTime"            "filterString"            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] "spectrumId"               "ionMobilityDriftTime"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [33] "scanWindowLowerLimit"     "scanWindowUpperLimit"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [35] "electronBeamEnergy"       "var1"                    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [37] "var2"                    </span>
<span class="r-in"><span><span class="fu"><a href="spectraData.html">spectraData</a></span><span class="op">(</span><span class="va">sciex2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">13</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spectrumId"</span>, <span class="st">"var1"</span>, <span class="st">"var2"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 13 rows and 3 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 spectrumId      var1        var2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                &lt;character&gt; &lt;numeric&gt; &lt;character&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   sample=1 period=1 cy..        NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   sample=1 period=1 cy..        NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   sample=1 period=1 cy.. -0.846896           p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   sample=1 period=1 cy..  1.197078           o</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   sample=1 period=1 cy.. -0.548627           r</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...                    ...       ...         ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9   sample=1 period=1 cy..  0.591062           c</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10  sample=1 period=1 cy..  0.173105           f</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11  sample=1 period=1 cy..  1.399783           k</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12  sample=1 period=1 cy..  0.117460           x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13  sample=1 period=1 cy..        NA          NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Append new spectra variables with cbind2()</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>cola <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sciex1</span><span class="op">)</span><span class="op">)</span>, colb <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data_append</span> <span class="op">&lt;-</span> <span class="fu">cbind2</span><span class="op">(</span><span class="va">sciex1</span>, <span class="va">df</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by RforMassSpectrometry Package Maintainer, Laurent Gatto, Johannes Rainer, Sebastian Gibb, Philippine Louail.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

