<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Spectra similarity calculations — compareSpectra • Spectra</title><!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spectra similarity calculations — compareSpectra"><meta name="description" content="compareSpectra() compares each spectrum in x with each spectrum in y
using the function provided with FUN (defaults to
MsCoreUtils::ndotproduct()). If y is missing, each spectrum in x is
compared with each other spectrum in x.
The matching/mapping of peaks between the compared spectra is done with the
MAPFUN function. The default joinPeaks() matches peaks of both spectra
and allows to keep all peaks from the first spectrum (type = &quot;left&quot;),
from the second (type = &quot;right&quot;), from both (type = &quot;outer&quot;) and to
keep only matching peaks (type = &quot;inner&quot;); see joinPeaks() for more
information and examples). The MAPFUN function should have parameters
x, y, xPrecursorMz and yPrecursorMz as these values are passed to
the function.
In addition to joinPeaks() also joinPeaksGnps() is supported for
GNPS-like similarity score calculations. Note that joinPeaksGnps() should
only be used in combination with FUN = MsCoreUtils::gnps
(see joinPeaksGnps() for more information and details). Use
MAPFUN = joinPeaksNone to disable internal peak matching/mapping if a
similarity scoring function is used that performs the matching internally.
FUN is supposed to be a function to compare intensities of (matched)
peaks of the two spectra that are compared. The function needs to take two
matrices with columns &quot;mz&quot; and &quot;intensity&quot; as input and is supposed
to return a single numeric as result. In addition to the two peak matrices
the spectra's precursor m/z values are passed to the function as parameters
xPrecursorMz (precursor m/z of the x peak matrix) and yPrecursorMz
(precursor m/z of the y peak matrix). Additional parameters to functions
FUN and MAPFUN can be passed with .... Parameters ppm and
tolerance are passed to both MAPFUN and FUN.
The function returns a matrix with the results of FUN for each
comparison, number of rows equal to length(x) and number of columns
equal length(y) (i.e. element in row 2 and column 3 is the result from
the comparison of x[2] with y[3]). If SIMPLIFY = TRUE the matrix
is simplified to a numeric if length of x or y is one. See also
the vignette for additional examples, such as using spectral entropy
similarity in the scoring."><meta property="og:description" content="compareSpectra() compares each spectrum in x with each spectrum in y
using the function provided with FUN (defaults to
MsCoreUtils::ndotproduct()). If y is missing, each spectrum in x is
compared with each other spectrum in x.
The matching/mapping of peaks between the compared spectra is done with the
MAPFUN function. The default joinPeaks() matches peaks of both spectra
and allows to keep all peaks from the first spectrum (type = &quot;left&quot;),
from the second (type = &quot;right&quot;), from both (type = &quot;outer&quot;) and to
keep only matching peaks (type = &quot;inner&quot;); see joinPeaks() for more
information and examples). The MAPFUN function should have parameters
x, y, xPrecursorMz and yPrecursorMz as these values are passed to
the function.
In addition to joinPeaks() also joinPeaksGnps() is supported for
GNPS-like similarity score calculations. Note that joinPeaksGnps() should
only be used in combination with FUN = MsCoreUtils::gnps
(see joinPeaksGnps() for more information and details). Use
MAPFUN = joinPeaksNone to disable internal peak matching/mapping if a
similarity scoring function is used that performs the matching internally.
FUN is supposed to be a function to compare intensities of (matched)
peaks of the two spectra that are compared. The function needs to take two
matrices with columns &quot;mz&quot; and &quot;intensity&quot; as input and is supposed
to return a single numeric as result. In addition to the two peak matrices
the spectra's precursor m/z values are passed to the function as parameters
xPrecursorMz (precursor m/z of the x peak matrix) and yPrecursorMz
(precursor m/z of the y peak matrix). Additional parameters to functions
FUN and MAPFUN can be passed with .... Parameters ppm and
tolerance are passed to both MAPFUN and FUN.
The function returns a matrix with the results of FUN for each
comparison, number of rows equal to length(x) and number of columns
equal length(y) (i.e. element in row 2 and column 3 is the result from
the comparison of x[2] with y[3]). If SIMPLIFY = TRUE the matrix
is simplified to a numeric if length of x or y is one. See also
the vignette for additional examples, such as using spectral entropy
similarity in the scoring."><meta property="og:image" content="https://rformassspectrometry.github.io/Spectra/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Spectra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.17.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/Spectra.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/MsBackend.html">Creating new `MsBackend` classes</a></li>
    <li><a class="dropdown-item" href="../articles/Spectra-large-scale.html">Large-scale data handling and processing with Spectra</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/Spectra/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Spectra similarity calculations</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/Spectra/blob/main/R/Spectra.R" class="external-link"><code>R/Spectra.R</code></a></small>
      <div class="d-none name"><code>compareSpectra.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>compareSpectra()</code> compares each spectrum in <code>x</code> with each spectrum in <code>y</code>
using the function provided with <code>FUN</code> (defaults to
<code><a href="https://rdrr.io/pkg/MsCoreUtils/man/distance.html" class="external-link">MsCoreUtils::ndotproduct()</a></code>). If <code>y</code> is missing, each spectrum in <code>x</code> is
compared with each other spectrum in <code>x</code>.
The matching/mapping of peaks between the compared spectra is done with the
<code>MAPFUN</code> function. The default <code><a href="joinPeaks.html">joinPeaks()</a></code> matches peaks of both spectra
and allows to keep all peaks from the first spectrum (<code>type = "left"</code>),
from the second (<code>type = "right"</code>), from both (<code>type = "outer"</code>) and to
keep only matching peaks (<code>type = "inner"</code>); see <code><a href="joinPeaks.html">joinPeaks()</a></code> for more
information and examples). The <code>MAPFUN</code> function should have parameters
<code>x</code>, <code>y</code>, <code>xPrecursorMz</code> and <code>yPrecursorMz</code> as these values are passed to
the function.</p>
<p>In addition to <code><a href="joinPeaks.html">joinPeaks()</a></code> also <code><a href="joinPeaks.html">joinPeaksGnps()</a></code> is supported for
GNPS-like similarity score calculations. Note that <code><a href="joinPeaks.html">joinPeaksGnps()</a></code> should
only be used in combination with <code>FUN = MsCoreUtils::gnps</code>
(see <code><a href="joinPeaks.html">joinPeaksGnps()</a></code> for more information and details). Use
<code>MAPFUN = joinPeaksNone</code> to disable internal peak matching/mapping if a
similarity scoring function is used that performs the matching internally.</p>
<p><code>FUN</code> is supposed to be a function to compare intensities of (matched)
peaks of the two spectra that are compared. The function needs to take two
matrices with columns <code>"mz"</code> and <code>"intensity"</code> as input and is supposed
to return a single numeric as result. In addition to the two peak matrices
the spectra's precursor m/z values are passed to the function as parameters
<code>xPrecursorMz</code> (precursor m/z of the <code>x</code> peak matrix) and <code>yPrecursorMz</code>
(precursor m/z of the <code>y</code> peak matrix). Additional parameters to functions
<code>FUN</code> and <code>MAPFUN</code> can be passed with <code>...</code>. Parameters <code>ppm</code> and
<code>tolerance</code> are passed to both <code>MAPFUN</code> and <code>FUN</code>.
The function returns a <code>matrix</code> with the results of <code>FUN</code> for each
comparison, number of rows equal to <code>length(x)</code> and number of columns
equal <code>length(y)</code> (i.e. element in row 2 and column 3 is the result from
the comparison of <code>x[2]</code> with <code>y[3]</code>). If <code>SIMPLIFY = TRUE</code> the <code>matrix</code>
is <em>simplified</em> to a <code>numeric</code> if length of <code>x</code> or <code>y</code> is one. See also
the vignette for additional examples, such as using spectral entropy
similarity in the scoring.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for class 'Spectra,Spectra'</span></span>
<span><span class="fu">compareSpectra</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  MAPFUN <span class="op">=</span> <span class="va">joinPeaks</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  ppm <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">ndotproduct</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  matchedPeaksCount <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  SIMPLIFY <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra,missing'</span></span>
<span><span class="fu">compareSpectra</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  y <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  MAPFUN <span class="op">=</span> <span class="va">joinPeaks</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  ppm <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">ndotproduct</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  matchedPeaksCount <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  SIMPLIFY <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A <code>Spectra</code> object.</p></dd>


<dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>A <code>Spectra</code> object.</p></dd>


<dt id="arg-mapfun">MAPFUN<a class="anchor" aria-label="anchor" href="#arg-mapfun"></a></dt>
<dd><p>For <code>compareSpectra()</code>: function to map/match peaks between
the two compared spectra. See <code><a href="joinPeaks.html">joinPeaks()</a></code> for more information and
possible functions. Defaults to <code><a href="joinPeaks.html">joinPeaks()</a></code>.</p></dd>


<dt id="arg-tolerance">tolerance<a class="anchor" aria-label="anchor" href="#arg-tolerance"></a></dt>
<dd><p><code>numeric(1)</code> allowing to define a constant maximal
accepted difference between m/z values for peaks to be matched. This
parameter is directly passed to <code>MAPFUN</code>.</p></dd>


<dt id="arg-ppm">ppm<a class="anchor" aria-label="anchor" href="#arg-ppm"></a></dt>
<dd><p><code>numeric(1)</code> defining a relative, m/z-dependent, maximal
accepted difference between m/z values for peaks to be matched. This
parameter is directly passed to <code>MAPFUN</code>.</p></dd>


<dt id="arg-fun">FUN<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>function to compare intensities of peaks between two spectra.
Defaults to <code><a href="https://rdrr.io/pkg/MsCoreUtils/man/distance.html" class="external-link">MsCoreUtils::ndotproduct()</a></code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to the internal functions.</p></dd>


<dt id="arg-matchedpeakscount">matchedPeaksCount<a class="anchor" aria-label="anchor" href="#arg-matchedpeakscount"></a></dt>
<dd><p><code>logical(1)</code> whether the number of matching peaks
between the compared spectra should be returned in addition to the
similarity scores. Note that with <code>matchedPeaksCount = TRUE</code> a
3-dimensional <code>array</code> is returned. See examples below for details.</p></dd>


<dt id="arg-simplify">SIMPLIFY<a class="anchor" aria-label="anchor" href="#arg-simplify"></a></dt>
<dd><p><code>logical(1)</code> defining  whether the result matrix should be
<em>simplified</em> to a <code>numeric</code> if possible (i.e. if either <code>x</code> or <code>y</code> is
of length 1).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>For <code>matchedPeaksCount = FALSE</code> (the default) a <code>matrix</code> with the
similarity scores. With <code>matchedPeaksCount = FALSE</code> and
<code>SIMPLIFY = TRUE</code> a <code>numeric</code> vector. For <code>matchedPeaksCount = TRUE</code>
a 3-dimensional array with the scores reported in the first matrix in
z dimension (<code>[, , 1]</code>) and the number of matching peaks in the second
matrix in z dimension (<code>[, , 2]</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sebastian Gibb, Johannes Rainer, Laurent Gatto</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Load a `Spectra` object with LC-MS/MS data.</span></span></span>
<span class="r-in"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"TripleTOF-SWATH"</span>, <span class="st">"PestMix1_DDA.mzML"</span>,</span></span>
<span class="r-in"><span>    package <span class="op">=</span> <span class="st">"msdata"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sps_dda</span> <span class="op">&lt;-</span> <span class="fu"><a href="Spectra.html">Spectra</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sps_dda</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 7602 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            1     0.231         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            1     0.351         2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            1     0.471         3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            1     0.591         4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            1     0.711         5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...        ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7598         1   899.491      7598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7599         1   899.613      7599</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7600         1   899.747      7600</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7601         1   899.872      7601</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7602         1   899.993      7602</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Restrict to MS2 (fragment) spectra:</span></span></span>
<span class="r-in"><span><span class="va">sps_ms2</span> <span class="op">&lt;-</span> <span class="fu"><a href="filterMsLevel.html">filterMsLevel</a></span><span class="op">(</span><span class="va">sps_dda</span>, msLevel <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Compare spectra: comparing spectra 2 and 3 against spectra 10:20 using</span></span></span>
<span class="r-in"><span><span class="co">## the normalized dotproduct method.</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">compareSpectra</span><span class="op">(</span><span class="va">sps_ms2</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">sps_ms2</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## first row contains comparisons of spectrum 2 with spectra 10 to 20 and</span></span></span>
<span class="r-in"><span><span class="co">## the second row comparisons of spectrum 3 with spectra 10 to 20</span></span></span>
<span class="r-in"><span><span class="va">res</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2]       [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    0    0 0.05181365    0    0    0    0    0    0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    0    0 0.20331585    0    0    0    0    0    0     0     0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Setting parameter `matchedPeaksCount = TRUE` returns in addition to the</span></span></span>
<span class="r-in"><span><span class="co">## simialrity score also the number of matching peaks between the compared</span></span></span>
<span class="r-in"><span><span class="co">## spectra. The results are then returned as a 3-dimensional array, with the</span></span></span>
<span class="r-in"><span><span class="co">## first matrix in z dimension (`[, , 1]`) containing the scores and the</span></span></span>
<span class="r-in"><span><span class="co">## second matrix in z dimention (`[, , 2]`) the number of matching peaks:</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">compareSpectra</span><span class="op">(</span><span class="va">sps_ms2</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">sps_ms2</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>, matchedPeaksCount <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## the scores</span></span></span>
<span class="r-in"><span><span class="va">res</span><span class="op">[</span>, , <span class="fl">1L</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2]       [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    0    0 0.05181365    0    0    0    0    0    0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    0    0 0.20331585    0    0    0    0    0    0     0     0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## the number of matching peaks</span></span></span>
<span class="r-in"><span><span class="va">res</span><span class="op">[</span>, , <span class="fl">2L</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    0    0    1    0    0    0    0    0    0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    0    0    1    0    0    0    0    0    0     0     0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## We next calculate the pairwise similarity for the first 10 spectra</span></span></span>
<span class="r-in"><span><span class="fu">compareSpectra</span><span class="op">(</span><span class="va">sps_ms2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]       [,2]       [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,] 1.00000000 0.03261724 0.12798950    0    0    0    0  NaN    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,] 0.03261724 1.00000000 0.07398183    0    0    0    0  NaN    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,] 0.12798950 0.07398183 1.00000000    0    0    0    0  NaN    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,] 0.00000000 0.00000000 0.00000000    1    0    0    0  NaN    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,] 0.00000000 0.00000000 0.00000000    0    1    0    0  NaN    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,] 0.00000000 0.00000000 0.00000000    0    0    1    0  NaN    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,] 0.00000000 0.00000000 0.00000000    0    0    0    1  NaN    0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,]        NaN        NaN        NaN  NaN  NaN  NaN  NaN  NaN  NaN   NaN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,] 0.00000000 0.00000000 0.00000000    0    0    0    0  NaN    1     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,] 0.00000000 0.00000000 0.00000000    0    0    0    0  NaN    0     1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Use compareSpectra to determine the number of common (matching) peaks</span></span></span>
<span class="r-in"><span><span class="co">## with a ppm of 10:</span></span></span>
<span class="r-in"><span><span class="co">## type = "inner" uses a *inner join* to match peaks, i.e. keeps only</span></span></span>
<span class="r-in"><span><span class="co">## peaks that can be mapped betwen both spectra. The provided FUN returns</span></span></span>
<span class="r-in"><span><span class="co">## simply the number of matching peaks.</span></span></span>
<span class="r-in"><span><span class="fu">compareSpectra</span><span class="op">(</span><span class="va">sps_ms2</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">sps_ms2</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>, ppm <span class="op">=</span> <span class="fl">10</span>, type <span class="op">=</span> <span class="st">"inner"</span>,</span></span>
<span class="r-in"><span>    FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]    0    0    0    0    0    0    0    0    0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]    0    0    0    0    0    0    0    0    0     0     0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## We repeat this calculation between all pairwise combinations</span></span></span>
<span class="r-in"><span><span class="co">## of the first 20 spectra</span></span></span>
<span class="r-in"><span><span class="fu">compareSpectra</span><span class="op">(</span><span class="va">sps_ms2</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>, ppm <span class="op">=</span> <span class="fl">10</span>, type <span class="op">=</span> <span class="st">"inner"</span>,</span></span>
<span class="r-in"><span>    FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,]    3    0    0    0    0    0    0    0    0     0     0     1     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,]    0    3    1    0    0    0    0    0    0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,]    0    1    3    0    0    0    0    0    0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,]    0    0    0    3    0    0    0    0    0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,]    0    0    0    0    1    0    0    0    0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,]    0    0    0    0    0   11    0    0    0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,]    0    0    0    0    0    0    8    0    0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,]    0    0    0    0    0    0    0    0    0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,]    0    0    0    0    0    0    0    0    7     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,]    0    0    0    0    0    0    0    0    0     4     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11,]    0    0    0    0    0    0    0    0    0     0     3     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [12,]    1    0    0    0    0    0    0    0    0     0     0     4     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13,]    0    0    0    0    0    0    0    0    0     0     0     0     2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [14,]    0    0    0    0    0    0    0    0    0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15,]    0    0    0    0    0    0    0    0    0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16,]    0    0    0    0    0    0    0    0    0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17,]    0    0    0    0    0    0    0    0    0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [18,]    0    0    0    0    0    0    0    0    0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19,]    0    0    0    0    0    0    0    0    1     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [20,]    0    0    0    0    0    0    0    0    0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       [,14] [,15] [,16] [,17] [,18] [,19] [,20]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,]     0     0     0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,]     0     0     0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,]     0     0     0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,]     0     0     0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,]     0     0     0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,]     0     0     0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,]     0     0     0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,]     0     0     0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,]     0     0     0     0     0     1     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,]     0     0     0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11,]     0     0     0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [12,]     0     0     0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13,]     0     0     0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [14,]    16     0     2     0     0     2     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15,]     0     1     0     0     0     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16,]     2     0     5     0     0     2     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17,]     0     0     0     3     1     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [18,]     0     0     0     1     1     0     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19,]     2     0     2     0     0    11     0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [20,]     0     0     0     0     0     0     4</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by RforMassSpectrometry Package Maintainer, Laurent Gatto, Johannes Rainer, Sebastian Gibb, Philippine Louail.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

