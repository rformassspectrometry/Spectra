<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculating Precursor Purity for MS2 spectra — precursorPurity • Spectra</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculating Precursor Purity for MS2 spectra — precursorPurity"><meta name="description" content="MS instruments generally collect precursor ions in a discrete m/z
isolation window before fragmenting them and recording the respective
fragment (MS2) spectrum. Ideally, only a single ion species is fragmented,
depending also on the size of the isolation window, different ions (with
slightly different m/z) might be fragmented. The resulting MS2 spectrum
might thus contain fragments from different ions and hence be less pure.
The precursorPurity() function calculates the precursor purity of MS2
(fragment) spectra expressed as the ratio between the itensity of the highest
signal in the isolation window to the sum of intensities of all MS1 peaks in
the isolation window. This is similar to the calculation performed in the
msPurity
Bioconductor package.
The peak intensities within the isolation window is extracted from the last
MS1 spectrum before the respective MS2 spectrum. The spectra are thus
expected to be ordered by retention time. For the isolation window either the
isolation window reported in the Spectra object is used, or it is
calculated based on the MS2 spectra's precursor m/z. By default, the
isolation window is calculated based on the precursor m/z and parameters
tolerance and ppm: precursorMz +/- (tolerance +
ppm(precursorMz, ppm)). If the actually used precursor isolation window is
defined and available in the Spectra object, it can be used instead by
setting useReportedIsolationWindow = TRUE (default is
useReportedIsolationWindow = FALSE). Note that parameters tolerance
and ppm are ignored for useReportedIsolationWindow = TRUE."><meta property="og:description" content="MS instruments generally collect precursor ions in a discrete m/z
isolation window before fragmenting them and recording the respective
fragment (MS2) spectrum. Ideally, only a single ion species is fragmented,
depending also on the size of the isolation window, different ions (with
slightly different m/z) might be fragmented. The resulting MS2 spectrum
might thus contain fragments from different ions and hence be less pure.
The precursorPurity() function calculates the precursor purity of MS2
(fragment) spectra expressed as the ratio between the itensity of the highest
signal in the isolation window to the sum of intensities of all MS1 peaks in
the isolation window. This is similar to the calculation performed in the
msPurity
Bioconductor package.
The peak intensities within the isolation window is extracted from the last
MS1 spectrum before the respective MS2 spectrum. The spectra are thus
expected to be ordered by retention time. For the isolation window either the
isolation window reported in the Spectra object is used, or it is
calculated based on the MS2 spectra's precursor m/z. By default, the
isolation window is calculated based on the precursor m/z and parameters
tolerance and ppm: precursorMz +/- (tolerance +
ppm(precursorMz, ppm)). If the actually used precursor isolation window is
defined and available in the Spectra object, it can be used instead by
setting useReportedIsolationWindow = TRUE (default is
useReportedIsolationWindow = FALSE). Note that parameters tolerance
and ppm are ignored for useReportedIsolationWindow = TRUE."><meta property="og:image" content="https://rformassspectrometry.github.io/Spectra/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Spectra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.19.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/Spectra.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/MsBackend.html">Creating new `MsBackend` classes</a></li>
    <li><a class="dropdown-item" href="../articles/Spectra-large-scale.html">Large-scale data handling and processing with Spectra</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/Spectra/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculating Precursor Purity for MS2 spectra</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/Spectra/blob/main/R/Spectra-precursorPurity.R" class="external-link"><code>R/Spectra-precursorPurity.R</code></a></small>
      <div class="d-none name"><code>precursorPurity.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>MS instruments generally collect precursor ions in a discrete <em>m/z</em>
<em>isolation window</em> before fragmenting them and recording the respective
fragment (MS2) spectrum. Ideally, only a single ion species is fragmented,
depending also on the size of the isolation window, different ions (with
slightly different <em>m/z</em>) might be fragmented. The resulting MS2 spectrum
might thus contain fragments from different ions and hence be less <em>pure</em>.</p>
<p>The <code>precursorPurity()</code> function calculates the <strong>precursor purity</strong> of MS2
(fragment) spectra expressed as the ratio between the itensity of the highest
signal in the isolation window to the sum of intensities of all MS1 peaks in
the isolation window. This is similar to the calculation performed in the
<a href="https://www.bioconductor.org/packages/release/bioc/html/msPurity.html" class="external-link"><em>msPurity</em></a>
Bioconductor package.</p>
<p>The peak intensities within the isolation window is extracted from the last
MS1 spectrum before the respective MS2 spectrum. The spectra are thus
expected to be ordered by retention time. For the isolation window either the
isolation window reported in the <code>Spectra</code> object is used, or it is
calculated based on the MS2 spectra's precursor m/z. By default, the
isolation window is calculated based on the precursor m/z and parameters
<code>tolerance</code> and <code>ppm</code>: precursorMz +/- (<code>tolerance</code> +
<code>ppm(precursorMz, ppm)</code>). If the actually used precursor isolation window is
defined and available in the <code>Spectra</code> object, it can be used instead by
setting <code>useReportedIsolationWindow = TRUE</code> (default is
<code>useReportedIsolationWindow = FALSE</code>). Note that parameters <code>tolerance</code>
and <code>ppm</code> are ignored for <code>useReportedIsolationWindow = TRUE</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">precursorPurity</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  ppm <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  useReportedIsolationWindow <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p><code><a href="Spectra.html">Spectra()</a></code> object with LC-MS/MS data.</p></dd>


<dt id="arg-tolerance">tolerance<a class="anchor" aria-label="anchor" href="#arg-tolerance"></a></dt>
<dd><p><code>numeric(1)</code> defining an absolute value (in Da) to be used
to define the isolation window. For the precursor purity calculation of
an MS2 spectrum, all MS1 peaks from the previous MS1 scan with an m/z
between the fragment spectrum's precursorMz +/- (tolerance +
ppm(precursorMz, ppm)) are considered.</p></dd>


<dt id="arg-ppm">ppm<a class="anchor" aria-label="anchor" href="#arg-ppm"></a></dt>
<dd><p><code>numeric(1)</code> defining the m/z dependent acceptable difference in
m/z. See documentation of parameter <code>tolerance</code> for more information.</p></dd>


<dt id="arg-usereportedisolationwindow">useReportedIsolationWindow<a class="anchor" aria-label="anchor" href="#arg-usereportedisolationwindow"></a></dt>
<dd><p><code>logical(1)</code> whether the reported
isolation window, defined by spectra variables <code>isolationWindowLowerMz</code>
and <code>isolationWindowUpperMz</code> in the input <a href="Spectra.html">Spectra</a> object, should be
used instead of calculating the isolation window from the reported
precursor m/z and parameters <code>tolerance</code> and <code>ppm</code>. Only few
manufacturers report the isolation window with the spectra variables
<code>isolationWindowLowerMz</code> and <code>isolationWindowTargetMz</code>, thus the default
for this parameter is <code>FALSE</code>.</p></dd>


<dt id="arg-bpparam">BPPARAM<a class="anchor" aria-label="anchor" href="#arg-bpparam"></a></dt>
<dd><p>parallel processing setup. Defaults to
<code>BPPARAM = SerialParam()</code>. See <code><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">BiocParallel::SerialParam()</a></code> for
more information.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>numeric</code> vector of length equal to the number of spectra in
<code>object</code>,  with values representing the calculated precursor purity
for each spectrum. For MS1 spectra, <code>NA_real_</code> is returned. For MS2
spectra, the purity is defined as the proportion of maximum signal to
the total ion current within the isolation  window that is attributable
to the selected precursor ion. If no matching  MS1 scan is found or
the precursor peak is missing, <code>NA_real_</code> is returned.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>This approach is applicable only when fragment spectra are obtained through
data-dependent acquisition (DDA), as it assumes that the peak with the
highest intensity within the given isolation m/z window (from the previous
MS1 spectrum) corresponds to the precursor ion.</p>
<p>The spectra in <code>object</code> have to be ordered by their retention time.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="addProcessing.html">addProcessing()</a></code> for other data analysis and manipulation functions.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Ahlam Mentag, Johannes Rainer</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Load a test DDA file</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">msdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"TripleTOF-SWATH"</span>, <span class="st">"PestMix1_DDA.mzML"</span>,</span></span>
<span class="r-in"><span>                 package <span class="op">=</span> <span class="st">"msdata"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sps_dda</span> <span class="op">&lt;-</span> <span class="fu"><a href="Spectra.html">Spectra</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Define the isolation window based on the MS2 spectra's precursor m/z</span></span></span>
<span class="r-in"><span><span class="co">## and parameter `tolerance`: isolation window with size 1Da:</span></span></span>
<span class="r-in"><span><span class="va">pp</span> <span class="op">&lt;-</span> <span class="fu">precursorPurity</span><span class="op">(</span><span class="va">sps_dda</span>, tolerance <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## values for MS1 spectra are NA</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pp</span><span class="op">[</span><span class="fu"><a href="spectraData.html">msLevel</a></span><span class="op">(</span><span class="va">sps_dda</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] NA NA NA NA NA NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pp</span><span class="op">[</span><span class="fu"><a href="spectraData.html">msLevel</a></span><span class="op">(</span><span class="va">sps_dda</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.0000000 0.5894016 1.0000000 1.0000000 0.9223336 1.0000000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Use the reported isolation window (if defined in the `Spectra`):</span></span></span>
<span class="r-in"><span><span class="fu"><a href="filterMsLevel.html">filterMsLevel</a></span><span class="op">(</span><span class="va">sps_dda</span>, <span class="fl">2L</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="spectraData.html">isolationWindowLowerMz</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 137.46394  56.44191  89.44488 206.52937  54.50829 120.59900</span>
<span class="r-in"><span><span class="fu"><a href="filterMsLevel.html">filterMsLevel</a></span><span class="op">(</span><span class="va">sps_dda</span>, <span class="fl">2L</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="spectraData.html">isolationWindowUpperMz</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 138.46394  57.44191  90.44488 207.52937  55.50829 121.59900</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pp_2</span> <span class="op">&lt;-</span> <span class="fu">precursorPurity</span><span class="op">(</span><span class="va">sps_dda</span>, useReportedIsolationWindow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pp_2</span><span class="op">[</span><span class="fu"><a href="spectraData.html">msLevel</a></span><span class="op">(</span><span class="va">sps_dda</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.0000000 0.5894016 1.0000000 1.0000000 0.9223336 1.0000000</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by RforMassSpectrometry Package Maintainer, Laurent Gatto, Johannes Rainer, Sebastian Gibb, Philippine Louail.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer></div>





  </body></html>

