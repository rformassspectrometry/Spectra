<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The Spectra class encapsules spectral mass spectrometry data and
related metadata.
It supports multiple data backends, e.g. in-memory (MsBackendMemory,
MsBackendDataFrame()), on-disk as mzML (MsBackendMzR()) or HDF5
(MsBackendHdf5Peaks())."><title>The Spectra class to manage and access MS data — applyProcessing • Spectra</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The Spectra class to manage and access MS data — applyProcessing"><meta property="og:description" content="The Spectra class encapsules spectral mass spectrometry data and
related metadata.
It supports multiple data backends, e.g. in-memory (MsBackendMemory,
MsBackendDataFrame()), on-disk as mzML (MsBackendMzR()) or HDF5
(MsBackendHdf5Peaks())."><meta property="og:image" content="https://rformassspectrometry.github.io/Spectra/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Spectra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.11.11</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/Spectra.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/MsBackend.html">Creating new `MsBackend` classes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/Spectra/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>The Spectra class to manage and access MS data</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/Spectra/blob/HEAD/R/Spectra-functions.R" class="external-link"><code>R/Spectra-functions.R</code></a>, <a href="https://github.com/RforMassSpectrometry/Spectra/blob/HEAD/R/Spectra.R" class="external-link"><code>R/Spectra.R</code></a></small>
      <div class="d-none name"><code>Spectra.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>Spectra</code> class encapsules spectral mass spectrometry data and
related metadata.</p>
<p>It supports multiple data backends, e.g. in-memory (<a href="MsBackend.html">MsBackendMemory</a>,
<code><a href="MsBackend.html">MsBackendDataFrame()</a></code>), on-disk as mzML (<code><a href="MsBackend.html">MsBackendMzR()</a></code>) or HDF5
(<code><a href="MsBackend.html">MsBackendHdf5Peaks()</a></code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre><code>applyProcessing(object, f = dataStorage(object), BPPARAM = bpparam(), ...)

concatenateSpectra(x, ...)

combineSpectra(
  x,
  f = x$dataStorage,
  p = x$dataStorage,
  FUN = combinePeaksData,
  ...,
  BPPARAM = bpparam()
)

joinSpectraData(x, y, by.x = "spectrumId", by.y, suffix.y = ".y")

processingLog(x)

deisotopeSpectra(
  x,
  substDefinition = isotopicSubstitutionMatrix("HMDB_NEUTRAL"),
  tolerance = 0,
  ppm = 20,
  charge = 1
)

reduceSpectra(x, tolerance = 0, ppm = 20)

filterPrecursorMaxIntensity(x, tolerance = 0, ppm = 20)

filterPrecursorIsotopes(
  x,
  tolerance = 0,
  ppm = 20,
  substDefinition = isotopicSubstitutionMatrix("HMDB_NEUTRAL")
)

scalePeaks(x, by = sum, msLevel. = uniqueMsLevels(x))

filterPrecursorPeaks(
  object,
  tolerance = 0,
  ppm = 20,
  mz = c("==", "&gt;="),
  msLevel. = uniqueMsLevels(object)
)

# S4 method for missing
Spectra(
  object,
  processingQueue = list(),
  metadata = list(),
  ...,
  backend = MsBackendMemory(),
  BPPARAM = bpparam()
)

# S4 method for MsBackend
Spectra(
  object,
  processingQueue = list(),
  metadata = list(),
  ...,
  BPPARAM = bpparam()
)

# S4 method for character
Spectra(
  object,
  processingQueue = list(),
  metadata = list(),
  source = MsBackendMzR(),
  backend = source,
  ...,
  BPPARAM = bpparam()
)

# S4 method for ANY
Spectra(
  object,
  processingQueue = list(),
  metadata = list(),
  source = MsBackendMemory(),
  backend = source,
  ...,
  BPPARAM = bpparam()
)

# S4 method for Spectra,MsBackend
setBackend(object, backend, f = dataStorage(object), ..., BPPARAM = bpparam())

# S4 method for Spectra
c(x, ...)

# S4 method for Spectra,ANY
split(x, f, drop = FALSE, ...)

# S4 method for Spectra
export(object, backend, ...)

# S4 method for Spectra
acquisitionNum(object)

# S4 method for Spectra
peaksData(object, columns = c("mz", "intensity"), ..., BPPARAM = bpparam())

# S4 method for Spectra
peaksVariables(object)

# S4 method for Spectra
centroided(object)

# S4 method for Spectra
centroided(object) &lt;- value

# S4 method for Spectra
collisionEnergy(object)

# S4 method for Spectra
collisionEnergy(object) &lt;- value

# S4 method for Spectra
dataOrigin(object)

# S4 method for Spectra
dataOrigin(object) &lt;- value

# S4 method for Spectra
dataStorage(object)

# S4 method for Spectra
dropNaSpectraVariables(object)

# S4 method for Spectra
intensity(object, ...)

# S4 method for Spectra
ionCount(object)

# S4 method for Spectra
isCentroided(object, ...)

# S4 method for Spectra
isEmpty(x)

# S4 method for Spectra
isolationWindowLowerMz(object)

# S4 method for Spectra
isolationWindowLowerMz(object) &lt;- value

# S4 method for Spectra
isolationWindowTargetMz(object)

# S4 method for Spectra
isolationWindowTargetMz(object) &lt;- value

# S4 method for Spectra
isolationWindowUpperMz(object)

# S4 method for Spectra
isolationWindowUpperMz(object) &lt;- value

# S4 method for Spectra
containsMz(
  object,
  mz = numeric(),
  tolerance = 0,
  ppm = 20,
  which = c("any", "all"),
  BPPARAM = bpparam()
)

# S4 method for Spectra
containsNeutralLoss(
  object,
  neutralLoss = 0,
  tolerance = 0,
  ppm = 20,
  BPPARAM = bpparam()
)

# S4 method for Spectra
spectrapply(
  object,
  FUN,
  ...,
  chunkSize = integer(),
  f = factor(),
  BPPARAM = SerialParam()
)

# S4 method for Spectra
length(x)

# S4 method for Spectra
msLevel(object)

# S4 method for Spectra
mz(object, ...)

# S4 method for Spectra
lengths(x, use.names = FALSE)

# S4 method for Spectra
polarity(object)

# S4 method for Spectra
polarity(object) &lt;- value

# S4 method for Spectra
precScanNum(object)

# S4 method for Spectra
precursorCharge(object)

# S4 method for Spectra
precursorIntensity(object)

# S4 method for Spectra
precursorMz(object)

# S4 method for Spectra
rtime(object)

# S4 method for Spectra
rtime(object) &lt;- value

# S4 method for Spectra
scanIndex(object)

# S4 method for Spectra
selectSpectraVariables(
  object,
  spectraVariables = union(spectraVariables(object), peaksVariables(object))
)

# S4 method for Spectra
smoothed(object)

# S4 method for Spectra
smoothed(object) &lt;- value

# S4 method for Spectra
spectraData(object, columns = spectraVariables(object))

# S4 method for Spectra
spectraData(object) &lt;- value

# S4 method for Spectra
spectraNames(object)

# S4 method for Spectra
spectraNames(object) &lt;- value

# S4 method for Spectra
spectraVariables(object)

# S4 method for Spectra
tic(object, initial = TRUE)

# S4 method for Spectra
$(x, name)

# S4 method for Spectra
$(x, name) &lt;- value

# S4 method for Spectra
[[(x, i, j, ...)

# S4 method for Spectra
[[(x, i, j, ...) &lt;- value

# S4 method for Spectra
[(x, i, j, ..., drop = FALSE)

# S4 method for Spectra
filterAcquisitionNum(
  object,
  n = integer(),
  dataStorage = character(),
  dataOrigin = character()
)

# S4 method for Spectra
filterEmptySpectra(object)

# S4 method for Spectra
filterDataOrigin(object, dataOrigin = character())

# S4 method for Spectra
filterDataStorage(object, dataStorage = character())

# S4 method for Spectra
filterFourierTransformArtefacts(
  object,
  halfWindowSize = 0.05,
  threshold = 0.2,
  keepIsotopes = TRUE,
  maxCharge = 5,
  isotopeTolerance = 0.005
)

# S4 method for Spectra
filterIntensity(
  object,
  intensity = c(0, Inf),
  msLevel. = uniqueMsLevels(object),
  ...
)

# S4 method for Spectra
filterIsolationWindow(object, mz = numeric())

# S4 method for Spectra
filterMsLevel(object, msLevel. = integer())

# S4 method for Spectra
filterMzRange(
  object,
  mz = numeric(),
  msLevel. = uniqueMsLevels(object),
  keep = TRUE
)

# S4 method for Spectra
filterMzValues(
  object,
  mz = numeric(),
  tolerance = 0,
  ppm = 20,
  msLevel. = uniqueMsLevels(object),
  keep = TRUE
)

# S4 method for Spectra
filterPolarity(object, polarity = integer())

# S4 method for Spectra
filterPrecursorMz(object, mz = numeric())

# S4 method for Spectra
filterPrecursorMzRange(object, mz = numeric())

# S4 method for Spectra
filterPrecursorMzValues(object, mz = numeric(), ppm = 20, tolerance = 0)

# S4 method for Spectra
filterPrecursorCharge(object, z = integer())

# S4 method for Spectra
filterPrecursorScan(object, acquisitionNum = integer(), f = dataOrigin(object))

# S4 method for Spectra
filterRt(object, rt = numeric(), msLevel. = uniqueMsLevels(object))

# S4 method for Spectra
reset(object, ...)

# S4 method for Spectra
bin(x, binSize = 1L, breaks = NULL, msLevel. = uniqueMsLevels(x), FUN = sum)

# S4 method for Spectra,Spectra
compareSpectra(
  x,
  y,
  MAPFUN = joinPeaks,
  tolerance = 0,
  ppm = 20,
  FUN = ndotproduct,
  ...,
  SIMPLIFY = TRUE
)

# S4 method for Spectra,missing
compareSpectra(
  x,
  y = NULL,
  MAPFUN = joinPeaks,
  tolerance = 0,
  ppm = 20,
  FUN = ndotproduct,
  ...,
  SIMPLIFY = TRUE
)

# S4 method for Spectra
pickPeaks(
  object,
  halfWindowSize = 2L,
  method = c("MAD", "SuperSmoother"),
  snr = 0,
  k = 0L,
  descending = FALSE,
  threshold = 0,
  msLevel. = uniqueMsLevels(object),
  ...
)

# S4 method for Spectra
replaceIntensitiesBelow(
  object,
  threshold = min,
  value = 0,
  msLevel. = uniqueMsLevels(object)
)

# S4 method for Spectra
smooth(
  x,
  halfWindowSize = 2L,
  method = c("MovingAverage", "WeightedMovingAverage", "SavitzkyGolay"),
  msLevel. = uniqueMsLevels(x),
  ...
)

# S4 method for Spectra
addProcessing(object, FUN, ..., spectraVariables = character())

coreSpectraVariables()

# S4 method for Spectra
uniqueMsLevels(object, ...)

# S4 method for Spectra
backendBpparam(object, BPPARAM = bpparam())

# S4 method for Spectra
combinePeaks(
  object,
  tolerance = 0,
  ppm = 20,
  intensityFun = base::mean,
  mzFun = base::mean,
  weighted = TRUE,
  msLevel. = uniqueMsLevels(object),
  ...
)</code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>For <code>Spectra</code>: either a <code>DataFrame</code> or <code>missing</code>. See section
on creation of <code>Spectra</code> objects for details. For all other methods a
<code>Spectra</code> object.</p></dd>


<dt>f</dt>
<dd><p>For <code>split</code>: factor defining how to split <code>x</code>. See <code><a href="https://rdrr.io/r/base/split.html" class="external-link">base::split()</a></code>
for details. For <code>setBackend</code>: factor defining how to split the data for
parallelized copying of the spectra data to the new backend. For some
backends changing this parameter can lead to errors.
For <code>combineSpectra</code>: <code>factor</code> defining the grouping of the spectra that
should be combined. For <code>spectrapply</code>: <code>factor</code> how <code>object</code> should be
splitted. For <code>filterPrecursorScan</code>:
defining which spectra belong to the same original data file (sample).
Defaults to <code>f = dataOrigin(x)</code>.</p></dd>


<dt>BPPARAM</dt>
<dd><p>Parallel setup configuration. See <code>bpparam()</code> for more
information. This is passed directly to the <code><a href="MsBackend.html">backendInitialize()</a></code> method
of the <a href="MsBackend.html">MsBackend</a>.</p></dd>


<dt>...</dt>
<dd><p>Additional arguments.</p></dd>


<dt>x</dt>
<dd><p>A <code>Spectra</code> object.</p></dd>


<dt>p</dt>
<dd><p>For <code>combineSpectra</code>: <code>factor</code> defining how to split the input
<code>Spectra</code> for parallel processing. Defaults to <code>x$dataStorage</code>, i.e.,
depending on the used backend, per-file parallel processing will be
performed.</p></dd>


<dt>FUN</dt>
<dd><p>For <code>addProcessing</code>: function to be applied to the peak matrix
of each spectrum in <code>object</code>. For <code>compareSpectra</code>: function to compare
intensities of peaks between two spectra with each other.
For <code>combineSpectra</code>: function to combine the (peak matrices) of the
spectra. See section <em>Data manipulations</em> and examples below for more
details.
For <code>bin</code>: function to aggregate intensity values of peaks falling into
the same bin. Defaults to <code>FUN = sum</code> thus summing up intensities.
For <code>spectrapply</code> and <code>chunkapply</code>: function to be applied to <code>Spectra</code>.</p></dd>


<dt>y</dt>
<dd><p>A <code>Spectra</code> object. A <code>DataFrame</code> for <code>joinSpectraData()</code>.</p></dd>


<dt>by.x</dt>
<dd><p>A <code>character(1)</code> specifying the spectra variable used
for merging. Default is <code>"spectrumId"</code>.</p></dd>


<dt>by.y</dt>
<dd><p>A <code>character(1)</code> specifying the column used for
merging. Set to <code>by.x</code> if missing.</p></dd>


<dt>suffix.y</dt>
<dd><p>A <code>character(1)</code> specifying the suffix to be used
for making the names of columns in the merged spectra variables
unique. This suffix will be used to amend <code>names(y)</code>, while
<code>spectraVariables(x)</code> will remain unchanged.</p></dd>


<dt>substDefinition</dt>
<dd><p>For <code>deisotopeSpectra</code> and <code>filterPrecursorIsotopes</code>:
<code>matrix</code> or <code>data.frame</code> with definitions of isotopic substitutions.
Uses by default isotopic substitutions defined from all compounds in the
Human Metabolome Database (HMDB). See <code>isotopologues()</code> or
<code>isotopicSubstitutionMatrix()</code> for details.</p></dd>


<dt>tolerance</dt>
<dd><p>For <code>compareSpectra</code>, <code>containsMz</code>, <code>deisotopeSpectra</code>,
<code>filterMzValues</code> and <code>reduceSpectra</code>: <code>numeric(1)</code> allowing to define
a constant maximal accepted difference between m/z values for peaks
to be matched (or grouped). For <code>containsMz</code> it can also be of length
equal <code>mz</code> to specify a different tolerance for each m/z value.
For <code>filterPrecursorMaxIntensity</code>: <code>numeric(1)</code> defining the (constant)
maximal accepted difference of precursor m/z values of spectra for
grouping them into <em>precursor groups</em>. For <code>filterPrecursorIsotopes</code>:
passed directly to the <code>isotopologues()</code> function.</p></dd>


<dt>ppm</dt>
<dd><p>For <code>compareSpectra</code>, <code>containsMz</code>, <code>deisotopeSpectra</code>,
<code>filterMzValues</code> and <code>reduceSpectra</code>: <code>numeric(1)</code>
defining a relative, m/z-dependent, maximal accepted difference between
m/z values for peaks to be matched (or grouped).
For <code>filterPrecursorMaxIntensity</code>: <code>numeric(1)</code> defining the relative
maximal accepted difference of precursor m/z values of spectra for
grouping them into <em>precursor groups</em>. For <code>filterPrecursorIsotopes</code>:
passed directly to the <code>isotopologues()</code> function.</p></dd>


<dt>charge</dt>
<dd><p>For <code>deisotopeSpectra</code>: expected charge of the ionized
compounds. See <code>isotopologues()</code> for details.</p></dd>


<dt>by</dt>
<dd><p>For <code>scalePeaks</code>: function to calculate a single <code>numeric</code> from
intensity values of a spectrum by which all intensities (of
that spectrum) should be divided by. The default <code>by = sum</code> will
divide intensities of each spectrum by the sum of intensities of that
spectrum.</p></dd>


<dt>msLevel.</dt>
<dd><p><code>integer</code> defining the MS level(s) of the spectra to which
the function should be applied (defaults to all MS levels of <code>object</code>.
For <code>filterMsLevel</code>: the MS level to which <code>object</code> should be subsetted.</p></dd>


<dt>mz</dt>
<dd><p>For <code>filterIsolationWindow</code>: <code>numeric(1)</code> with the m/z value to
filter the object. For <code>filterPrecursorMz</code> and <code>filterMzRange</code>:
<code>numeric(2)</code> defining the lower and upper m/z boundary.
For <code>filterMzValues</code> and <code>filterPrecursorMzValues</code>: <code>numeric</code> with the
m/z values to match peaks or precursor m/z against.</p></dd>


<dt>processingQueue</dt>
<dd><p>For <code>Spectra</code>: optional <code>list</code> of
ProcessingStep objects.</p></dd>


<dt>metadata</dt>
<dd><p>For <code>Spectra</code>: optional <code>list</code> with metadata information.</p></dd>


<dt>backend</dt>
<dd><p>For <code>Spectra</code>: <a href="MsBackend.html">MsBackend</a> to be used as backend. See
section on creation of <code>Spectra</code> objects for details. For <code>setBackend</code>:
instance of <a href="MsBackend.html">MsBackend</a> that supports <code>setBackend</code> (i.e. for
which <code>supportsSetBackend</code> returns <code>TRUE</code>). Such backends have a
parameter <code>data</code> in their <code>backendInitialize</code> function that support
passing the full spectra data to the initialize method. See section on
creation of <code>Spectra</code> objects for details.
For <code>export</code>: <a href="MsBackend.html">MsBackend</a> to be used to export the data.</p></dd>


<dt>source</dt>
<dd><p>For <code>Spectra</code>: instance of <a href="MsBackend.html">MsBackend</a> that can be used
to import spectrum data from the provided files. See section <em>Creation
of objects, conversion and changing the backend</em> for more details.</p></dd>


<dt>drop</dt>
<dd><p>For <code>[</code>, <code>split</code>: not considered.</p></dd>


<dt>columns</dt>
<dd><p>For <code>spectraData</code> accessor: optional <code>character</code> with column
names (spectra variables) that should be included in the
returned <code>DataFrame</code>. By default, all columns are returned.
For <code>peaksData</code> accessor: optional <code>character</code> with requested columns in
the individual <code>matrix</code> of the returned <code>list</code>. Defaults to
<code>c("mz", "value")</code> but any values returned by <code>peaksVariables(object)</code>
with <code>object</code> being the <code>Spectra</code> object are supported.</p></dd>


<dt>value</dt>
<dd><p>replacement value for <code>&lt;-</code> methods. See individual
method description or expected data type.</p></dd>


<dt>which</dt>
<dd><p>for <code>containsMz</code>: either <code>"any"</code> or <code>"all"</code> defining whether any
(the default) or all provided <code>mz</code> have to be present in the spectrum.</p></dd>


<dt>neutralLoss</dt>
<dd><p>for <code>containsNeutralLoss</code>: <code>numeric(1)</code> defining the value
which should be subtracted from the spectrum's precursor m/z.</p></dd>


<dt>chunkSize</dt>
<dd><p>For <code>spectrapply</code>: size of the chunks into which <code>Spectra</code>
should be split. This parameter overrides parameters <code>f</code> and <code>BPPARAM</code>.</p></dd>


<dt>use.names</dt>
<dd><p>For <code>lengths</code>: ignored.</p></dd>


<dt>spectraVariables</dt>
<dd><p>For <code>selectSpectraVariables</code>: <code>character</code> with the
names of the spectra variables to which the backend should be subsetted.
For <code>addProcessing</code>: <code>character</code> with additional spectra variables that
should be passed along to the function defined with <code>FUN</code>. See function
description for details.</p></dd>


<dt>initial</dt>
<dd><p>For <code>tic</code>: <code>logical(1)</code> whether the initially
reported total ion current should be reported, or whether the
total ion current should be (re)calculated on the actual data
(<code>initial = FALSE</code>, same as <code>ionCount</code>).</p></dd>


<dt>name</dt>
<dd><p>For <code>$</code> and <code>$&lt;-</code>: the name of the spectra variable to return
or set.</p></dd>


<dt>i</dt>
<dd><p>For <code>[</code>: <code>integer</code>, <code>logical</code> or <code>character</code> to subset the object.</p></dd>


<dt>j</dt>
<dd><p>For <code>[</code>: not supported.</p></dd>


<dt>n</dt>
<dd><p>for <code>filterAcquisitionNum</code>: <code>integer</code> with the acquisition numbers
to filter for.</p></dd>


<dt>dataStorage</dt>
<dd><p>For <code>filterDataStorage</code>: <code>character</code> to define which
spectra to keep.
For <code>filterAcquisitionNum</code>: optionally specify if filtering should occur
only for spectra of selected <code>dataStorage</code>.</p></dd>


<dt>dataOrigin</dt>
<dd><p>For <code>filterDataOrigin</code>: <code>character</code> to define which
spectra to keep.
For <code>filterAcquisitionNum</code>: optionally specify if filtering should occurr
only for spectra of selected <code>dataOrigin</code>.</p></dd>


<dt>halfWindowSize</dt>
<dd><ul><li><p>For <code>pickPeaks</code>: <code>integer(1)</code>, used in the
identification of the mass peaks: a local maximum has to be the maximum
in the window from <code>(i - halfWindowSize):(i + halfWindowSize)</code>.</p></li>
<li><p>For <code>smooth</code>: <code>integer(1)</code>, used in the smoothing algorithm, the window
reaches from <code>(i - halfWindowSize):(i + halfWindowSize)</code>.</p></li>
<li><p>For <code>filterFourierTransformArtefacts</code>: <code>numeric(1)</code> defining the m/z window
left and right of a peak where to remove fourier transform artefacts.</p></li>
</ul></dd>


<dt>threshold</dt>
<dd><ul><li><p>For <code>pickPeaks</code>: a <code>double(1)</code> defining the proportion of the maximal peak
intensity. Just values above are used for the weighted mean calculation.</p></li>
<li><p>For <code>replaceIntensitiesBelow</code>: a <code>numeric(1)</code> defining the threshold or
a <code>function</code> to calculate the threshold for each spectrum on its intensity
values. Defaults to <code>threshold = min</code>.</p></li>
<li><p>For <code>filterFourierTransformArtefacts</code>: the relative intensity (to a peak)
below which peaks are considered fourier artefacts. Defaults to
<code>threshold = 0.2</code> hence removing peaks that have an intensity below 0.2
times the intensity of the tested peak (within the selected
<code>halfWindowSize</code>).</p></li>
</ul></dd>


<dt>keepIsotopes</dt>
<dd><p>For <code>filterFourierTransformArtefacts</code>: whether isotope
peaks should not be removed as fourier artefacts.</p></dd>


<dt>maxCharge</dt>
<dd><p>For <code>filterFourierTransformArtefacts</code>: the maximum charge
to be considered for isotopes.</p></dd>


<dt>isotopeTolerance</dt>
<dd><p>For <code>filterFourierTransformArtefacts</code>: the m/z
<code>tolerance</code> to be used to define whether peaks might be isotopes of
the current tested peak.</p></dd>


<dt>intensity</dt>
<dd><p>For <code>filterIntensity</code>: <code>numeric</code> of length 1 or 2 defining
either the lower or the lower and upper intensity limit for the
filtering, or a <code>function</code> that takes the intensities as input and
returns a <code>logical</code> (same length then peaks in the spectrum) whether the
peak should be retained or not. Defaults to <code>intensity = c(0, Inf)</code> thus
only peaks with <code>NA</code> intensity are removed.</p></dd>


<dt>keep</dt>
<dd><p>For <code>filterMzValues</code> and <code>filterMzRange</code>: <code>logical(1)</code> whether
the matching peaks should be retained (<code>keep = TRUE</code>, the default<code>) or dropped (</code>keep = FALSE`).</p></dd>


<dt>polarity</dt>
<dd><p>for <code>filterPolarity</code>: <code>integer</code> specifying the polarity to
to subset <code>object</code>.</p></dd>


<dt>z</dt>
<dd><p>For <code>filterPrecursorCharge</code>: <code><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer()</a></code> with the precursor charges
to be used as filter.</p></dd>


<dt>acquisitionNum</dt>
<dd><p>for <code>filterPrecursorScan</code>: <code>integer</code> with the
acquisition number of the spectra to which the object should be
subsetted.</p></dd>


<dt>rt</dt>
<dd><p>for <code>filterRt</code>: <code>numeric(2)</code> defining the retention time range to
be used to subset/filter <code>object</code>.</p></dd>


<dt>binSize</dt>
<dd><p>For <code>bin</code>: <code>numeric(1)</code> defining the size for the m/z bins.
Defaults to <code>binSize = 1</code>.</p></dd>


<dt>breaks</dt>
<dd><p>For <code>bin</code>: <code>numeric</code> defining the m/z breakpoints between bins.</p></dd>


<dt>MAPFUN</dt>
<dd><p>For <code>compareSpectra</code>: function to map/match peaks between the
two compared spectra. See <code><a href="joinPeaks.html">joinPeaks()</a></code> for more information and possible
functions.</p></dd>


<dt>SIMPLIFY</dt>
<dd><p>For <code>compareSpectra</code> whether the result matrix should be
<em>simplified</em> to a <code>numeric</code> if possible (i.e. if either <code>x</code> or <code>y</code> is
of length 1).</p></dd>


<dt>method</dt>
<dd><ul><li><p>For <code>pickPeaks</code>: <code>character(1)</code>, the noise estimators that
should be used, currently the the <em>M</em>edian <em>A</em>bsolute <em>D</em>eviation
(<code>method = "MAD"</code>) and Friedman's Super Smoother
(<code>method = "SuperSmoother"</code>) are supported.</p></li>
<li><p>For <code>smooth</code>: <code>character(1)</code>, the smoothing function that should be used,
currently, the Moving-Average- (<code>method = "MovingAverage"</code>),
Weighted-Moving-Average- (<code>method = "WeightedMovingAverage")</code>,
Savitzky-Golay-Smoothing (<code>method = "SavitzkyGolay"</code>) are supported.</p></li>
</ul></dd>


<dt>snr</dt>
<dd><p>For <code>pickPeaks</code>: <code>double(1)</code> defining the
<em>S</em>ignal-to-<em>N</em>oise-<em>R</em>atio. The intensity of a local maximum has to be
higher than <code>snr * noise</code> to be considered as peak.</p></dd>


<dt>k</dt>
<dd><p>For <code>pickPeaks</code>: <code>integer(1)</code>, number of values left and right of
the peak that should be considered in the weighted mean calculation.</p></dd>


<dt>descending</dt>
<dd><p>For <code>pickPeaks</code>: <code>logical</code>, if <code>TRUE</code> just values between
the nearest valleys around the peak centroids are used.</p></dd>


<dt>intensityFun</dt>
<dd><p>For <code>combinePeaks</code>: function to be used to aggregate
intensities for all peaks in each peak group into a single intensity
value.</p></dd>


<dt>mzFun</dt>
<dd><p>For <code>combinePeaks</code>: function to aggregate m/z values for all
peaks within each peak group into a single m/z value. This parameter
is ignored if <code>weighted = TRUE</code> (the default).</p></dd>


<dt>weighted</dt>
<dd><p>For <code>combinePeaks</code>: <code>logical(1)</code> whether m/z values of peaks
within each peak group should be aggregated into a single m/z value
using an intensity-weighted mean. Defaults to <code>weighted = TRUE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>See individual method description for the return value.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>Spectra</code> class uses by default a lazy data manipulation strategy,
i.e. data manipulations such as performed with <code>replaceIntensitiesBelow</code> are
not applied immediately to the data, but applied on-the-fly to the spectrum
data once it is retrieved. For some backends that allow to write data back
to the data storage (such as the <code><a href="MsBackend.html">MsBackendMemory()</a></code>, <code><a href="MsBackend.html">MsBackendDataFrame()</a></code>
and <code><a href="MsBackend.html">MsBackendHdf5Peaks()</a></code>) it is possible to apply to queue with the
<code>applyProcessing</code> function. See the <em>Data manipulation and analysis
methods</em> section below for more details.</p>
<p>To apply arbitrary functions to a <code>Spectra</code> use the <code>spectrapply</code> function
(or directly <code><a href="chunkapply.html">chunkapply()</a></code> for chunk-wise processing). See description of
the <code>spectrapply</code> function below for details.</p>
<p>For details on plotting spectra, see <code><a href="spectra-plotting.html">plotSpectra()</a></code>.</p>
<p>Clarifications regarding scan/acquisition numbers and indices:</p><ul><li><p>A <code>spectrumId</code> (or <code>spectrumID</code>) is a vendor specific field in
the mzML file that contains some information about the
run/spectrum, e.g.: <code>controllerType=0 controllerNumber=1 scan=5281 file=2</code></p></li>
<li><p><code>acquisitionNum</code> is a more a less sanitize spectrum id generated
from the <code>spectrumId</code> field by <code>mzR</code> (see
<a href="https://github.com/sneumann/mzR/blob/master/src/pwiz/data/msdata/MSData.cpp#L552-L580" class="external-link">here</a>).</p></li>
<li><p><code>scanIndex</code> is the <code>mzR</code> generated sequence number of the
spectrum in the raw file (which doesn't have to be the same as
the <code>acquisitionNum</code>)</p></li>
</ul><p>See also <a href="https://github.com/lgatto/MSnbase/issues/525" class="external-link">this issue</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="creation-of-objects-conversion-changing-the-backend-and-export">Creation of objects, conversion, changing the backend and export<a class="anchor" aria-label="anchor" href="#creation-of-objects-conversion-changing-the-backend-and-export"></a></h2>
    


<p><code>Spectra</code> classes can be created with the <code>Spectra</code> constructor function
which supports the following formats:</p><ul><li><p>parameter <code>object</code> is a <code>data.frame</code> or <code>DataFrame</code> containing the
spectrum data. The provided <code>backend</code> (by default a
<a href="MsBackend.html">MsBackendMemory</a>) will be initialized with that data.</p></li>
<li><p>parameter <code>object</code> is a <a href="MsBackend.html">MsBackend</a> (assumed to be already
initialized).</p></li>
<li><p>parameter <code>object</code> is missing, in which case it is supposed that the data
is provided by the <a href="MsBackend.html">MsBackend</a> class passed along with the <code>backend</code>
argument.</p></li>
<li><p>parameter <code>object</code> is of type <code>character</code> and is expected to be the file
names(s) from which spectra should be imported. Parameter <code>source</code> allows
to define a <a href="MsBackend.html">MsBackend</a> that is able to import the data from the
provided source files. The default value for <code>source</code> is <code><a href="MsBackend.html">MsBackendMzR()</a></code>
which allows to import spectra data from mzML, mzXML or CDF files.</p></li>
</ul><p>With <code>...</code> additional arguments can be passed to the backend's
<code><a href="MsBackend.html">backendInitialize()</a></code> method. Parameter <code>backend</code> allows to specify which
<a href="MsBackend.html">MsBackend</a> should be used for data storage.</p>
<p>The backend of a <code>Spectra</code> object can be changed with the <code>setBackend</code>
method that takes an instance of the new backend as second parameter
<code>backend</code>. A call to <code>setBackend(sps, backend = MsBackendDataFrame())</code>
would for example change the backend of <code>sps</code> to the <em>in-memory</em>
<code>MsBackendDataFrame</code>. Changing to a backend is only supported if that
backend has a <code>data</code> parameter in its <code>backendInitialize</code> method and if
<code>supportsSetBackend</code> returns <code>TRUE</code> for that backend. <code>setBackend</code> will
transfer the full spectra data from the originating backend as a
<code>DataFrame</code> to the new backend.
Most <em>read-only</em> backends do not support <code>setBackend</code>. It is for example
not possible to change the backend to a <em>read-only</em> backend (such as
the <code><a href="MsBackend.html">MsBackendMzR()</a></code> backend).</p>
<p>The definition of the function is:
<code>setBackend(object, backend, ..., f = dataStorage(object), BPPARAM = bpparam())</code> and its parameters are:</p><ul><li><p>parameter <code>object</code>: the <code>Spectra</code> object.</p></li>
<li><p>parameter <code>backend</code>: an instance of the new backend, e.g.
<code>[MsBackendMemory()]</code>.</p></li>
<li><p>parameter <code>f</code>: factor allowing to parallelize the change of the backends.
By default the process of copying the spectra data from the original to the
new backend is performed separately (and in parallel) for each file. Users
are advised to use the default setting.</p></li>
<li><p>parameter <code>...</code>: optional additional arguments passed to the
<code><a href="MsBackend.html">backendInitialize()</a></code> method of the new <code>backend</code>.</p></li>
<li><p>parameter <code>BPPARAM</code>: setup for the parallel processing. See <code>bpparam()</code> for
details.</p></li>
</ul><p>Data from a <code>Spectra</code> object can be <strong>exported</strong> to a file with the <code>export</code>
function. The actual export of the data has to be performed by the <code>export</code>
method of the <a href="MsBackend.html">MsBackend</a> class defined with the mandatory parameter
<code>backend</code>. Note however that not all backend classes support export of data.
From the <code>MsBackend</code> classes in the <code>Spectra</code> package currently only the
<code>MsBackendMzR</code> backend supports data export (to mzML/mzXML file(s));
see the help page of the <a href="MsBackend.html">MsBackend</a> for information on its arguments
or the examples below or the vignette for examples.</p>
<p>The definition of the function is
<code>export(object, backend,  ...)</code> and its
parameters are:</p><ul><li><p><code>object</code>: the <code>Spectra</code> object to be exported.</p></li>
<li><p><code>backend</code>: instance of a class extending <a href="MsBackend.html">MsBackend</a> which supports export
of the data (i.e. which has a defined <code>export</code> method).</p></li>
<li><p><code>...</code>: additional parameters specific for the <code>MsBackend</code> passed with
parameter <code>backend</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="accessing-spectra-data">Accessing spectra data<a class="anchor" aria-label="anchor" href="#accessing-spectra-data"></a></h2>
    

<ul><li><p><code>$</code>, <code>$&lt;-</code>: gets (or sets) a spectra variable for all spectra in <code>object</code>.
See examples for details. Note that replacing values of a peaks variable
is not supported with a non-empty processing queue, i.e. if any filtering
or data manipulations on the peaks data was performed. In these cases
<code>applyProcessing()</code> needs to be called first to apply all cached data
operations.</p></li>
<li><p><code>[[</code>, <code>[[&lt;-</code>: access or set/add a single spectrum variable (column) in the
backend.</p></li>
<li><p><code>acquisitionNum</code>: returns the acquisition number of each
spectrum. Returns an <code>integer</code> of length equal to the number of
spectra (with <code>NA_integer_</code> if not available).</p></li>
<li><p><code>centroided</code>, <code>centroided&lt;-</code>: gets or sets the centroiding
information of the spectra. <code>centroided</code> returns a <code>logical</code>
vector of length equal to the number of spectra with <code>TRUE</code> if a
spectrum is centroided, <code>FALSE</code> if it is in profile mode and <code>NA</code>
if it is undefined. See also <code>isCentroided</code> for estimating from
the spectrum data whether the spectrum is centroided. <code>value</code>
for <code>centroided&lt;-</code> is either a single <code>logical</code> or a <code>logical</code> of
length equal to the number of spectra in <code>object</code>.</p></li>
<li><p><code>collisionEnergy</code>, <code>collisionEnergy&lt;-</code>: gets or sets the
collision energy for all spectra in <code>object</code>. <code>collisionEnergy</code>
returns a <code>numeric</code> with length equal to the number of spectra
(<code>NA_real_</code> if not present/defined), <code>collisionEnergy&lt;-</code> takes a
<code>numeric</code> of length equal to the number of spectra in <code>object</code>.</p></li>
<li><p><code>coreSpectraVariables</code>: returns the <em>core</em> spectra variables along with
their expected data type.</p></li>
<li><p><code>dataOrigin</code>, <code>dataOrigin&lt;-</code>: gets or sets the <em>data origin</em> for each
spectrum. <code>dataOrigin</code> returns a <code>character</code> vector (same length than
<code>object</code>) with the origin of the spectra. <code>dataOrigin&lt;-</code> expects a
<code>character</code> vector (same length than <code>object</code>) with the replacement
values for the data origin of each spectrum.</p></li>
<li><p><code>dataStorage</code>: returns a <code>character</code> vector (same length than <code>object</code>)
with the data storage location of each spectrum.</p></li>
<li><p><code>intensity</code>: gets the intensity values from the spectra. Returns
a <code>NumericList()</code> of <code>numeric</code> vectors (intensity values for each
spectrum). The length of the list is equal to the number of
<code>spectra</code> in <code>object</code>.</p></li>
<li><p><code>ionCount</code>: returns a <code>numeric</code> with the sum of intensities for
each spectrum. If the spectrum is empty (see <code>isEmpty</code>),
<code>NA_real_</code> is returned.</p></li>
<li><p><code>isCentroided</code>: a heuristic approach assessing if the spectra in
<code>object</code> are in profile or centroided mode. The function takes
the <code>qtl</code>th quantile top peaks, then calculates the difference
between adjacent m/z value and returns <code>TRUE</code> if the first
quartile is greater than <code>k</code>. (See <code>Spectra:::.isCentroided</code> for
the code.)</p></li>
<li><p><code>isEmpty</code>: checks whether a spectrum in <code>object</code> is empty
(i.e. does not contain any peaks). Returns a <code>logical</code> vector of
length equal number of spectra.</p></li>
<li><p><code>isolationWindowLowerMz</code>, <code>isolationWindowLowerMz&lt;-</code>: gets or sets the
lower m/z boundary of the isolation window.</p></li>
<li><p><code>isolationWindowTargetMz</code>, <code>isolationWindowTargetMz&lt;-</code>: gets or sets the
target m/z of the isolation window.</p></li>
<li><p><code>isolationWindowUpperMz</code>, <code>isolationWindowUpperMz&lt;-</code>: gets or sets the
upper m/z boundary of the isolation window.</p></li>
<li><p><code>containsMz</code>: checks for each of the spectra whether they contain mass
peaks with an m/z equal to <code>mz</code> (given acceptable difference as defined by
parameters <code>tolerance</code> and <code>ppm</code> - see <code>common()</code> for details). Parameter
<code>which</code> allows to define whether any (<code>which = "any"</code>, the default) or
all (<code>which = "all"</code>) of the <code>mz</code> have to match. The function returns
<code>NA</code> if <code>mz</code> is of length 0 or is <code>NA</code>.</p></li>
<li><p><code>containsNeutralLoss</code>: checks for each spectrum in <code>object</code> if it has a
peak with an m/z value equal to its precursor m/z - <code>neutralLoss</code> (given
acceptable difference as defined by parameters <code>tolerance</code> and <code>ppm</code>).
Returns <code>NA</code> for MS1 spectra (or spectra without a precursor m/z).</p></li>
<li><p><code>length</code>: gets the number of spectra in the object.</p></li>
<li><p><code>lengths</code>: gets the number of peaks (m/z-intensity values) per
spectrum. Returns an <code>integer</code> vector (length equal to the
number of spectra). For empty spectra, <code>0</code> is returned.</p></li>
<li><p><code>msLevel</code>: gets the spectra's MS level. Returns an integer vector (names
being spectrum names, length equal to the number of spectra) with the MS
level for each spectrum.</p></li>
<li><p><code>mz</code>: gets the mass-to-charge ratios (m/z) from the
spectra. Returns a <code>NumericList()</code> or length equal to the number of
spectra, each element a <code>numeric</code> vector with the m/z values of
one spectrum.</p></li>
<li><p><code>peaksData</code>: gets the <em>peaks</em> data for all spectra in <code>object</code>. Peaks data
consist of the m/z and intensity values as well as possible additional
annotations (variables) of all peaks of each spectrum. The function
returns a <code>SimpleList()</code> of two dimensional arrays (either <code>matrix</code> or
<code>data.frame</code>), with each array providing the values for the requested
<em>peak variables</em> (by default <code>"mz"</code> and <code>"intensity"</code>). Optional parameter
<code>columns</code> is passed to the backend's <code>peaksData</code> function to allow
the selection of specific (or additional) peaks variables (columns) that
should be extracted (if available). Importantly,
it is <strong>not</strong> guaranteed that each backend supports this parameter (while
each backend must support extraction of <code>"mz"</code> and <code>"intensity"</code> columns).
Parameter <code>columns</code> defaults to <code>c("mz", "intensity")</code> but any value
returned from <code>peaksVariables</code> is supported.
Note also that it is possible to extract the peak data with
<code>as(x, "list")</code> and <code>as(x, "SimpleList")</code> as a <code>list</code> and <code>SimpleList</code>,
respectively. Note however that, in contrast to <code>peaksData</code>, <code>as</code> does not
support the parameter <code>columns</code>.</p></li>
<li><p><code>peaksVariables</code>: lists the available variables for mass peaks provided by
the backend. Default peak variables are <code>"mz"</code> and <code>"intensity"</code> (which
all backends need to support and provide), but some backends might provide
additional variables.
These variables correspond to the column names of the peak data array
returned by <code>peaksData</code>.</p></li>
<li><p><code>polarity</code>, <code>polarity&lt;-</code>: gets or sets the polarity for each
spectrum.  <code>polarity</code> returns an <code>integer</code> vector (length equal
to the number of spectra), with <code>0</code> and <code>1</code> representing negative
and positive polarities, respectively. <code>polarity&lt;-</code> expects an
<code>integer</code> vector of length 1 or equal to the number of spectra.</p></li>
<li><p><code>precursorCharge</code>, <code>precursorIntensity</code>, <code>precursorMz</code>,
<code>precScanNum</code>, <code>precAcquisitionNum</code>: gets the charge (<code>integer</code>),
intensity (<code>numeric</code>), m/z (<code>numeric</code>), scan index (<code>integer</code>)
and acquisition number (<code>interger</code>) of the precursor for MS level &gt;
2 spectra from the object. Returns a vector of length equal to
the number of spectra in <code>object</code>. <code>NA</code> are reported for MS1
spectra of if no precursor information is available.</p></li>
<li><p><code>rtime</code>, <code>rtime&lt;-</code>: gets or sets the retention times (in seconds)
for each spectrum.  <code>rtime</code> returns a <code>numeric</code> vector (length
equal to the number of spectra) with the retention time for each
spectrum.  <code>rtime&lt;-</code> expects a numeric vector with length equal
to the number of spectra.</p></li>
<li><p><code>scanIndex</code>: returns an <code>integer</code> vector with the <em>scan index</em>
for each spectrum. This represents the relative index of the
spectrum within each file. Note that this can be different to the
<code>acquisitionNum</code> of the spectrum which represents the index of the
spectrum during acquisition/measurement (as reported in the mzML file).</p></li>
<li><p><code>smoothed</code>,<code>smoothed&lt;-</code>: gets or sets whether a spectrum is
<em>smoothed</em>. <code>smoothed</code> returns a <code>logical</code> vector of length equal
to the number of spectra. <code>smoothed&lt;-</code> takes a <code>logical</code> vector
of length 1 or equal to the number of spectra in <code>object</code>.</p></li>
<li><p><code>spectraData</code>: gets general spectrum metadata (annotation, also called
header). <code>spectraData</code> returns a <code>DataFrame</code>. Note that this
method does by default <strong>not</strong> return m/z or intensity values.</p></li>
<li><p><code>spectraData&lt;-</code>: <strong>replaces</strong> the full spectra data of the <code>Spectra</code>
object with the one provided with <code>value</code>. The <code>spectraData&lt;-</code> function
expects a <code>DataFrame</code> to be passed as value with the same number of rows
as there a spectra in <code>object</code>. Note that replacing values of
peaks variables is not supported with a non-empty processing queue, i.e.
if any filtering or data manipulations on the peaks data was performed.
In these cases <code>applyProcessing()</code> needs to be called first to apply all
cached data operations and empty the processing queue.</p></li>
<li><p><code>spectraNames</code>, <code>spectraNames&lt;-</code>: gets or sets the spectra names.</p></li>
<li><p><code>spectraVariables</code>: returns a <code>character</code> vector with the
available spectra variables (columns, fields or attributes of each
spectrum) available in <code>object</code>. Note that <code>spectraVariables</code> does not
list the <em>peak variables</em> (<code>"mz"</code>, <code>"intensity"</code> and eventual additional
annotations for each MS peak). Peak variables are returned by
<code>peaksVariables</code>.</p></li>
<li><p><code>tic</code>: gets the total ion current/count (sum of signal of a
spectrum) for all spectra in <code>object</code>. By default, the value
reported in the original raw data file is returned. For an empty
spectrum, <code>0</code> is returned.</p></li>
<li><p><code>uniqueMsLevels</code>: get the unique MS levels available in <code>object</code>. This
function is supposed to be more efficient than <code>unique(msLevel(object))</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="data-subsetting-filtering-and-merging">Data subsetting, filtering and merging<a class="anchor" aria-label="anchor" href="#data-subsetting-filtering-and-merging"></a></h2>
    


<p>Subsetting and filtering of <code>Spectra</code> objects can be performed with the below
listed methods.</p><ul><li><p><code>[</code>: subsets the spectra keeping only selected elements (<code>i</code>). The method
<strong>always</strong> returns a <code>Spectra</code> object.</p></li>
<li><p><code>deisotopeSpectra</code>: <em>deisotopes</em> each spectrum keeping only the
monoisotopic peak for groups of isotopologues. Isotopologues are
estimated using the <code>isotopologues()</code> function from the
<em>MetaboCoreUtils</em> package. Note that
the default parameters for isotope prediction/detection have been
determined using data from the Human Metabolome Database (HMDB) and
isotopes for elements other than CHNOPS might not be detected. See
parameter <code>substDefinition</code> in the documentation of <code>isotopologues()</code> for
more information. The approach and code to define the parameters for
isotope prediction is described
<a href="https://github.com/EuracBiomedicalResearch/isotopologues" class="external-link">here</a>.</p></li>
<li><p><code>dropNaSpectraVariables</code>: removes spectra variables (i.e. columns in the
object's <code>spectraData</code> that contain only missing values (<code>NA</code>). Note that
while columns with only <code>NA</code>s are removed, a <code>spectraData</code> call after
<code>dropNaSpectraVariables</code> might still show columns containing <code>NA</code> values
for <em>core</em> spectra variables.</p></li>
<li><p><code>filterAcquisitionNum</code>: filters the object keeping only spectra matching
the provided acquisition numbers (argument <code>n</code>). If <code>dataOrigin</code> or
<code>dataStorage</code> is also provided, <code>object</code> is subsetted to the spectra with
an acquisition number equal to <code>n</code> <strong>in spectra with matching dataOrigin
or dataStorage values</strong> retaining all other spectra.
Returns the filtered <code>Spectra</code>.</p></li>
<li><p><code>filterDataOrigin</code>: filters the object retaining spectra matching the
provided <code>dataOrigin</code>. Parameter <code>dataOrigin</code> has to be of type
<code>character</code> and needs to match exactly the data origin value of the
spectra to subset.
Returns the filtered <code>Spectra</code> object (with spectra ordered according to
the provided <code>dataOrigin</code> parameter).</p></li>
<li><p><code>filterDataStorage</code>: filters the object retaining spectra stored in the
specified <code>dataStorage</code>. Parameter <code>dataStorage</code> has to be of type
<code>character</code> and needs to match exactly the data storage value of the
spectra to subset.
Returns the filtered <code>Spectra</code> object (with spectra ordered according to
the provided <code>dataStorage</code> parameter).</p></li>
<li><p><code>filterEmptySpectra</code>: removes empty spectra (i.e. spectra without peaks).
Returns the filtered <code>Spectra</code> object (with spectra in their
original order).</p></li>
<li><p><code>filterFourierTransformArtefacts</code>: removes (Orbitrap) fast fourier
artefact peaks from spectra (see examples below). The function iterates
through all intensity ordered peaks in a spectrum and removes all peaks
with an m/z within +/- <code>halfWindowSize</code> of the current peak if their
intensity is lower than <code>threshold</code> times the current peak's intensity.
Additional parameters <code>keepIsotopes</code>, <code>maxCharge</code> and <code>isotopeTolerance</code>
allow to avoid removing of potential <code>[13]C</code> isotope peaks (<code>maxCharge</code>
being the maximum charge that should be considered and <code>isotopeTolerance</code>
the absolute acceptable tolerance for matching their m/z).
See <code><a href="filterFourierTransformArtefacts.html">filterFourierTransformArtefacts()</a></code> for details and background and
<code>deisitopeSpectra</code> for an alternative.</p></li>
<li><p><code>filterIntensity</code>: filters each spectrum keeping only peaks with
intensities that are within the provided range or match the criteria of
the provided function. For the former, parameter <code>intensity</code> has to be a
<code>numeric</code> defining the intensity range, for the latter a <code>function</code> that
takes the intensity values of the spectrum and returns a <code>logical</code> whether
the peak should be retained or not (see examples below for details) -
additional parameters to the function can be passed with <code>...</code>. To
remove only peaks with intensities below a certain threshold, say 100, use
<code>intensity = c(100, Inf)</code>. Note: also a single value can be passed with
the <code>intensity</code> parameter in which case an upper limit of <code>Inf</code> is used.
Note that this function removes also peaks with missing intensities
(i.e. an intensity of <code>NA</code>). Parameter <code>msLevel.</code> allows to restrict the
filtering to spectra of the specified MS level(s).</p></li>
<li><p><code>filterIsolationWindow</code>: retains spectra that contain <code>mz</code> in their
isolation window m/z range (i.e. with an <code>isolationWindowLowerMz</code> &lt;= <code>mz</code>
and <code>isolationWindowUpperMz</code> &gt;= <code>mz</code>. Returns the filtered <code>Spectra</code>
object (with spectra in their original order).</p></li>
<li><p><code>filterMsLevel</code>: filters object by MS level keeping only spectra matching
the MS level specified with argument <code>msLevel</code>. Returns the filtered
<code>Spectra</code> (with spectra in their original order).</p></li>
<li><p><code>filterMzRange</code>: filters the object keeping or removing peaks in each
spectrum that are within the provided m/z range. Whether peaks are
retained or removed can be configured with parameter <code>keep</code> (default
<code>keep = TRUE</code>).</p></li>
<li><p><code>filterMzValues</code>: filters the object keeping <strong>all</strong> peaks in each
spectrum that match the provided m/z value(s) (for <code>keep = TRUE</code>, the
default) or removing <strong>all</strong> of them (for <code>keep = FALSE</code>). The m/z
matching considers also the absolute <code>tolerance</code> and m/z-relative
<code>ppm</code> values. <code>tolerance</code> and <code>ppm</code> have to be of length 1.</p></li>
<li><p><code>filterPolarity</code>: filters the object keeping only spectra matching the
provided polarity. Returns the filtered <code>Spectra</code> (with spectra in their
original order).</p></li>
<li><p><code>filterPrecursorCharge</code>: retains spectra with the defined precursor
charge(s).</p></li>
<li><p><code>filterPrecursorIsotopes</code>: groups MS2 spectra based on their precursor m/z
and precursor intensity into predicted isotope groups and keep for each
only the spectrum representing the monoisotopic precursor. MS1 spectra
are returned as is. See documentation for <code>deisotopeSpectra</code> below for
details on isotope prediction and parameter description.</p></li>
<li><p><code>filterPrecursorMaxIntensity</code>: filters the <code>Spectra</code> keeping for groups
of (MS2) spectra with similar precursor m/z values (given parameters
<code>ppm</code> and <code>tolerance</code>) the one with the highest precursor intensity. The
function filters only MS2 spectra and returns all MS1 spectra. If
precursor intensities are <code>NA</code> for all spectra within a spectra group, the
first spectrum of that groups is returned.
Note: some manufacturers don't provide precursor intensities. These can
however also be estimated with <code><a href="estimatePrecursorIntensity.html">estimatePrecursorIntensity()</a></code>.</p></li>
<li><p><code>filterPrecursorMzRange</code> (previously <code>filterPrecursorMz</code> which is now
deprecated): retains spectra with a precursor m/z within the
provided m/z range. See examples for details on selecting spectra with
a precursor m/z for a target m/z accepting a small difference in <em>ppm</em>.</p></li>
<li><p><code>filterPrecursorMzValues</code>: retains spectra with precursor m/z matching any
of the provided m/z values (given <code>ppm</code> and <code>tolerance</code>). Spectra with
missing precursor m/z value (e.g. MS1 spectra) are dropped.</p></li>
<li><p><code>filterPrecursorPeaks</code>: removes peaks from each spectrum in <code>object</code> with
an m/z equal or larger than the m/z of the precursor, depending on the
value of parameter <code>mz</code>: for <code>mz = ==" (the default) peaks with matching m/z (considering an absolute and relative acceptable difference depending on </code>tolerance<code>and</code>ppm<code>, respectively) are removed. For </code>mz = "&gt;="<code>all peaks with an m/z larger or equal to the precursor m/z (minus</code>tolerance<code>and the</code>ppm<code>of the precursor m/z) are removed. Parameter</code>msLevel.<code>allows to restrict the filter to certain MS levels (by default the filter is applied to all MS levels). Note that no peaks are removed if the precursor m/z is</code>NA` (e.g. typically for MS1 spectra).</p></li>
<li><p><code>filterPrecursorScan</code>: retains parent (e.g. MS1) and children scans (e.g.
MS2) of acquisition number <code>acquisitionNum</code>. Returns the filtered
<code>Spectra</code> (with spectra in their original order). Parameter <code>f</code> allows to
define which spectra belong to the same sample or original data file (
defaults to <code>f = dataOrigin(object)</code>).</p></li>
<li><p><code>filterRt</code>: retains spectra of MS level <code>msLevel</code> with retention
times (in seconds) within (<code>&gt;=</code>) <code>rt[1]</code> and (<code>&lt;=</code>)
<code>rt[2]</code>. Returns the filtered <code>Spectra</code> (with spectra in their
original order).</p></li>
<li><p><code>reduceSpectra</code>: for groups of peaks within highly similar m/z values
within each spectrum (given <code>ppm</code> and <code>tolerance</code>), this function keeps
only the peak with the highest intensity removing all other peaks hence
<em>reducing</em> each spectrum to the highest intensity peaks per <em>peak group</em>.
Peak groups are defined using the <code><a href="https://rdrr.io/r/grDevices/plotmath.html" class="external-link">group()</a></code> function from the
<em>MsCoreUtils</em> package.</p></li>
<li><p><code>reset</code>: restores the data to its original state (as much as possible):
removes any processing steps from the lazy processing queue and calls
<code>reset</code> on the backend which, depending on the backend, can also undo e.g.
data filtering operations. Note that a <code>reset</code> call after <code>applyProcessing</code>
will not have any effect. See examples below for more information.</p></li>
<li><p><code>selectSpectraVariables</code>: reduces the information within the object to
the selected spectra variables: all data for variables not specified will
be dropped. For mandatory columns (i.e., those listed by
<code>coreSpectraVariables()</code>, such as <em>msLevel</em>, <em>rtime</em> ...) only
the values will be dropped but not the variable itself. Additional (or
user defined) spectra variables will be completely removed.
Returns the filtered <code>Spectra</code>.</p></li>
<li><p><code>split</code>: splits the <code>Spectra</code> object based on parameter <code>f</code> into a <code>list</code>
of <code>Spectra</code> objects.</p></li>
<li><p><code>joinSpectraData</code>: Individual spectra variables can be directly
added with the <code>$&lt;-</code> or <code>[[&lt;-</code> syntax. The <code>joinSpectraData()</code>
function allows to merge a <code>DataFrame</code> to the existing spectra
data. This function diverges from the <code><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge()</a></code> method in two
main ways:</p><ul><li><p>The <code>by.x</code> and <code>by.y</code> column names must be of length 1.</p></li>
<li><p>If variable names are shared in <code>x</code> and <code>y</code>, the spectra
variables of <code>x</code> are not modified. It's only the <code>y</code>
variables that are appended the suffix defined in
<code>suffix.y</code>. This is to avoid modifying any core spectra
variables that would lead to an invalid object.</p></li>
<li><p>Duplicated Spectra keys (i.e. <code>x[[by.x]]</code>) are not
allowed. Duplicated keys in the <code>DataFrame</code> (i.e <code>y[[by.y]]</code>)
throw a warning and only the last occurrence is kept. These
should be explored and ideally be removed using for
<code>QFeatures::reduceDataFrame()</code>, <code>PMS::reducePSMs()</code> or similar
functions.</p></li>
</ul></li>
</ul><p>Several <code>Spectra</code> objects can be concatenated into a single object with the
<code>c</code> or the <code>concatenateSpectra</code> function. Concatenation will fail if the
processing queue of any of the <code>Spectra</code> objects is not empty or if
different backends are used in the <code>Spectra</code> objects. The spectra variables
of the resulting <code>Spectra</code> object is the union of the spectra variables of
the individual <code>Spectra</code> objects.</p>
    </div>
    <div class="section level2">
    <h2 id="data-manipulation-and-analysis-methods">Data manipulation and analysis methods<a class="anchor" aria-label="anchor" href="#data-manipulation-and-analysis-methods"></a></h2>
    


<p>Many data manipulation operations, such as those listed in this section, are
not applied immediately to the spectra, but added to a
<em>lazy processing/manipulation queue</em>. Operations stored in this queue are
applied on-the-fly to spectra data each time it is accessed. This lazy
execution guarantees the same functionality for <code>Spectra</code> objects with
any backend, i.e. backends supporting to save changes to spectrum data
(<a href="MsBackend.html">MsBackendMemory</a>, <code><a href="MsBackend.html">MsBackendDataFrame()</a></code> or <code><a href="MsBackend.html">MsBackendHdf5Peaks()</a></code>) as
well as read-only backends (such as the <code><a href="MsBackend.html">MsBackendMzR()</a></code>).
Note that for the former it is possible to apply the processing queue and
write the modified peak data back to the data storage with the
<code>applyProcessing</code> function.</p><ul><li><p><code>addProcessing</code>: adds an arbitrary function that should be applied to the
peaks matrix of every spectrum in <code>object</code>. The function (can be passed
with parameter <code>FUN</code>) is expected to take a peaks matrix as input and to
return a peaks matrix. A peaks matrix is a numeric matrix with two columns,
the first containing the m/z values of the peaks and the second the
corresponding intensities. The function has to have <code>...</code> in its
definition. Additional arguments can be passed with <code>...</code>. With parameter
<code>spectraVariables</code> it is possible to define additional spectra variables
from <code>object</code> that should be passed to the function <code>FUN</code>. These will be
passed by their name (e.g. specifying <code>spectraVariables = "precursorMz"</code>
will pass the spectra's precursor m/z as a parameter named <code>precursorMz</code>
to the function. The only exception is the spectra's MS level, these will
be passed to the function as a parameter called <code>spectrumMsLevel</code> (i.e.
with <code>spectraVariables = "msLevel"</code> the MS levels of each spectrum will be
submitted to the function as a parameter called <code>spectrumMsLevel</code>).
Examples are provided in the package vignette.</p></li>
<li><p><code>applyProcessing</code>: for <code>Spectra</code> objects that use a <strong>writeable</strong> backend
only: apply all steps from the lazy processing queue to the peak data and
write it back to the data storage. Parameter <code>f</code> allows to specify how
<code>object</code> should be split for parallel processing. This should either be
equal to the <code>dataStorage</code>, or <code>f = rep(1, length(object))</code> to disable
parallel processing alltogether. Other partitionings might result in
errors (especially if a <code>MsBackendHdf5Peaks</code> backend is used).</p></li>
<li><p><code>bin</code>: aggregates individual spectra into discrete (m/z) bins. Binning is
performed only on spectra of the specified MS level(s) (parameter
<code>msLevel</code>, by default all MS levels of <code>x</code>). The bins can be defined with
parameter <code>breaks</code> which by default are equally sized bins, with size
being defined by parameter <code>binSize</code>, from the minimal to the maximal m/z
of all spectra (of MS level <code>msLevel</code>) within <code>x</code>. The same bins are used
for all spectra in <code>x</code>. All intensity values for peaks falling into the
same bin are aggregated using the function provided with parameter <code>FUN</code>
(defaults to <code>FUN = sum</code>, i.e. all intensities are summed up). Note that
the binning operation is applied to the peak data on-the-fly upon data
access and it is possible to <em>revert</em> the operation with the <code>reset</code>
function (see description of <code>reset</code> above).</p></li>
<li><p><code>combinePeaks</code>: combines mass peaks within each spectrum with a difference
in their m/z values that is smaller than the maximal acceptable difference
defined by <code>ppm</code> and <code>tolerance</code>. Parameters <code>intensityFun</code> and <code>mzFun</code>
allow to define functions to aggregate the intensity and m/z values for
each such group of peaks. With <code>weighted = TRUE</code> (the default), the m/z
value of the combined peak is calculated using an intensity-weighted mean
and parameter <code>mzFun</code> is ignored. The <code><a href="https://rdrr.io/pkg/MsCoreUtils/man/group.html" class="external-link">MsCoreUtils::group()</a></code> function is
used for the grouping of mass peaks. Parameter <code>msLevel.</code> allows to
define selected MS levels for which peaks should be combined. This
function returns a <code>Spectra</code> with the same number of spectra than the
input object, but with possibly combined peaks within each spectrum.
Additional peak variables (other than <code>"mz"</code> and <code>"intensity"</code>) are
dropped (i.e. their values are replaced with <code>NA</code>) for combined peaks
unless they are constant across the combined peaks. See also
<code>reduceSpectra</code> for a function to select a single <em>representative</em>
mass peak for each peak group.</p></li>
<li><p><code>combineSpectra</code>: combines sets of spectra into a single spectrum per set.
For each spectrum group (set), spectra variables from the first spectrum
are used and the peak matrices are combined using the function specified
with <code>FUN</code>, which defaults to <code><a href="combinePeaksData.html">combinePeaksData()</a></code>. Please refer to the
<code><a href="combinePeaksData.html">combinePeaksData()</a></code> help page for details and options of the actual
combination of peaks across the sets of spectra and to the package vignette
for examples and alternative ways to aggregate spectra.
The sets of spectra can be specified with parameter <code>f</code>.
In addition it is possible to define, with parameter <code>p</code> if and how to
split the input data for parallel processing.
This defaults to <code>p = x$dataStorage</code> and hence a per-file parallel
processing is applied for <code>Spectra</code> with file-based backends (such as the
<code><a href="MsBackend.html">MsBackendMzR()</a></code>).
Prior combination of the spectra all processings queued in the lazy
evaluation queue are applied. Be aware that calling <code>combineSpectra</code> on a
<code>Spectra</code> object with certain backends that allow modifications might
<strong>overwrite</strong> the original data. This does not happen with a
<code>MsBackendMemory</code> or <code>MsBackendDataFrame</code> backend, but with a
<code>MsBackendHdf5Peaks</code> backend the m/z and intensity values in the original
hdf5 file(s) will be overwritten.
The function returns a <code>Spectra</code> of length equal to the unique levels
of <code>f</code>.</p></li>
<li><p><code>compareSpectra</code>: compares each spectrum in <code>x</code> with each spectrum in <code>y</code>
using the function provided with <code>FUN</code> (defaults to <code>ndotproduct()</code>). If
<code>y</code> is missing, each spectrum in <code>x</code> is compared with each other spectrum
in <code>x</code>.
The matching/mapping of peaks between the compared spectra is done with the
<code>MAPFUN</code> function. The default <code><a href="joinPeaks.html">joinPeaks()</a></code> matches peaks of both spectra
and allows to keep all peaks from the first spectrum (<code>type = "left"</code>),
from the second (<code>type = "right"</code>), from both (<code>type = "outer"</code>) and to
keep only matching peaks (<code>type = "inner"</code>); see <code><a href="joinPeaks.html">joinPeaks()</a></code> for more
information and examples). The <code>MAPFUN</code> function should have parameters
<code>x</code>, <code>y</code>, <code>xPrecursorMz</code> and <code>yPrecursorMz</code> as these values are passed to
the function. In addition to <code><a href="joinPeaks.html">joinPeaks()</a></code> also <code><a href="joinPeaks.html">joinPeaksGnps()</a></code> is
supported for GNPS-like similarity score calculations. Note that
<code>joinPeaksGnps</code> should only be used in combination with
<code>FUN = MsCoreUtils::gnps</code> (see <code><a href="joinPeaks.html">joinPeaksGnps()</a></code> for more information and
details). Use <code>MAPFUN = joinPeaksNone</code> to disable internal peak
matching/mapping if a similarity scoring function is used that performs
the matching internally.
<code>FUN</code> is supposed to be a function to compare intensities of (matched)
peaks of the two spectra that are compared. The function needs to take two
matrices with columns <code>"mz"</code> and <code>"intensity"</code> as input and is supposed
to return a single numeric as result. In addition to the two peak matrices
the spectra's precursor m/z values are passed to the function as parameters
<code>xPrecursorMz</code> (precursor m/z of the <code>x</code> peak matrix) and <code>yPrecursorMz</code>
(precursor m/z of the <code>y</code> peak matrix). Additional parameters to functions
<code>FUN</code> and <code>MAPFUN</code> can be passed with <code>...</code>. Parameters <code>ppm</code> and
<code>tolerance</code> are passed to both <code>MAPFUN</code> and <code>FUN</code>.
The function returns a <code>matrix</code> with the results of <code>FUN</code> for each
comparison, number of rows equal to <code>length(x)</code> and number of columns
equal <code>length(y)</code> (i.e. element in row 2 and column 3 is the result from
the comparison of <code>x[2]</code> with <code>y[3]</code>). If <code>SIMPLIFY = TRUE</code> the <code>matrix</code>
is <em>simplified</em> to a <code>numeric</code> if length of <code>x</code> or <code>y</code> is one. See also
the vignette for additional examples, such as using spectral entropy
similarity in the scoring.</p></li>
<li><p><code>deisotopeSpectra</code>: <em>deisotopes</em> each spectrum keeping only the
monoisotopic peak for groups of isotopologues. Isotopologues are
estimated using the <code>isotopologues()</code> function from the <em>MetaboCoreUtils</em>
package. Note that the default parameters for isotope
prediction/detection have been determined using data from the Human
Metabolome Database (HMDB) and isotopes for elements other than CHNOPS
might not be detected. See parameter <code>substDefinition</code> in the
documentation of <code>isotopologues()</code> for more information. The approach
and code to define the parameters for isotope prediction is described
<a href="https://github.com/EuracBiomedicalResearch/isotopologues" class="external-link">here</a>.</p></li>
<li><p><code>estimatePrecursorIntensity</code>: defines the precursor intensities for MS2
spectra using the intensity of the matching MS1 peak from the
closest MS1 spectrum (i.e. the last MS1 spectrum measured before the
respective MS2 spectrum). With <code>method = "interpolation"</code> it is also
possible to calculate the precursor intensity based on an interpolation of
intensity values (and retention times) of the matching MS1 peaks from the
previous and next MS1 spectrum. See <code><a href="estimatePrecursorIntensity.html">estimatePrecursorIntensity()</a></code> for
examples and more details.</p></li>
<li><p><code>neutralLoss</code>: calculates neutral loss spectra for fragment spectra. See
<code><a href="neutralLoss.html">neutralLoss()</a></code> for detailed documentation.</p></li>
<li><p><code>processingLog</code>: returns a <code>character</code> vector with the processing log
messages.</p></li>
<li><p><code>reduceSpectra</code>: keeps for groups of peaks with similar m/z values in
(given <code>ppm</code> and <code>tolerance</code>) in each spectrum only the peak with the
highest intensity removing all other peaks hence <em>reducing</em> each
spectrum to the highest intensity peaks per <em>peak group</em>.
Peak groups are defined using the <code><a href="https://rdrr.io/r/grDevices/plotmath.html" class="external-link">group()</a></code> function from the
<em>MsCoreUtils</em> package. See also the <code>combinePeaks</code> function for an
alternative function to combine peaks within each spectrum.</p></li>
<li><p><code>scalePeaks</code>: scales intensities of peaks within each spectrum depending on
parameter <code>by</code>. With <code>by = sum</code> (the default) peak intensities are divided
by the sum of peak intensities within each spectrum. The sum of
intensities is thus 1 for each spectrum after scaling. Parameter
<code>msLevel.</code> allows to apply the scaling of spectra of a certain MS level.
By default (<code>msLevel. = uniqueMsLevels(x)</code>) intensities for all
spectra will be scaled.</p></li>
<li><p><code>spectrapply</code>: applies a given function to each individual spectrum or sets
of a <code>Spectra</code> object. By default, the <code>Spectra</code> is split into individual
spectra (i.e. <code>Spectra</code> of length 1) and the function <code>FUN</code> is applied to
each of them. An alternative splitting can be defined with parameter <code>f</code>.
Parameters for <code>FUN</code> can be passed using <code>...</code>.
The returned result and its order depend on the function <code>FUN</code> and how
<code>object</code> is split (hence on <code>f</code>, if provided). Parallel processing is
supported and can be configured with parameter <code>BPPARAM</code>, is however only
suggested for computational intense <code>FUN</code>.
As an alternative to the (eventual parallel) processing of the full
<code>Spectra</code>, <code>spectrapply</code> supports also a chunk-wise processing. For this,
parameter <code>chunkSize</code> needs to be specified. <code>object</code> is then split into
chunks of size <code>chunkSize</code> which are then (stepwise) processed by <code>FUN</code>.
This guarantees a lower memory demand (especially for on-disk backends)
since only the data for one chunk needs to be loaded into memory in each
iteration. Note that by specifying <code>chunkSize</code>, parameters <code>f</code> and
<code>BPPARAM</code> will be ignored.
See also <code><a href="chunkapply.html">chunkapply()</a></code> or examples below for details on chunk-wise
processing.</p></li>
<li><p><code>smooth</code>: smooths individual spectra using a moving window-based approach
(window size = <code>2 * halfWindowSize</code>). Currently, the
Moving-Average- (<code>method = "MovingAverage"</code>),
Weighted-Moving-Average- (<code>method = "WeightedMovingAverage")</code>,
weights depending on the distance of the center and calculated
<code>1/2^(-halfWindowSize:halfWindowSize)</code>) and
Savitzky-Golay-Smoothing (<code>method = "SavitzkyGolay"</code>) are supported.
For details how to choose the correct <code>halfWindowSize</code> please see
<code><a href="https://rdrr.io/pkg/MsCoreUtils/man/smooth.html" class="external-link">MsCoreUtils::smooth()</a></code>.</p></li>
<li><p><code>pickPeaks</code>: picks peaks on individual spectra using a moving window-based
approach (window size = <code>2 * halfWindowSize</code>). For noisy spectra there
are currently two different noise estimators available,
the <em>M</em>edian <em>A</em>bsolute <em>D</em>eviation (<code>method = "MAD"</code>) and
Friedman's Super Smoother (<code>method = "SuperSmoother"</code>),
as implemented in the <code><a href="https://rdrr.io/pkg/MsCoreUtils/man/noise.html" class="external-link">MsCoreUtils::noise()</a></code>.
The method supports also to optionally <em>refine</em> the m/z value of
the identified centroids by considering data points that belong (most
likely) to the same mass peak. Therefore the m/z value is calculated as an
intensity weighted average of the m/z values within the peak region.
The peak region is defined as the m/z values (and their respective
intensities) of the <code>2 * k</code> closest signals to the centroid or the closest
valleys (<code>descending = TRUE</code>) in the <code>2 * k</code> region. For the latter the <code>k</code>
has to be chosen general larger. See <code><a href="https://rdrr.io/pkg/MsCoreUtils/man/refineCentroids.html" class="external-link">MsCoreUtils::refineCentroids()</a></code> for
details.
If the ratio of the signal to the highest intensity of the peak is below
<code>threshold</code> it will be ignored for the weighted average.</p></li>
<li><p><code>replaceIntensitiesBelow</code>: replaces intensities below a specified
threshold with the provided <code>value</code>. Parameter <code>threshold</code> can be either
a single numeric value or a function which is applied to all non-<code>NA</code>
intensities of each spectrum to determine a threshold value for each
spectrum. The default is <code>threshold = min</code> which replaces all values
which are &lt;= the minimum intensity in a spectrum with <code>value</code> (the
default for <code>value</code> is <code>0</code>). Note that the function specified with
<code>threshold</code> is expected to have a parameter <code>na.rm</code> since <code>na.rm = TRUE</code>
will be passed to the function. If the spectrum is in profile mode,
ranges of successive non-0 peaks &lt;= <code>threshold</code> are set to 0.
Parameter <code>msLevel.</code> allows to apply this to only spectra of certain MS
level(s).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="parallel-processing">Parallel processing<a class="anchor" aria-label="anchor" href="#parallel-processing"></a></h2>
    


<p>Some <code>Spectra</code> functions have build-in parallel processing that can be
configured by passing the parallel processing setup with the <code>BPPARAM</code>
function argument (which defaults to <code>BPPARAM = bpparam()</code>, thus uses
the default set up). Most functions have an additional parameter <code>f</code> that
allows to define how <code>Spectra</code> will be split to perform parallel processing.
This parameter <code>f</code> defaults to <code>f = dataStorage(object)</code> and hence
parallel processing is performed <em>by file</em> (if a file-based, on-disk
backend such as <code>MsBackendMzR</code> is used). Some <code>MsBackend</code> classes might
however not support parallel processing. The <code>backendBpparam</code> function
allows to evaluate wheter a <code>Spectra</code> (respectively its <code>MsBackend</code>)
supports a certain parallel processing setup. Calling
<code>backendBpparam(sps, BPPARAM = MulticoreParam(3))</code> on a <code>Spectra</code> object
<code>sps</code> would return <code>SerialParam()</code> in case the backend of the <code>Spectra</code>
object does not support parallel processing. All functions listed below
use this same function to eventually disable parallel processing to
avoid failure of a function call.</p>
<p>The functions with build-in parallel processing capabilities are:</p><ul><li><p><code>applyProcessing</code>.</p></li>
<li><p><code>combineSpectra</code>.</p></li>
<li><p><code>containsMz</code> (does not provide a parameter <code>f</code>, but performs parallel
processing separate for <code>dataStorage</code>).</p></li>
<li><p><code>containsNeutralLoss</code> (same as <code>containsMz</code>).</p></li>
<li><p><code>estimatePrecursorIntensity</code>.</p></li>
<li><p><code>setBackend</code>.</p></li>
<li><p><code>Spectra</code> (that passes the <code>BPPARAM</code> to the <code>backendInitialize</code> of the
used <code>MsBackend</code>).</p></li>
<li><p><code>spectrapply</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Nir Shahaf, Johannes Rainer</p>
<p>Nir Shahaf</p>
<p>Johannes Rainer</p>
<p>Sebastian Gibb, Johannes Rainer, Laurent Gatto</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create a Spectra providing a `DataFrame` containing the spectrum data.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">spd</span> <span class="op">&lt;-</span> <span class="fu">DataFrame</span><span class="op">(</span>msLevel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span>, rtime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spd</span><span class="op">$</span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">103.2</span>, <span class="fl">104.3</span>, <span class="fl">106.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">45.6</span>, <span class="fl">120.4</span>, <span class="fl">190.2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spd</span><span class="op">$</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">400</span>, <span class="fl">34.2</span>, <span class="fl">17</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.3</span>, <span class="fl">15.2</span>, <span class="fl">6.8</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">Spectra</span><span class="op">(</span><span class="va">spd</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 2 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1       1.1        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         2       1.2        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 16 more variables/columns.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get the number of spectra</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get the number of peaks per spectrum</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 4 3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create a Spectra from mzML files and use the `MsBackendMzR` on-disk</span></span></span>
<span class="r-in"><span><span class="co">## backend.</span></span></span>
<span class="r-in"><span><span class="va">sciex_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"sciex"</span>, package <span class="op">=</span> <span class="st">"msdata"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sciex</span> <span class="op">&lt;-</span> <span class="fu">Spectra</span><span class="op">(</span><span class="va">sciex_file</span>, backend <span class="op">=</span> <span class="fu"><a href="MsBackend.html">MsBackendMzR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sciex</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 1862 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            1     0.280         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            1     0.559         2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            1     0.838         3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            1     1.117         4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            1     1.396         5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...        ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1858         1   258.636       927</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1859         1   258.915       928</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1860         1   259.194       929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1861         1   259.473       930</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1862         1   259.752       931</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 33 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20171016_POOL_POS_1_105-134.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20171016_POOL_POS_3_105-134.mzML</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The MS data is on disk and will be read into memory on-demand. We can</span></span></span>
<span class="r-in"><span><span class="co">## however change the backend to a MsBackendMemory backend which will</span></span></span>
<span class="r-in"><span><span class="co">## keep all of the data in memory.</span></span></span>
<span class="r-in"><span><span class="va">sciex_im</span> <span class="op">&lt;-</span> <span class="fu"><a href="hidden_aliases.html">setBackend</a></span><span class="op">(</span><span class="va">sciex</span>, <span class="fu"><a href="MsBackend.html">MsBackendMemory</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sciex_im</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 1862 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            1     0.280         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            1     0.559         2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            1     0.838         3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            1     1.117         4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            1     1.396         5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...        ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1858         1   258.636       927</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1859         1   258.915       928</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1860         1   259.194       929</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1861         1   259.473       930</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1862         1   259.752       931</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 33 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Switch backend from MsBackendMzR to MsBackendMemory [Mon Nov 20 14:33:56 2023] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The `MsBackendMemory()` supports the `setBackend` method:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="MsBackend.html">supportsSetBackend</a></span><span class="op">(</span><span class="fu"><a href="MsBackend.html">MsBackendMemory</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Thus, it is possible to change to that backend with `setBackend`. Most</span></span></span>
<span class="r-in"><span><span class="co">## read-only backends however don't support that, such as the</span></span></span>
<span class="r-in"><span><span class="co">## `MsBackendMzR` and `setBackend` would fail to change to that backend.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="MsBackend.html">supportsSetBackend</a></span><span class="op">(</span><span class="fu"><a href="MsBackend.html">MsBackendMzR</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The on-disk object `sciex` is light-weight, because it does not keep the</span></span></span>
<span class="r-in"><span><span class="co">## MS peak data in memory. The `sciex_im` object in contrast keeps all the</span></span></span>
<span class="r-in"><span><span class="co">## data in memory and its size is thus much larger.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">sciex</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 395808 bytes</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">sciex_im</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 55802160 bytes</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The spectra variable `dataStorage` returns for each spectrum the location</span></span></span>
<span class="r-in"><span><span class="co">## where the data is stored. For in-memory objects:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">dataStorage</span><span class="op">(</span><span class="va">sciex_im</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## While objects that use an on-disk backend will list the files where the</span></span></span>
<span class="r-in"><span><span class="co">## data is stored.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">dataStorage</span><span class="op">(</span><span class="va">sciex</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The spectra variable `dataOrigin` returns for each spectrum the *origin*</span></span></span>
<span class="r-in"><span><span class="co">## of the data. If the data is read from e.g. mzML files, this will be the</span></span></span>
<span class="r-in"><span><span class="co">## original mzML file name:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">dataOrigin</span><span class="op">(</span><span class="va">sciex</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">dataOrigin</span><span class="op">(</span><span class="va">sciex_im</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ---- ACCESSING AND ADDING DATA ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get the MS level for each spectrum.</span></span></span>
<span class="r-in"><span><span class="fu">msLevel</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Alternatively, we could also use $ to access a specific spectra variable.</span></span></span>
<span class="r-in"><span><span class="co">## This could also be used to add additional spectra variables to the</span></span></span>
<span class="r-in"><span><span class="co">## object (see further below).</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">$</span><span class="va">msLevel</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get the intensity and m/z values.</span></span></span>
<span class="r-in"><span><span class="fu">intensity</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NumericList of length 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]] 200 400 34.2 17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]] 12.3 15.2 6.8</span>
<span class="r-in"><span><span class="fu">mz</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NumericList of length 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]] 100 103.2 104.3 106.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]] 45.6 120.4 190.2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Determine whether one of the spectra has a specific m/z value</span></span></span>
<span class="r-in"><span><span class="fu"><a href="hidden_aliases.html">containsMz</a></span><span class="op">(</span><span class="va">data</span>, mz <span class="op">=</span> <span class="fl">120.4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE  TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Accessing spectra variables works for all backends:</span></span></span>
<span class="r-in"><span><span class="fu">intensity</span><span class="op">(</span><span class="va">sciex</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NumericList of length 1862</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]] 0 412 0 0 412 0 0 412 0 0 412 0 0 ... 0 412 0 0 412 0 0 412 0 0 412 412 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]] 0 140 0 0 140 0 0 419 0 0 140 0 0 ... 0 140 0 0 140 0 0 140 0 0 279 140 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[3]] 0 132 263 263 132 132 0 0 132 132 0 0 ... 0 0 132 0 0 132 0 0 132 0 132 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[4]] 0 139 139 0 0 139 0 0 139 139 0 139 0 ... 0 0 139 0 0 277 0 0 139 0 139 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[5]] 0 164 0 0 328 0 164 0 0 164 0 0 164 ... 164 0 0 164 0 0 164 0 164 0 328 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[6]] 0 146 146 146 0 0 146 0 0 146 0 0 ... 146 0 0 146 146 0 0 146 0 0 146 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[7]] 0 296 0 296 0 0 148 0 0 148 0 0 148 ... 0 0 148 0 0 148 0 0 148 0 0 148 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[8]] 0 170 0 170 170 170 0 170 0 0 170 0 ... 170 0 0 170 0 0 170 0 0 170 170 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[9]] 0 157 0 314 0 0 157 0 0 157 0 0 314 ... 0 0 157 0 0 157 0 0 157 0 157 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[10]] 0 151 302 302 604 0 302 0 0 151 0 0 ... 151 0 0 151 0 151 0 151 0 151 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;1852 more elements&gt;</span>
<span class="r-in"><span><span class="fu">intensity</span><span class="op">(</span><span class="va">sciex_im</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NumericList of length 1862</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]] 0 412 0 0 412 0 0 412 0 0 412 0 0 ... 0 412 0 0 412 0 0 412 0 0 412 412 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]] 0 140 0 0 140 0 0 419 0 0 140 0 0 ... 0 140 0 0 140 0 0 140 0 0 279 140 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[3]] 0 132 263 263 132 132 0 0 132 132 0 0 ... 0 0 132 0 0 132 0 0 132 0 132 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[4]] 0 139 139 0 0 139 0 0 139 139 0 139 0 ... 0 0 139 0 0 277 0 0 139 0 139 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[5]] 0 164 0 0 328 0 164 0 0 164 0 0 164 ... 164 0 0 164 0 0 164 0 164 0 328 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[6]] 0 146 146 146 0 0 146 0 0 146 0 0 ... 146 0 0 146 146 0 0 146 0 0 146 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[7]] 0 296 0 296 0 0 148 0 0 148 0 0 148 ... 0 0 148 0 0 148 0 0 148 0 0 148 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[8]] 0 170 0 170 170 170 0 170 0 0 170 0 ... 170 0 0 170 0 0 170 0 0 170 170 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[9]] 0 157 0 314 0 0 157 0 0 157 0 0 314 ... 0 0 157 0 0 157 0 0 157 0 157 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[10]] 0 151 302 302 604 0 302 0 0 151 0 0 ... 151 0 0 151 0 151 0 151 0 151 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;1852 more elements&gt;</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get the m/z for the first spectrum.</span></span></span>
<span class="r-in"><span><span class="fu">mz</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 100.0 103.2 104.3 106.5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get the peak data (m/z and intensity values).</span></span></span>
<span class="r-in"><span><span class="va">pks</span> <span class="op">&lt;-</span> <span class="fu"><a href="hidden_aliases.html">peaksData</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pks</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of length 2</span>
<span class="r-in"><span><span class="va">pks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mz intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 100.0     200.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 103.2     400.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 104.3      34.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] 106.5      17.0</span>
<span class="r-in"><span><span class="va">pks</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mz intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  45.6      12.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 120.4      15.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 190.2       6.8</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Note that we could get the same resulb by coercing the `Spectra` to</span></span></span>
<span class="r-in"><span><span class="co">## a `list` or `SimpleList`:</span></span></span>
<span class="r-in"><span><span class="fu">as</span><span class="op">(</span><span class="va">data</span>, <span class="st">"list"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mz intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 100.0     200.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 103.2     400.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 104.3      34.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] 106.5      17.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mz intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  45.6      12.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 120.4      15.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 190.2       6.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu">as</span><span class="op">(</span><span class="va">data</span>, <span class="st">"SimpleList"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of length 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## List all available spectra variables (i.e. spectrum data and metadata).</span></span></span>
<span class="r-in"><span><span class="fu">spectraVariables</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "msLevel"                 "rtime"                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3] "acquisitionNum"          "scanIndex"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5] "dataStorage"             "dataOrigin"             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "centroided"              "smoothed"               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] "polarity"                "precScanNum"            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] "precursorMz"             "precursorIntensity"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "precursorCharge"         "collisionEnergy"        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15] "isolationWindowLowerMz"  "isolationWindowTargetMz"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17] "isolationWindowUpperMz" </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## For all *core* spectrum variables accessor functions are available. These</span></span></span>
<span class="r-in"><span><span class="co">## return NA if the variable was not set.</span></span></span>
<span class="r-in"><span><span class="fu">centroided</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] NA NA</span>
<span class="r-in"><span><span class="fu">dataStorage</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "&lt;memory&gt;" "&lt;memory&gt;"</span>
<span class="r-in"><span><span class="fu">rtime</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.1 1.2</span>
<span class="r-in"><span><span class="fu">precursorMz</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] NA NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The core spectra variables are:</span></span></span>
<span class="r-in"><span><span class="fu">coreSpectraVariables</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 msLevel                   rtime          acquisitionNum </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               "integer"               "numeric"               "integer" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               scanIndex                      mz               intensity </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               "integer"           "NumericList"           "NumericList" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             dataStorage              dataOrigin              centroided </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             "character"             "character"               "logical" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                smoothed                polarity             precScanNum </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               "logical"               "integer"               "integer" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             precursorMz      precursorIntensity         precursorCharge </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               "numeric"               "numeric"               "integer" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         collisionEnergy  isolationWindowLowerMz isolationWindowTargetMz </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               "numeric"               "numeric"               "numeric" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  isolationWindowUpperMz </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               "numeric" </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Add an additional metadata column.</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">$</span><span class="va">spectrum_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp_1"</span>, <span class="st">"sp_2"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## List spectra variables, "spectrum_id" is now also listed</span></span></span>
<span class="r-in"><span><span class="fu">spectraVariables</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "msLevel"                 "rtime"                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3] "acquisitionNum"          "scanIndex"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5] "dataStorage"             "dataOrigin"             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "centroided"              "smoothed"               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] "polarity"                "precScanNum"            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] "precursorMz"             "precursorIntensity"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "precursorCharge"         "collisionEnergy"        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15] "isolationWindowLowerMz"  "isolationWindowTargetMz"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17] "isolationWindowUpperMz"  "spectrum_id"            </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get the values for the new spectra variable</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">$</span><span class="va">spectrum_id</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "sp_1" "sp_2"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Extract specific spectra variables.</span></span></span>
<span class="r-in"><span><span class="fu">spectraData</span><span class="op">(</span><span class="va">data</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spectrum_id"</span>, <span class="st">"msLevel"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 2 rows and 2 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   spectrum_id   msLevel</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;character&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        sp_1         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        sp_2         2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Drop spectra variable data and/or columns.</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="hidden_aliases.html">selectSpectraVariables</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"intensity"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## This removed the additional columns "spectrum_id" and deleted all values</span></span></span>
<span class="r-in"><span><span class="co">## for all spectra variables, except "mz" and "intensity".</span></span></span>
<span class="r-in"><span><span class="fu">spectraData</span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 2 rows and 17 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime acquisitionNum scanIndex dataStorage  dataOrigin</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt;      &lt;integer&gt; &lt;integer&gt; &lt;character&gt; &lt;character&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        NA        NA             NA        NA    &lt;memory&gt;          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        NA        NA             NA        NA    &lt;memory&gt;          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   centroided  smoothed  polarity precScanNum precursorMz precursorIntensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    &lt;logical&gt; &lt;logical&gt; &lt;integer&gt;   &lt;integer&gt;   &lt;numeric&gt;          &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         NA        NA        NA          NA          NA                 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         NA        NA        NA          NA          NA                 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   precursorCharge collisionEnergy isolationWindowLowerMz</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;integer&gt;       &lt;numeric&gt;              &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1              NA              NA                     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2              NA              NA                     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   isolationWindowTargetMz isolationWindowUpperMz</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 &lt;numeric&gt;              &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                      NA                     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                      NA                     NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Compared to the data before selectSpectraVariables.</span></span></span>
<span class="r-in"><span><span class="fu">spectraData</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 2 rows and 18 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime acquisitionNum scanIndex dataStorage  dataOrigin</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt;      &lt;integer&gt; &lt;integer&gt; &lt;character&gt; &lt;character&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1       1.1             NA        NA    &lt;memory&gt;          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         2       1.2             NA        NA    &lt;memory&gt;          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   centroided  smoothed  polarity precScanNum precursorMz precursorIntensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    &lt;logical&gt; &lt;logical&gt; &lt;integer&gt;   &lt;integer&gt;   &lt;numeric&gt;          &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         NA        NA        NA          NA          NA                 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         NA        NA        NA          NA          NA                 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   precursorCharge collisionEnergy isolationWindowLowerMz</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         &lt;integer&gt;       &lt;numeric&gt;              &lt;numeric&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1              NA              NA                     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2              NA              NA                     NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   isolationWindowTargetMz isolationWindowUpperMz spectrum_id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 &lt;numeric&gt;              &lt;numeric&gt; &lt;character&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                      NA                     NA        sp_1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2                      NA                     NA        sp_2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ---- SUBSETTING, FILTERING AND COMBINING</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Subset to all MS2 spectra.</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">[</span><span class="fu">msLevel</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 1 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         2       1.2        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 17 more variables/columns.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Same with the filterMsLevel function</span></span></span>
<span class="r-in"><span><span class="fu">filterMsLevel</span><span class="op">(</span><span class="va">data</span>, <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 1 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         2       1.2        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 17 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select MS level(s) 2 [Mon Nov 20 14:33:57 2023] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Below we combine the `data` and `sciex_im` objects into a single one.</span></span></span>
<span class="r-in"><span><span class="va">data_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">sciex_im</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The combined Spectra contains a union of all spectra variables:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_comb</span><span class="op">$</span><span class="va">spectrum_id</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "sp_1" "sp_2" NA     NA     NA     NA    </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_comb</span><span class="op">$</span><span class="va">rtime</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.100 1.200 0.280 0.559 0.838 1.117</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_comb</span><span class="op">$</span><span class="va">dataStorage</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;" "&lt;memory&gt;"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_comb</span><span class="op">$</span><span class="va">dataOrigin</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] NA                                                                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] NA                                                                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] "/__w/_temp/Library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Filter a Spectra for a target precursor m/z with a tolerance of 10ppm</span></span></span>
<span class="r-in"><span><span class="va">spd</span><span class="op">$</span><span class="va">precursorMz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">323.4</span>, <span class="fl">543.2302</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data_filt</span> <span class="op">&lt;-</span> <span class="fu">Spectra</span><span class="op">(</span><span class="va">spd</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="hidden_aliases.html">filterPrecursorMzRange</a></span><span class="op">(</span><span class="va">data_filt</span>, mz <span class="op">=</span> <span class="fl">543.23</span> <span class="op">+</span> <span class="fu"><a href="hidden_aliases.html">ppm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">543.23</span>, <span class="fl">543.23</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 0 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select spectra with a precursor m/z within [543.2354323, 543.2354323] [Mon Nov 20 14:33:57 2023] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Filter a Spectra keeping only peaks matching certain m/z values</span></span></span>
<span class="r-in"><span><span class="va">sps_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="hidden_aliases.html">filterMzValues</a></span><span class="op">(</span><span class="va">data</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">103</span>, <span class="fl">104</span><span class="op">)</span>, tolerance <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mz</span><span class="op">(</span><span class="va">sps_sub</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NumericList of length 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]] 103.2 104.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]] numeric(0)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## This function can also be used to remove specific peaks from a spectrum</span></span></span>
<span class="r-in"><span><span class="co">## by setting `keep = FALSE`.</span></span></span>
<span class="r-in"><span><span class="va">sps_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="hidden_aliases.html">filterMzValues</a></span><span class="op">(</span><span class="va">data</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">103</span>, <span class="fl">104</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    tolerance <span class="op">=</span> <span class="fl">0.3</span>, keep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mz</span><span class="op">(</span><span class="va">sps_sub</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NumericList of length 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]] 100 106.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]] 45.6 120.4 190.2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Note that `filterMzValues` keeps or removes all peaks with a matching</span></span></span>
<span class="r-in"><span><span class="co">## m/z given the provided `ppm` and `tolerance` parameters.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Filter a Spectra keeping only peaks within a m/z range</span></span></span>
<span class="r-in"><span><span class="va">sps_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="hidden_aliases.html">filterMzRange</a></span><span class="op">(</span><span class="va">data</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mz</span><span class="op">(</span><span class="va">sps_sub</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NumericList of length 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]] 100 103.2 104.3 106.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]] 120.4 190.2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Remove empty spectra variables</span></span></span>
<span class="r-in"><span><span class="va">sciex_noNA</span> <span class="op">&lt;-</span> <span class="fu"><a href="hidden_aliases.html">dropNaSpectraVariables</a></span><span class="op">(</span><span class="va">sciex</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Available spectra variables before and after dropNaSpectraVariables</span></span></span>
<span class="r-in"><span><span class="fu">spectraVariables</span><span class="op">(</span><span class="va">sciex</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "msLevel"                  "rtime"                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3] "acquisitionNum"           "scanIndex"               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5] "dataStorage"              "dataOrigin"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "centroided"               "smoothed"                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] "polarity"                 "precScanNum"             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] "precursorMz"              "precursorIntensity"      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "precursorCharge"          "collisionEnergy"         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15] "isolationWindowLowerMz"   "isolationWindowTargetMz" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17] "isolationWindowUpperMz"   "peaksCount"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] "totIonCurrent"            "basePeakMZ"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21] "basePeakIntensity"        "ionisationEnergy"        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [23] "lowMZ"                    "highMZ"                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] "mergedScan"               "mergedResultScanNum"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [27] "mergedResultStartScanNum" "mergedResultEndScanNum"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [29] "injectionTime"            "filterString"            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] "spectrumId"               "ionMobilityDriftTime"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [33] "scanWindowLowerLimit"     "scanWindowUpperLimit"    </span>
<span class="r-in"><span><span class="fu">spectraVariables</span><span class="op">(</span><span class="va">sciex_noNA</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "msLevel"                 "rtime"                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3] "acquisitionNum"          "scanIndex"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5] "dataStorage"             "dataOrigin"             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "centroided"              "smoothed"               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] "polarity"                "precScanNum"            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] "precursorMz"             "precursorIntensity"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "precursorCharge"         "collisionEnergy"        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15] "isolationWindowLowerMz"  "isolationWindowTargetMz"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17] "isolationWindowUpperMz"  "peaksCount"             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] "totIonCurrent"           "basePeakMZ"             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21] "basePeakIntensity"       "ionisationEnergy"       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [23] "lowMZ"                   "highMZ"                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] "injectionTime"           "spectrumId"             </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Adding new spectra variables</span></span></span>
<span class="r-in"><span><span class="va">sciex1</span> <span class="op">&lt;-</span> <span class="fu">filterDataOrigin</span><span class="op">(</span><span class="va">sciex</span>, <span class="fu">dataOrigin</span><span class="op">(</span><span class="va">sciex</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spv</span> <span class="op">&lt;-</span> <span class="fu">DataFrame</span><span class="op">(</span>spectrumId <span class="op">=</span> <span class="va">sciex1</span><span class="op">$</span><span class="va">spectrumId</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span>, <span class="co">## used for merging</span></span></span>
<span class="r-in"><span>                 var1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 var2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">letters</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spv</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 10 rows and 3 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                spectrumId      var1        var2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               &lt;character&gt; &lt;numeric&gt; &lt;character&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  sample=1 period=1 cy..  1.964057           p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  sample=1 period=1 cy..  2.322677           g</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  sample=1 period=1 cy.. -1.244913           s</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  sample=1 period=1 cy.. -0.489530           e</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  sample=1 period=1 cy..  1.201910           n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  sample=1 period=1 cy.. -0.164557           q</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  sample=1 period=1 cy..  0.790417           w</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  sample=1 period=1 cy.. -0.239100           a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  sample=1 period=1 cy..  0.918414           i</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 sample=1 period=1 cy..  0.333789           y</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sciex2</span> <span class="op">&lt;-</span> <span class="fu">joinSpectraData</span><span class="op">(</span><span class="va">sciex1</span>, <span class="va">spv</span>, by.y <span class="op">=</span> <span class="st">"spectrumId"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">spectraVariables</span><span class="op">(</span><span class="va">sciex2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "msLevel"                  "rtime"                   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3] "acquisitionNum"           "scanIndex"               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5] "dataStorage"              "dataOrigin"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] "centroided"               "smoothed"                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] "polarity"                 "precScanNum"             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] "precursorMz"              "precursorIntensity"      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "precursorCharge"          "collisionEnergy"         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15] "isolationWindowLowerMz"   "isolationWindowTargetMz" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17] "isolationWindowUpperMz"   "peaksCount"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] "totIonCurrent"            "basePeakMZ"              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21] "basePeakIntensity"        "ionisationEnergy"        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [23] "lowMZ"                    "highMZ"                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] "mergedScan"               "mergedResultScanNum"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [27] "mergedResultStartScanNum" "mergedResultEndScanNum"  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [29] "injectionTime"            "filterString"            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] "spectrumId"               "ionMobilityDriftTime"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [33] "scanWindowLowerLimit"     "scanWindowUpperLimit"    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [35] "var1"                     "var2"                    </span>
<span class="r-in"><span><span class="fu">spectraData</span><span class="op">(</span><span class="va">sciex2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">13</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spectrumId"</span>, <span class="st">"var1"</span>, <span class="st">"var2"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DataFrame with 13 rows and 3 columns</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 spectrumId      var1        var2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                &lt;character&gt; &lt;numeric&gt; &lt;character&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   sample=1 period=1 cy..        NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   sample=1 period=1 cy..        NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   sample=1 period=1 cy..   1.96406           p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   sample=1 period=1 cy..   2.32268           g</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   sample=1 period=1 cy..  -1.24491           s</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...                    ...       ...         ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9   sample=1 period=1 cy..  0.790417           w</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10  sample=1 period=1 cy.. -0.239100           a</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11  sample=1 period=1 cy..  0.918414           i</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12  sample=1 period=1 cy..  0.333789           y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13  sample=1 period=1 cy..        NA          NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Removing fourier transform artefacts seen in Orbitra data.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Loading an Orbitrap spectrum with artefacts.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">fft_spectrum</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="spectra-plotting.html">plotSpectra</a></span><span class="op">(</span><span class="va">fft_spectrum</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">264.5</span>, <span class="fl">265.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="Spectra-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="spectra-plotting.html">plotSpectra</a></span><span class="op">(</span><span class="va">fft_spectrum</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">264.5</span>, <span class="fl">265.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5e6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="Spectra-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fft_spectrum</span> <span class="op">&lt;-</span> <span class="fu"><a href="filterFourierTransformArtefacts.html">filterFourierTransformArtefacts</a></span><span class="op">(</span><span class="va">fft_spectrum</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fft_spectrum</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 1 spectra in a MsBackendDataFrame backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1   367.665       195</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 33 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lazy evaluation queue: 1 processing step(s)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Switch backend from MsBackendMzR to MsBackendDataFrame [Mon Nov 22 14:14:45 2021]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Remove fast fourier artefacts. [Mon Nov 20 14:33:57 2023] </span>
<span class="r-in"><span><span class="fu"><a href="spectra-plotting.html">plotSpectra</a></span><span class="op">(</span><span class="va">fft_spectrum</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">264.5</span>, <span class="fl">265.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5e6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="Spectra-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Using a few examples peaks in your data you can optimize the parameters</span></span></span>
<span class="r-in"><span><span class="va">fft_spectrum_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="filterFourierTransformArtefacts.html">filterFourierTransformArtefacts</a></span><span class="op">(</span><span class="va">fft_spectrum</span>,</span></span>
<span class="r-in"><span>                                               halfWindowSize <span class="op">=</span> <span class="fl">0.2</span>,</span></span>
<span class="r-in"><span>                                               threshold <span class="op">=</span> <span class="fl">0.005</span>,</span></span>
<span class="r-in"><span>                                               keepIsotopes <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                                               maxCharge <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>                                               isotopeTolerance <span class="op">=</span> <span class="fl">0.005</span></span></span>
<span class="r-in"><span>                                               <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fft_spectrum_filtered</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 1 spectra in a MsBackendDataFrame backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1   367.665       195</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 33 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lazy evaluation queue: 2 processing step(s)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Switch backend from MsBackendMzR to MsBackendDataFrame [Mon Nov 22 14:14:45 2021]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Remove fast fourier artefacts. [Mon Nov 20 14:33:57 2023]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Remove fast fourier artefacts. [Mon Nov 20 14:33:57 2023] </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">mz</span><span class="op">(</span><span class="va">fft_spectrum_filtered</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 297</span>
<span class="r-in"><span><span class="fu"><a href="spectra-plotting.html">plotSpectra</a></span><span class="op">(</span><span class="va">fft_spectrum_filtered</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">264.5</span>, <span class="fl">265.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5e6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="Spectra-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ---- DATA MANIPULATIONS AND OTHER OPERATIONS ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Set the data to be centroided</span></span></span>
<span class="r-in"><span><span class="fu">centroided</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Replace peak intensities below 40 with 3.</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="hidden_aliases.html">replaceIntensitiesBelow</a></span><span class="op">(</span><span class="va">data</span>, threshold <span class="op">=</span> <span class="fl">40</span>, value <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 2 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1       1.1        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         2       1.2        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 17 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lazy evaluation queue: 1 processing step(s)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Signal &lt;= 40 in MS level(s) 1, 2 set to 0 [Mon Nov 20 14:33:57 2023] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get the intensities of the first and second spectrum.</span></span></span>
<span class="r-in"><span><span class="fu">intensity</span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 200 400   3   3</span>
<span class="r-in"><span><span class="fu">intensity</span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3 3 3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Remove all peaks with an intensity below 40.</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">filterIntensity</span><span class="op">(</span><span class="va">res</span>, intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get the intensities of the first and second spectrum.</span></span></span>
<span class="r-in"><span><span class="fu">intensity</span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 200 400</span>
<span class="r-in"><span><span class="fu">intensity</span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> numeric(0)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Lengths of spectra is now different</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu">mz</span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2 0</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu">mz</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 4 3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## In addition it is possible to pass a function to `filterIntensity`: in</span></span></span>
<span class="r-in"><span><span class="co">## the example below we want to keep only peaks that have an intensity which</span></span></span>
<span class="r-in"><span><span class="co">## is larger than one third of the maximal peak intensity in that spectrum.</span></span></span>
<span class="r-in"><span><span class="va">keep_peaks</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">prop</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">x</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="va">prop</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu">filterIntensity</span><span class="op">(</span><span class="va">data</span>, intensity <span class="op">=</span> <span class="va">keep_peaks</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">intensity</span><span class="op">(</span><span class="va">res2</span><span class="op">)</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 200 400</span>
<span class="r-in"><span><span class="fu">intensity</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 200.0 400.0  34.2  17.0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## We can also change the proportion by simply passing the `prop` parameter</span></span></span>
<span class="r-in"><span><span class="co">## to the function. To keep only peaks that have an intensity which is</span></span></span>
<span class="r-in"><span><span class="co">## larger than half of the maximum intensity:</span></span></span>
<span class="r-in"><span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu">filterIntensity</span><span class="op">(</span><span class="va">data</span>, intensity <span class="op">=</span> <span class="va">keep_peaks</span>, prop <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">intensity</span><span class="op">(</span><span class="va">res2</span><span class="op">)</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intensity </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       400 </span>
<span class="r-in"><span><span class="fu">intensity</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 200.0 400.0  34.2  17.0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Since data manipulation operations are by default not directly applied to</span></span></span>
<span class="r-in"><span><span class="co">## the data but only added to the internal lazy evaluation queue, it is also</span></span></span>
<span class="r-in"><span><span class="co">## possible to remove these data manipulations with the `reset` function:</span></span></span>
<span class="r-in"><span><span class="va">res_rest</span> <span class="op">&lt;-</span> <span class="fu"><a href="hidden_aliases.html">reset</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_rest</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 2 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1       1.1        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         2       1.2        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 17 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Signal &lt;= 40 in MS level(s) 1, 2 set to 0 [Mon Nov 20 14:33:57 2023]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Remove peaks with intensities outside [40, Inf] in spectra of MS level(s) 1, 2. [Mon Nov 20 14:33:57 2023]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Reset object. [Mon Nov 20 14:33:57 2023] </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu">mz</span><span class="op">(</span><span class="va">res_rest</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 4 3</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu">mz</span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2 0</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu">mz</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 4 3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## `reset` after a `applyProcessing` can not restore the data, because the</span></span></span>
<span class="r-in"><span><span class="co">## data in the backend was changed. Similarly, `reset` after any filter</span></span></span>
<span class="r-in"><span><span class="co">## operations can not restore data for a `Spectra` with a</span></span></span>
<span class="r-in"><span><span class="co">## `MsBackendMemory` or `MsBackendDataFrame`.</span></span></span>
<span class="r-in"><span><span class="va">res_2</span> <span class="op">&lt;-</span> <span class="fu">applyProcessing</span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_rest</span> <span class="op">&lt;-</span> <span class="fu"><a href="hidden_aliases.html">reset</a></span><span class="op">(</span><span class="va">res_2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu">mz</span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2 0</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="fu">mz</span><span class="op">(</span><span class="va">res_rest</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Compare spectra: comparing spectra 2 and 3 against spectra 10:20 using</span></span></span>
<span class="r-in"><span><span class="co">## the normalized dotproduct method.</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">compareSpectra</span><span class="op">(</span><span class="va">sciex_im</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">sciex_im</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## first row contains comparisons of spectrum 2 with spectra 10 to 20 and</span></span></span>
<span class="r-in"><span><span class="co">## the second row comparisons of spectrum 3 with spectra 10 to 20</span></span></span>
<span class="r-in"><span><span class="va">res</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          10        11        12        13        14        15        16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.8583577 0.8603472 0.8588292 0.8434391 0.8581683 0.8515891 0.8568266</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.8620081 0.8609868 0.8604669 0.8481934 0.8637094 0.8586378 0.8618227</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          17        18        19        20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.8563933 0.8559511 0.8546560 0.8538058</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.8559523 0.8652169 0.8585325 0.8639445</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## To use a simple Pearson correlation instead we can define a function</span></span></span>
<span class="r-in"><span><span class="co">## that takes the two peak matrices and calculates the correlation for</span></span></span>
<span class="r-in"><span><span class="co">## their second columns (containing the intensity values).</span></span></span>
<span class="r-in"><span><span class="va">correlateSpectra</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">use</span> <span class="op">=</span> <span class="st">"pairwise.complete.obs"</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">y</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, use <span class="op">=</span> <span class="va">use</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">compareSpectra</span><span class="op">(</span><span class="va">sciex_im</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">sciex_im</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    FUN <span class="op">=</span> <span class="va">correlateSpectra</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          10        11        12        13        14        15        16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.9974395 0.9989580 0.9973735 0.9974334 0.9987225 0.9992307 0.9978621</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.9986971 0.9976861 0.9964951 0.9965942 0.9982105 0.9984607 0.9982808</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          17        18        19        20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.9950464 0.9987036 0.9988265 0.9970657</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.9921029 0.9990331 0.9975400 0.9955439</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Use compareSpectra to determine the number of common (matching) peaks</span></span></span>
<span class="r-in"><span><span class="co">## with a ppm of 10:</span></span></span>
<span class="r-in"><span><span class="co">## type = "inner" uses a *inner join* to match peaks, i.e. keeps only</span></span></span>
<span class="r-in"><span><span class="co">## peaks that can be mapped betwen both spectra. The provided FUN returns</span></span></span>
<span class="r-in"><span><span class="co">## simply the number of matching peaks.</span></span></span>
<span class="r-in"><span><span class="fu">compareSpectra</span><span class="op">(</span><span class="va">sciex_im</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="va">sciex_im</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>, ppm <span class="op">=</span> <span class="fl">10</span>, type <span class="op">=</span> <span class="st">"inner"</span>,</span></span>
<span class="r-in"><span>    FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10  11  12  13  14  15  16  17  18  19  20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 530 501 484 576 592 515 549 578 539 542 550</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 526 548 524 592 639 502 589 571 575 564 613</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Apply an arbitrary function to each spectrum in a Spectra.</span></span></span>
<span class="r-in"><span><span class="co">## In the example below we calculate the mean intensity for each spectrum</span></span></span>
<span class="r-in"><span><span class="co">## in a subset of the sciex_im data. Note that we can access all variables</span></span></span>
<span class="r-in"><span><span class="co">## of each individual spectrum either with the `$` operator or the</span></span></span>
<span class="r-in"><span><span class="co">## corresponding method.</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="hidden_aliases.html">spectrapply</a></span><span class="op">(</span><span class="va">sciex_im</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">intensity</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $`1`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1553.953</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $`2`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 678.2289</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $`3`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 684.3569</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $`4`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 682.1004</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $`5`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 780.6867</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $`6`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 737.5087</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## It is however important to note that dedicated methods to access the</span></span></span>
<span class="r-in"><span><span class="co">## data (such as `intensity`) are much more efficient than using `lapply`:</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu">intensity</span><span class="op">(</span><span class="va">sciex_im</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1553.953</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 678.2289</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[3]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 684.3569</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[4]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 682.1004</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[5]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 780.6867</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[6]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 737.5087</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## As an alternative, applying a function `FUN` to a `Spectra` can be</span></span></span>
<span class="r-in"><span><span class="co">## performed *chunk-wise*. The advantage of this is, that only the data for</span></span></span>
<span class="r-in"><span><span class="co">## one chunk at a time needs to be loaded into memory reducing the memory</span></span></span>
<span class="r-in"><span><span class="co">## demand. This type of processing can be performed by specifying the size</span></span></span>
<span class="r-in"><span><span class="co">## of the chunks (i.e. number of spectra per chunk) with the `chunkSize`</span></span></span>
<span class="r-in"><span><span class="co">## parameter</span></span></span>
<span class="r-in"><span><span class="fu"><a href="hidden_aliases.html">spectrapply</a></span><span class="op">(</span><span class="va">sciex_im</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span>, <span class="va">lengths</span>, chunkSize <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]  578 1529 1600 1664 1417 1602 1468 1440 1496 1431 1489 1349 1650 1697 1413</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16] 1593 1560 1477 1536 1491</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ---- DATA EXPORT ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Some `MsBackend` classes provide an `export` method to export the data to</span></span></span>
<span class="r-in"><span><span class="co">## the file format supported by the backend. The `MsBackendMzR` for example</span></span></span>
<span class="r-in"><span><span class="co">## allows to export MS data to mzML or mzXML file(s), the `MsBackendMgf`</span></span></span>
<span class="r-in"><span><span class="co">## (defined in the MsBackendMgf R package) would allow to export the data</span></span></span>
<span class="r-in"><span><span class="co">## in mgf file format. Below we export the MS data in `data`. We</span></span></span>
<span class="r-in"><span><span class="co">## call the `export` method on this object, specify the backend that should</span></span></span>
<span class="r-in"><span><span class="co">## be used to export the data (and which also defines the output format) and</span></span></span>
<span class="r-in"><span><span class="co">## provide a file name.</span></span></span>
<span class="r-in"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="hidden_aliases.html">export</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="MsBackend.html">MsBackendMzR</a></span><span class="op">(</span><span class="op">)</span>, file <span class="op">=</span> <span class="va">fl</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## This exported our data in mzML format. Below we read the first 6 lines</span></span></span>
<span class="r-in"><span><span class="co">## from that file.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">fl</span>, n <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;"                                                                                                                                                                                            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] "&lt;indexedmzML xmlns=\"http://psi.hupo.org/ms/mzml\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://psi.hupo.org/ms/mzml http://psidev.info/files/ms/mzML/xsd/mzML1.1.2_idx.xsd\"&gt;"                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3] "  &lt;mzML xmlns=\"http://psi.hupo.org/ms/mzml\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://psi.hupo.org/ms/mzml http://psidev.info/files/ms/mzML/xsd/mzML1.1.0.xsd\" id=\"\" version=\"1.1.0\"&gt;"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4] "    &lt;cvList count=\"2\"&gt;"                                                                                                                                                                                                              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5] "      &lt;cv id=\"MS\" fullName=\"Proteomics Standards Initiative Mass Spectrometry Ontology\" version=\"4.1.117\" URI=\"https://raw.githubusercontent.com/HUPO-PSI/psi-ms-CV/master/psi-ms.obo\"/&gt;"                                      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6] "      &lt;cv id=\"UO\" fullName=\"Unit Ontology\" version=\"09:04:2014\" URI=\"https://raw.githubusercontent.com/bio-ontology-research-group/unit-ontology/master/unit.obo\"/&gt;"                                                           </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## If only a single file name is provided, all spectra are exported to that</span></span></span>
<span class="r-in"><span><span class="co">## file. To export data with the `MsBackendMzR` backend to different files, a</span></span></span>
<span class="r-in"><span><span class="co">## file name for each individual spectrum has to be provided.</span></span></span>
<span class="r-in"><span><span class="co">## Below we export each spectrum to its own file.</span></span></span>
<span class="r-in"><span><span class="va">fls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="hidden_aliases.html">export</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="MsBackend.html">MsBackendMzR</a></span><span class="op">(</span><span class="op">)</span>, file <span class="op">=</span> <span class="va">fls</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Reading the data from the first file</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">Spectra</span><span class="op">(</span><span class="fu"><a href="MsBackend.html">backendInitialize</a></span><span class="op">(</span><span class="fu"><a href="MsBackend.html">MsBackendMzR</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">fls</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">mz</span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NumericList of length 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]] 100 103.2 104.3 106.5</span>
<span class="r-in"><span><span class="fu">mz</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NumericList of length 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]] 100 103.2 104.3 106.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]] 45.6 120.4 190.2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## ---- PEAKS VARIABLES AND DATA ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Some `MsBackend` classes provide support for arbitrary peaks variables</span></span></span>
<span class="r-in"><span><span class="co">## (in addition to the mandatory `"mz"` and `"intensity"` values. Below</span></span></span>
<span class="r-in"><span><span class="co">## we create a simple data frame with an additional peak variable `"pk_ann"`</span></span></span>
<span class="r-in"><span><span class="co">## and create a `Spectra` with a `MsBackendMemory` for that data.</span></span></span>
<span class="r-in"><span><span class="co">## Importantly the number of values (per spectrum) need to be the same</span></span></span>
<span class="r-in"><span><span class="co">## for all peak variables.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>msLevel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">2L</span><span class="op">)</span>, rtime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">123.2</span>, <span class="fl">123.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tmp</span><span class="op">$</span><span class="va">mz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">103.1</span>, <span class="fl">110.4</span>, <span class="fl">303.1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">343.2</span>, <span class="fl">453.1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tmp</span><span class="op">$</span><span class="va">intensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">130.1</span>, <span class="fl">543.1</span>, <span class="fl">40</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.45</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tmp</span><span class="op">$</span><span class="va">pk_ann</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA_character_</span>, <span class="st">"A"</span>, <span class="st">"P"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"P"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create the Spectra. With parameter `peaksVariables` we can define</span></span></span>
<span class="r-in"><span><span class="co">## the columns in `tmp` that contain peaks variables.</span></span></span>
<span class="r-in"><span><span class="va">sps</span> <span class="op">&lt;-</span> <span class="fu">Spectra</span><span class="op">(</span><span class="va">tmp</span>, source <span class="op">=</span> <span class="fu"><a href="MsBackend.html">MsBackendMemory</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    peaksVariables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mz"</span>, <span class="st">"intensity"</span>, <span class="st">"pk_ann"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="hidden_aliases.html">peaksVariables</a></span><span class="op">(</span><span class="va">sps</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "mz"        "intensity" "pk_ann"   </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Extract just the m/z and intensity values</span></span></span>
<span class="r-in"><span><span class="fu"><a href="hidden_aliases.html">peaksData</a></span><span class="op">(</span><span class="va">sps</span><span class="op">)</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mz intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 103.1     130.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 110.4     543.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 303.1      40.0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Extract the full peaks data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="hidden_aliases.html">peaksData</a></span><span class="op">(</span><span class="va">sps</span>, columns <span class="op">=</span> <span class="fu"><a href="hidden_aliases.html">peaksVariables</a></span><span class="op">(</span><span class="va">sps</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      mz intensity pk_ann</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 103.1     130.1   &lt;NA&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 110.4     543.1      A</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 303.1      40.0      P</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Access just the pk_ann variable</span></span></span>
<span class="r-in"><span><span class="va">sps</span><span class="op">$</span><span class="va">pk_ann</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] NA  "A" "P"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "B" "P"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by RforMassSpectrometry Package Maintainer, Laurent Gatto, Johannes Rainer, Sebastian Gibb.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer></div>

  

  

  </body></html>

