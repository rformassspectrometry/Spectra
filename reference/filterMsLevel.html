<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Filter and subset Spectra objects — deisotopeSpectra • Spectra</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filter and subset Spectra objects — deisotopeSpectra"><meta name="description" content="A variety of functions to filter or subset Spectra objects are available.
These can be generally separated into two main classes: I) classical
subset operations that immediately reduce the number of spectra in the
object and II) filters that reduce the content of the object without
changing its length (i.e. the number of spectra). The latter can be further
subdivided into functions that affect the content of the spectraData (i.e.
the general spectrum metadata) and those that reduce the content of the
object's peaksData (i.e. the m/z and intensity values of a spectrum's
mass peaks).
A description of functions from these 3 different categories are given below
in sections Subset Spectra, Filter content of spectraData() and
Filter content of peaksData(), respectively."><meta property="og:description" content="A variety of functions to filter or subset Spectra objects are available.
These can be generally separated into two main classes: I) classical
subset operations that immediately reduce the number of spectra in the
object and II) filters that reduce the content of the object without
changing its length (i.e. the number of spectra). The latter can be further
subdivided into functions that affect the content of the spectraData (i.e.
the general spectrum metadata) and those that reduce the content of the
object's peaksData (i.e. the m/z and intensity values of a spectrum's
mass peaks).
A description of functions from these 3 different categories are given below
in sections Subset Spectra, Filter content of spectraData() and
Filter content of peaksData(), respectively."><meta property="og:image" content="https://rformassspectrometry.github.io/Spectra/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Spectra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.17.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/Spectra.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/MsBackend.html">Creating new `MsBackend` classes</a></li>
    <li><a class="dropdown-item" href="../articles/Spectra-large-scale.html">Large-scale data handling and processing with Spectra</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/Spectra/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Filter and subset Spectra objects</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/Spectra/blob/main/R/Spectra-functions.R" class="external-link"><code>R/Spectra-functions.R</code></a>, <a href="https://github.com/RforMassSpectrometry/Spectra/blob/main/R/Spectra.R" class="external-link"><code>R/Spectra.R</code></a></small>
      <div class="d-none name"><code>filterMsLevel.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A variety of functions to filter or subset <code>Spectra</code> objects are available.
These can be generally separated into two main classes: I) <em>classical</em>
subset operations that immediately reduce the number of spectra in the
object and II) filters that reduce the <strong>content</strong> of the object without
changing its length (i.e. the number of spectra). The latter can be further
subdivided into functions that affect the content of the <code>spectraData</code> (i.e.
the general spectrum metadata) and those that reduce the content of the
object's <code>peaksData</code> (i.e. the m/z and intensity values of a spectrum's
mass peaks).</p>
<p>A description of functions from these 3 different categories are given below
in sections <em>Subset <code>Spectra</code></em>, <em>Filter content of <code><a href="spectraData.html">spectraData()</a></code></em> and
<em>Filter content of <code><a href="spectraData.html">peaksData()</a></code></em>, respectively.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">deisotopeSpectra</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  substDefinition <span class="op">=</span> <span class="fu">isotopicSubstitutionMatrix</span><span class="op">(</span><span class="st">"HMDB_NEUTRAL"</span><span class="op">)</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  ppm <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  charge <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">reduceSpectra</span><span class="op">(</span><span class="va">x</span>, tolerance <span class="op">=</span> <span class="fl">0</span>, ppm <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">filterPrecursorMaxIntensity</span><span class="op">(</span><span class="va">x</span>, tolerance <span class="op">=</span> <span class="fl">0</span>, ppm <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">filterPrecursorIsotopes</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  ppm <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  substDefinition <span class="op">=</span> <span class="fu">isotopicSubstitutionMatrix</span><span class="op">(</span><span class="st">"HMDB_NEUTRAL"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">filterPrecursorPeaks</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  ppm <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"=="</span>, <span class="st">"&gt;="</span><span class="op">)</span>,</span>
<span>  msLevel. <span class="op">=</span> <span class="fu"><a href="spectraData.html">uniqueMsLevels</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">dropNaSpectraVariables</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">selectSpectraVariables</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  spectraVariables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">union</a></span><span class="op">(</span><span class="fu"><a href="spectraData.html">spectraVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>, <span class="fu"><a href="spectraData.html">peaksVariables</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span>, <span class="va">...</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterAcquisitionNum</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  dataStorage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  dataOrigin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterEmptySpectra</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterDataOrigin</span><span class="op">(</span><span class="va">object</span>, dataOrigin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterDataStorage</span><span class="op">(</span><span class="va">object</span>, dataStorage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu"><a href="filterFourierTransformArtefacts.html">filterFourierTransformArtefacts</a></span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  halfWindowSize <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  threshold <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  keepIsotopes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  maxCharge <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  isotopeTolerance <span class="op">=</span> <span class="fl">0.005</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterIntensity</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>  msLevel. <span class="op">=</span> <span class="fu"><a href="spectraData.html">uniqueMsLevels</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterIsolationWindow</span><span class="op">(</span><span class="va">object</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterMsLevel</span><span class="op">(</span><span class="va">object</span>, msLevel. <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterMzRange</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  msLevel. <span class="op">=</span> <span class="fu"><a href="spectraData.html">uniqueMsLevels</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>,</span>
<span>  keep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterMzValues</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  ppm <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  msLevel. <span class="op">=</span> <span class="fu"><a href="spectraData.html">uniqueMsLevels</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>,</span>
<span>  keep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterPolarity</span><span class="op">(</span><span class="va">object</span>, polarity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterPrecursorMz</span><span class="op">(</span><span class="va">object</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterPrecursorMzRange</span><span class="op">(</span><span class="va">object</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterPrecursorMzValues</span><span class="op">(</span><span class="va">object</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>, ppm <span class="op">=</span> <span class="fl">20</span>, tolerance <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterPrecursorCharge</span><span class="op">(</span><span class="va">object</span>, z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterPrecursorScan</span><span class="op">(</span><span class="va">object</span>, acquisitionNum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>, f <span class="op">=</span> <span class="fu"><a href="spectraData.html">dataOrigin</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterRt</span><span class="op">(</span><span class="va">object</span>, rt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>, msLevel. <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterRanges</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  spectraVariables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  ranges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  match <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"any"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'Spectra'</span></span>
<span><span class="fu">filterValues</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  spectraVariables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  ppm <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  match <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"any"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p><code>Spectra</code> object.</p></dd>


<dt id="arg-substdefinition">substDefinition<a class="anchor" aria-label="anchor" href="#arg-substdefinition"></a></dt>
<dd><p>For <code>deisotopeSpectra()</code> and
<code>filterPrecursorIsotopes()</code>: <code>matrix</code> or <code>data.frame</code> with definitions
of isotopic substitutions. Uses by default isotopic substitutions
defined from all compounds in the Human Metabolome Database (HMDB). See
<code><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/isotopologues.html" class="external-link">MetaboCoreUtils::isotopologues()</a></code> or
<code><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/isotopicSubstitutionMatrix.html" class="external-link">MetaboCoreUtils::isotopicSubstitutionMatrix()</a></code> in the
<em>MetaboCoreUtils</em> for details.</p></dd>


<dt id="arg-tolerance">tolerance<a class="anchor" aria-label="anchor" href="#arg-tolerance"></a></dt>
<dd><p>For <code>filterMzValues()</code> and <code>reduceSpectra()</code>:
<code>numeric(1)</code> allowing to define a constant maximal accepted difference
between m/z values for peaks to be matched (or grouped). For
<code><a href="addProcessing.html">containsMz()</a></code> it can also be of length equal <code>mz</code> to specify a different
tolerance for each m/z value.
For <code>filterPrecursorMaxIntensity()</code>: <code>numeric(1)</code> defining the
(constant) maximal accepted difference of precursor m/z values of
spectra for grouping them into <em>precursor groups</em>. For
<code>filterPrecursorIsotopes()</code>: passed directly to the
<code><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/isotopologues.html" class="external-link">MetaboCoreUtils::isotopologues()</a></code>
function. For <code>filterValues()</code>: <code>numeric</code> of any length allowing to
define a maximal accepted difference between user input <code>values</code> and the
<code>spectraVariables</code> values. If it is not equal to the length of the
value provided with parameter <code>spectraVariables</code>, <code>tolerance[1]</code> will be
recycled. Default is <code>tolerance = 0</code>.</p></dd>


<dt id="arg-ppm">ppm<a class="anchor" aria-label="anchor" href="#arg-ppm"></a></dt>
<dd><p>For <code>filterMzValues()</code> and <code>reduceSpectra()</code>: <code>numeric(1)</code>
defining a relative, m/z-dependent, maximal accepted difference between
m/z values for peaks to be matched (or grouped).
For <code>filterPrecursorMaxIntensity()</code>: <code>numeric(1)</code> defining the relative
maximal accepted difference of precursor m/z values of spectra for
grouping them into <em>precursor groups</em>. For <code>filterPrecursorIsotopes()</code>:
passed directly to the <code><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/isotopologues.html" class="external-link">MetaboCoreUtils::isotopologues()</a></code> function.
For <code>filterValues()</code>: <code>numeric</code> of any length allowing to define
a maximal accepted difference between user input <code>values</code> and the
<code>spectraVariables</code> values. If it is not equal to the length of the
value provided with parameter <code>spectraVariables</code>, <code>ppm[1]</code> will be
recycled.</p></dd>


<dt id="arg-charge">charge<a class="anchor" aria-label="anchor" href="#arg-charge"></a></dt>
<dd><p>For <code>deisotopeSpectra()</code>: expected charge of the ionized
compounds. See <code><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/isotopologues.html" class="external-link">MetaboCoreUtils::isotopologues()</a></code> for details.</p></dd>


<dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p><code>Spectra</code> object.</p></dd>


<dt id="arg-mz">mz<a class="anchor" aria-label="anchor" href="#arg-mz"></a></dt>
<dd><p>For <code>filterIsolationWindow()</code>: <code>numeric(1)</code> with the m/z value to
filter the object. For <code>filterPrecursorMz()</code> and <code>filterMzRange()</code>:
<code>numeric(2)</code> defining the lower and upper m/z boundary.
For <code>filterMzValues()</code> and <code>filterPrecursorMzValues()</code>: <code>numeric</code> with
the m/z values to match peaks or precursor m/z against.
For <code>filterPrecursorPeaks()</code>: <code>character(1)</code> defining whether mass peaks
with an m/z matching the spectrum's precursor m/z (<code>mz = "=="</code>,
the default) or mass peaks with a m/z that is equal or larger
(<code>mz = "&gt;="</code>) should be removed.</p></dd>


<dt id="arg-mslevel-">msLevel.<a class="anchor" aria-label="anchor" href="#arg-mslevel-"></a></dt>
<dd><p><code>integer</code> defining the MS level(s) of the spectra to which
the function should be applied (defaults to all MS levels of <code>object</code>.
For <code>filterMsLevel()</code>: the MS level to which <code>object</code> should be
subsetted.</p></dd>


<dt id="arg-spectravariables">spectraVariables<a class="anchor" aria-label="anchor" href="#arg-spectravariables"></a></dt>
<dd><p>For <code>selectSpectraVariables()</code>: <code>character</code> with the
names of the spectra variables to which the backend should be
subsetted. For <code>filterRanges()</code> and <code>filterValues()</code>: <code>character</code>
vector specifying the column(s) from <code>spectraData(object)</code> on which
to filter the data and that correspond to the the names of the
spectra variables that should be used for the filtering.</p></dd>


<dt id="arg-i">i<a class="anchor" aria-label="anchor" href="#arg-i"></a></dt>
<dd><p>For <code>[</code>: <code>integer</code>, <code>logical</code> or <code>character</code> to subset the
object.</p></dd>


<dt id="arg-j">j<a class="anchor" aria-label="anchor" href="#arg-j"></a></dt>
<dd><p>For <code>[</code>: not supported.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments.</p></dd>


<dt id="arg-drop">drop<a class="anchor" aria-label="anchor" href="#arg-drop"></a></dt>
<dd><p>For <code>[</code>: not considered.</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>for <code>filterAcquisitionNum()</code>: <code>integer</code> with the acquisition
numbers to filter for.</p></dd>


<dt id="arg-datastorage">dataStorage<a class="anchor" aria-label="anchor" href="#arg-datastorage"></a></dt>
<dd><p>For <code>filterDataStorage()</code>: <code>character</code> to define which
spectra to keep.
For <code>filterAcquisitionNum()</code>: optionally specify if filtering should
occur only for spectra of selected <code>dataStorage</code>.</p></dd>


<dt id="arg-dataorigin">dataOrigin<a class="anchor" aria-label="anchor" href="#arg-dataorigin"></a></dt>
<dd><p>For <code>filterDataOrigin()</code>: <code>character</code> to define which
spectra to keep.
For <code>filterAcquisitionNum()</code>: optionally specify if filtering should
occurr only for spectra of selected <code>dataOrigin</code>.</p></dd>


<dt id="arg-halfwindowsize">halfWindowSize<a class="anchor" aria-label="anchor" href="#arg-halfwindowsize"></a></dt>
<dd><p>For <code><a href="filterFourierTransformArtefacts.html">filterFourierTransformArtefacts()</a></code>: <code>numeric(1)</code>
defining the m/z window left and right of a peak where to remove
fourier transform artefacts.</p></dd>


<dt id="arg-threshold">threshold<a class="anchor" aria-label="anchor" href="#arg-threshold"></a></dt>
<dd><p>For <code><a href="filterFourierTransformArtefacts.html">filterFourierTransformArtefacts()</a></code>: the relative
intensity (to a peak) below which peaks are considered fourier
artefacts. Defaults to <code>threshold = 0.2</code> hence removing peaks that
have an intensity below 0.2 times the intensity of the tested peak
(within the selected <code>halfWindowSize</code>).</p></dd>


<dt id="arg-keepisotopes">keepIsotopes<a class="anchor" aria-label="anchor" href="#arg-keepisotopes"></a></dt>
<dd><p>For <code><a href="filterFourierTransformArtefacts.html">filterFourierTransformArtefacts()</a></code>: whether isotope
peaks should not be removed as fourier artefacts.</p></dd>


<dt id="arg-maxcharge">maxCharge<a class="anchor" aria-label="anchor" href="#arg-maxcharge"></a></dt>
<dd><p>For <code><a href="filterFourierTransformArtefacts.html">filterFourierTransformArtefacts()</a></code>: the maximum charge
to be considered for isotopes.</p></dd>


<dt id="arg-isotopetolerance">isotopeTolerance<a class="anchor" aria-label="anchor" href="#arg-isotopetolerance"></a></dt>
<dd><p>For <code><a href="filterFourierTransformArtefacts.html">filterFourierTransformArtefacts()</a></code>: the m/z
<code>tolerance</code> to be used to define whether peaks might be isotopes of
the current tested peak.</p></dd>


<dt id="arg-intensity">intensity<a class="anchor" aria-label="anchor" href="#arg-intensity"></a></dt>
<dd><p>For <code>filterIntensity()</code>: <code>numeric</code> of length 1 or 2
defining either the lower or the lower and upper intensity limit for the
filtering, or a <code>function</code> that takes the intensities as input and
returns a <code>logical</code> (same length then peaks in the spectrum) whether the
peak should be retained or not. Defaults to <code>intensity = c(0, Inf)</code> thus
only peaks with <code>NA</code> intensity are removed.</p></dd>


<dt id="arg-keep">keep<a class="anchor" aria-label="anchor" href="#arg-keep"></a></dt>
<dd><p>For <code>filterMzValues()</code> and <code>filterMzRange()</code>: <code>logical(1)</code>
whether  the matching peaks should be retained (<code>keep = TRUE</code>, the
default) or dropped (<code>keep = FALSE</code>).</p></dd>


<dt id="arg-polarity">polarity<a class="anchor" aria-label="anchor" href="#arg-polarity"></a></dt>
<dd><p>for <code>filterPolarity()</code>: <code>integer</code> specifying the polarity to
to subset <code>object</code>.</p></dd>


<dt id="arg-z">z<a class="anchor" aria-label="anchor" href="#arg-z"></a></dt>
<dd><p>For <code>filterPrecursorCharge()</code>: <code><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer()</a></code> with the precursor
charges to be used as filter.</p></dd>


<dt id="arg-acquisitionnum">acquisitionNum<a class="anchor" aria-label="anchor" href="#arg-acquisitionnum"></a></dt>
<dd><p>for <code>filterPrecursorScan()</code>: <code>integer</code> with the
acquisition number of the spectra to which the object should be
subsetted.</p></dd>


<dt id="arg-f">f<a class="anchor" aria-label="anchor" href="#arg-f"></a></dt>
<dd><p>For <code>filterPrecursorScan()</code>: defining which spectra
belong to the same original data file (sample): Defaults to
<code>f = dataOrigin(x)</code>.</p></dd>


<dt id="arg-rt">rt<a class="anchor" aria-label="anchor" href="#arg-rt"></a></dt>
<dd><p>for <code>filterRt()</code>: <code>numeric(2)</code> defining the retention time range to
be used to subset/filter <code>object</code>.</p></dd>


<dt id="arg-ranges">ranges<a class="anchor" aria-label="anchor" href="#arg-ranges"></a></dt>
<dd><p>for <code>filterRanges()</code>: A <code>numeric</code> vector of paired values
(upper and lower boundary) that define the ranges to filter the <code>object</code>.
These paired values need to be in the same order as the
<code>spectraVariables</code> parameter (see below).</p></dd>


<dt id="arg-match">match<a class="anchor" aria-label="anchor" href="#arg-match"></a></dt>
<dd><p>For <code>filterRanges()</code> and <code>filterValues()</code>: <code>character(1) </code>
defining whether the condition has to match for all provided
<code>ranges</code>/<code>values</code> (<code>match = "all"</code>; the default), or for any of them
(<code>match = "any"</code>) for spectra to be retained.</p></dd>


<dt id="arg-values">values<a class="anchor" aria-label="anchor" href="#arg-values"></a></dt>
<dd><p>for <code>filterValues()</code>: A <code>numeric</code> vector that define the
values to filter the Spectra data. These values need to be in the same
order as the <code>spectraVariables</code> parameter.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="subset-spectra">Subset <code>Spectra</code><a class="anchor" aria-label="anchor" href="#subset-spectra"></a></h2>



<p>These functions affect the number of spectra in a <code>Spectra</code> object creating
a subset of the original object without affecting its content.</p><ul><li><p><code>[</code>: subsets the spectra keeping only selected elements (<code>i</code>). The method
<strong>always</strong> returns a <code>Spectra</code> object.</p></li>
<li><p><code>filterAcquisitionNum()</code>: filters the object keeping only spectra matching
the provided acquisition numbers (argument <code>n</code>). If <code>dataOrigin</code> or
<code>dataStorage</code> is also provided, <code>object</code> is subsetted to the spectra with
an acquisition number equal to <code>n</code> <strong>in spectra with matching dataOrigin
or dataStorage values</strong> retaining all other spectra.
Returns the filtered <code>Spectra</code>.</p></li>
<li><p><code>filterDataOrigin()</code>: filters the object retaining spectra matching the
provided <code>dataOrigin</code>. Parameter <code>dataOrigin</code> has to be of type
<code>character</code> and needs to match exactly the data origin value of the
spectra to subset.
Returns the filtered <code>Spectra</code> object (with spectra ordered according to
the provided <code>dataOrigin</code> parameter).</p></li>
<li><p><code>filterDataStorage()</code>: filters the object retaining spectra stored in the
specified <code>dataStorage</code>. Parameter <code>dataStorage</code> has to be of type
<code>character</code> and needs to match exactly the data storage value of the
spectra to subset.
Returns the filtered <code>Spectra</code> object (with spectra ordered according to
the provided <code>dataStorage</code> parameter).</p></li>
<li><p><code>filterEmptySpectra()</code>: removes empty spectra (i.e. spectra without peaks).
Returns the filtered <code>Spectra</code> object (with spectra in their
original order).</p></li>
<li><p><code>filterIsolationWindow()</code>: retains spectra that contain <code>mz</code> in their
isolation window m/z range (i.e. with an <code>isolationWindowLowerMz</code> &lt;= <code>mz</code>
and <code>isolationWindowUpperMz</code> &gt;= <code>mz</code>. Returns the filtered <code>Spectra</code>
object (with spectra in their original order).</p></li>
<li><p><code>filterMsLevel()</code>: filters object by MS level keeping only spectra matching
the MS level specified with argument <code>msLevel</code>. Returns the filtered
<code>Spectra</code> (with spectra in their original order).</p></li>
<li><p><code>filterPolarity()</code>: filters the object keeping only spectra matching the
provided polarity. Returns the filtered <code>Spectra</code> (with spectra in their
original order).</p></li>
<li><p><code>filterPrecursorCharge()</code>: retains spectra with the defined precursor
charge(s).</p></li>
<li><p><code>filterPrecursorIsotopes()</code>: groups MS2 spectra based on their precursor
m/z and precursor intensity into predicted isotope groups and keep for each
only the spectrum representing the monoisotopic precursor. MS1 spectra
are returned as is. See documentation for <code>deisotopeSpectra()</code> below for
details on isotope prediction and parameter description.</p></li>
<li><p><code>filterPrecursorMaxIntensity()</code>: filters the <code>Spectra</code> keeping for groups
of (MS2) spectra with similar precursor m/z values (given parameters
<code>ppm</code> and <code>tolerance</code>) the one with the highest precursor intensity. The
function filters only MS2 spectra and returns all MS1 spectra. If
precursor intensities are <code>NA</code> for all spectra within a spectra group, the
first spectrum of that groups is returned.
Note: some manufacturers don't provide precursor intensities. These can
however also be estimated with <code><a href="estimatePrecursorIntensity.html">estimatePrecursorIntensity()</a></code>.</p></li>
<li><p><code>filterPrecursorMzRange()</code> (previously <code>filterPrecursorMz()</code> which is now
deprecated): retains spectra with a precursor m/z within the
provided m/z range. See examples for details on selecting spectra with
a precursor m/z for a target m/z accepting a small difference in <em>ppm</em>.</p></li>
<li><p><code>filterPrecursorMzValues()</code>: retains spectra with precursor m/z matching
any of the provided m/z values (given <code>ppm</code> and <code>tolerance</code>). Spectra with
missing precursor m/z value (e.g. MS1 spectra) are dropped.</p></li>
<li><p><code>filterPrecursorScan()</code>: retains parent (e.g. MS1) and children scans (e.g.
MS2) of acquisition number <code>acquisitionNum</code>. Returns the filtered
<code>Spectra</code> (with spectra in their original order). Parameter <code>f</code> allows to
define which spectra belong to the same sample or original data file (
defaults to <code>f = dataOrigin(object)</code>).</p></li>
<li><p><code>filterRanges()</code>: allows filtering of the <code>Spectra</code> object based on user
defined <em>numeric</em> ranges (parameter <code>ranges</code>) for one or more available
spectra variables in object (spectra variable names can be specified with
parameter <code>spectraVariables</code>). Spectra for which the value of a spectra
variable is within it's defined range are retained. If multiple
ranges/spectra variables are defined, the <code>match</code> parameter can be used
to specify whether all conditions (<code>match = "all"</code>; the default) or if
any of the conditions must match (<code>match = "any"</code>; all spectra for which
values are within any of the provided ranges are retained).</p></li>
<li><p><code>filterRt()</code>: retains spectra of MS level <code>msLevel</code> with retention
times (in seconds) within (<code>&gt;=</code>) <code>rt[1]</code> and (<code>&lt;=</code>)
<code>rt[2]</code>. This retention time filter is applied to all spectra (regardless
of their MS level) if <code>msLevel. = integer()</code> (the default). Returns the
filtered <code>Spectra</code> (with spectra in their original order).</p></li>
<li><p><code>filterValues()</code>: allows filtering of the <code>Spectra</code> object based on
similarities of <em>numeric</em> values of one or more <code>spectraVariables(object)</code>
(parameter <code>spectraVariables</code>) to provided values (parameter <code>values</code>)
given acceptable differences (parameters tolerance and ppm). If multiple
values/spectra variables are defined, the <code>match</code> parameter can be used
to specify whether all conditions (<code>match = "all"</code>; the default) or if
any of the conditions must match (<code>match = "any"</code>; all spectra for which
values are within any of the provided ranges are retained).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="filter-content-of-spectradata-">Filter content of <code><a href="spectraData.html">spectraData()</a></code><a class="anchor" aria-label="anchor" href="#filter-content-of-spectradata-"></a></h2>



<p>The functions described in this section filter the content from a
<code>Spectra</code>'s spectra data, i.e. affect values of, or complete, spectra
variables. None of these functions reduces the object's number of spectra.</p><ul><li><p><code>dropNaSpectraVariables()</code>: removes spectra variables (i.e. columns in the
object's <code>spectraData</code> that contain only missing values (<code>NA</code>). Note that
while columns with only <code>NA</code>s are removed, a <code><a href="spectraData.html">spectraData()</a></code> call after
<code>dropNaSpectraVariables()</code> might still show columns containing <code>NA</code> values
for <em>core</em> spectra variables. The total number of spectra is not changed
by this function.</p></li>
<li><p><code>selectSpectraVariables()</code>: reduces the information within the object to
the selected spectra variables: all data for variables not specified will
be dropped. For mandatory columns (i.e., those listed by
<code><a href="spectraData.html">coreSpectraVariables()</a></code>, such as <em>msLevel</em>, <em>rtime</em> ...) only
the values will be dropped but not the variable itself. Additional (or
user defined) spectra variables will be completely removed.
Returns the filtered <code>Spectra</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="filter-content-of-peaksdata-">Filter content of <code><a href="spectraData.html">peaksData()</a></code><a class="anchor" aria-label="anchor" href="#filter-content-of-peaksdata-"></a></h2>



<p>The functions described in this section filter the content of the
<code>Spectra</code>'s peaks data, i.e. either the number or the values (<em>m/z</em> or
intensity values) of the mass peaks. Also, the actual operation is only
executed once peaks data is accessed (through <code><a href="spectraData.html">peaksData()</a></code>,
<code><a href="spectraData.html">mz()</a></code> or <code><a href="spectraData.html">intensity()</a></code>) or <code><a href="addProcessing.html">applyProcessing()</a></code> is called.
These operations don't affect the number of spectra in the <code>Spectra</code> object.</p><ul><li><p><code>deisotopeSpectra()</code>: <em>deisotopes</em> each spectrum keeping only the
monoisotopic peak for groups of isotopologues. Isotopologues are
estimated using the <code><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/isotopologues.html" class="external-link">MetaboCoreUtils::isotopologues()</a></code> function from the
<em>MetaboCoreUtils</em> package. Note that
the default parameters for isotope prediction/detection have been
determined using data from the Human Metabolome Database (HMDB) and
isotopes for elements other than CHNOPS might not be detected. See
parameter <code>substDefinition</code> in the documentation of
<code><a href="https://rdrr.io/pkg/MetaboCoreUtils/man/isotopologues.html" class="external-link">MetaboCoreUtils::isotopologues()</a></code> for
more information. The approach and code to define the parameters for
isotope prediction is described
<a href="https://github.com/EuracBiomedicalResearch/isotopologues" class="external-link">here</a>.</p></li>
<li><p><code><a href="filterFourierTransformArtefacts.html">filterFourierTransformArtefacts()</a></code>: removes (Orbitrap) fast fourier
artefact peaks from spectra (see examples below). The function iterates
through all intensity ordered peaks in a spectrum and removes all peaks
with an m/z within +/- <code>halfWindowSize</code> of the current peak if their
intensity is lower than <code>threshold</code> times the current peak's intensity.
Additional parameters <code>keepIsotopes</code>, <code>maxCharge</code> and <code>isotopeTolerance</code>
allow to avoid removing of potential <code>[13]C</code> isotope peaks (<code>maxCharge</code>
being the maximum charge that should be considered and <code>isotopeTolerance</code>
the absolute acceptable tolerance for matching their m/z).
See <code><a href="filterFourierTransformArtefacts.html">filterFourierTransformArtefacts()</a></code> for details and background and
<code>deisitopeSpectra()</code> for an alternative.</p></li>
<li><p><code>filterIntensity()</code>: filters mass peaks in each spectrum keeping only
those with intensities that are within the provided range or match the
criteria of the provided function. For the former, parameter <code>intensity</code>
has to be a <code>numeric</code> defining the intensity range, for the latter a
<code>function</code> that takes the intensity values of the spectrum and returns
a <code>logical</code> whether the peak should be retained or not (see examples
below for details) - additional parameters to the function can be passed
with <code>...</code>.
To remove only peaks with intensities below a certain threshold, say
100, use <code>intensity = c(100, Inf)</code>. Note: also a single value can be
passed with the <code>intensity</code> parameter in which case an upper limit of
<code>Inf</code> is used.
Note that this function removes also peaks with missing intensities
(i.e. an intensity of <code>NA</code>). Parameter <code>msLevel.</code> allows to restrict the
filtering to spectra of the specified MS level(s).</p></li>
<li><p><code>filterMzRange()</code>: filters mass peaks in the object keeping or removing
those in each spectrum that are within the provided m/z range. Whether
peaks are retained or removed can be configured with parameter <code>keep</code>
(default <code>keep = TRUE</code>).</p></li>
<li><p><code>filterMzValues()</code>: filters mass peaks in the object keeping all
peaks in each spectrum that match the provided m/z value(s) (for
<code>keep = TRUE</code>, the default) or removing all of them (for <code>keep = FALSE</code>).
The m/z matching considers also the absolute <code>tolerance</code> and m/z-relative
<code>ppm</code> values. <code>tolerance</code> and <code>ppm</code> have to be of length 1.</p></li>
<li><p><code><a href="filterPeaksRanges.html">filterPeaksRanges()</a></code>: filters mass peaks of a <code>Spectra</code> object using any
set of range-based filters on numeric spectra or peaks variables. See
<code><a href="filterPeaksRanges.html">filterPeaksRanges()</a></code> for more information.</p></li>
<li><p><code>filterPrecursorPeaks()</code>: removes peaks from each spectrum in <code>object</code> with
an m/z equal or larger than the m/z of the precursor, depending on the
value of parameter <code>mz</code>: for <code>mz = ==" (the default) peaks with matching m/z (considering an absolute and relative acceptable difference depending on </code>tolerance<code>and</code>ppm<code>, respectively) are removed. For </code>mz = "&gt;="<code>all peaks with an m/z larger or equal to the precursor m/z (minus</code>tolerance<code>and the</code>ppm<code>of the precursor m/z) are removed. Parameter</code>msLevel.<code>allows to restrict the filter to certain MS levels (by default the filter is applied to all MS levels). Note that no peaks are removed if the precursor m/z is</code>NA` (e.g. typically for MS1 spectra).</p></li>
<li><p><code>reduceSpectra()</code>: keeps for groups of peaks with similar m/z values in
(given <code>ppm</code> and <code>tolerance</code>) in each spectrum only the mass peak with the
highest intensity removing all other peaks hence <em>reducing</em> each
spectrum to the highest intensity peaks per <em>peak group</em>.
Peak groups are defined using the <code><a href="https://rdrr.io/r/grDevices/plotmath.html" class="external-link">group()</a></code> function from the
<em>MsCoreUtils</em> package. See also the <code><a href="combinePeaks.html">combinePeaks()</a></code> function for an
alternative function to combine peaks within each spectrum.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p><code><a href="combineSpectra.html">combineSpectra()</a></code> for functions to combine or aggregate <code>Spectra</code>.</p></li>
<li><p><code><a href="combinePeaks.html">combinePeaks()</a></code> for functions to combine or aggregate a <code>Spectra</code>'s
<code><a href="spectraData.html">peaksData()</a></code></p></li>
</ul></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sebastian Gibb, Johannes Rainer, Laurent Gatto, Philippine Louail, Nir Shahaf</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Load a `Spectra` object with LC-MS/MS data.</span></span></span>
<span class="r-in"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"TripleTOF-SWATH"</span>, <span class="st">"PestMix1_DDA.mzML"</span>,</span></span>
<span class="r-in"><span>    package <span class="op">=</span> <span class="st">"msdata"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sps_dda</span> <span class="op">&lt;-</span> <span class="fu"><a href="Spectra.html">Spectra</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sps_dda</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 7602 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            1     0.231         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            1     0.351         2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            1     0.471         3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            1     0.591         4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            1     0.711         5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...        ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7598         1   899.491      7598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7599         1   899.613      7599</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7600         1   899.747      7600</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7601         1   899.872      7601</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7602         1   899.993      7602</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##  --------  SUBSET SPECTRA  --------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Subset to the first 3 spectra</span></span></span>
<span class="r-in"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">sps_dda</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">tmp</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 3 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1     0.231         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         1     0.351         2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         1     0.471         3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Subset to all MS2 spectra; this could be done with [, or, more</span></span></span>
<span class="r-in"><span><span class="co">## efficiently, with the `filterMsLevel` function:</span></span></span>
<span class="r-in"><span><span class="va">sps_dda</span><span class="op">[</span><span class="fu"><a href="spectraData.html">msLevel</a></span><span class="op">(</span><span class="va">sps_dda</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2L</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 2975 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            2     7.216        58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            2    13.146       106</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            2    13.556       108</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            2    23.085       186</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            2    25.055       201</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...        ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2971         2   895.472      7570</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2972         2   895.592      7571</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2973         2   896.252      7575</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2974         2   896.662      7577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2975         2   898.602      7591</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-in"><span><span class="fu">filterMsLevel</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="fl">2L</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 2975 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            2     7.216        58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            2    13.146       106</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            2    13.556       108</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            2    23.085       186</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            2    25.055       201</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...        ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2971         2   895.472      7570</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2972         2   895.592      7571</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2973         2   896.252      7575</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2974         2   896.662      7577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2975         2   898.602      7591</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select MS level(s) 2 [Mon Apr  7 11:32:18 2025] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Filter the object keeping only MS2 spectra with an precursor m/z value</span></span></span>
<span class="r-in"><span><span class="co">## between a specified range:</span></span></span>
<span class="r-in"><span><span class="fu">filterPrecursorMzRange</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">90</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 138 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           2    13.556       108</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           2    36.494       290</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           2    41.684       329</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           2    42.333       334</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           2    43.273       340</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...       ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 134         2   879.043      7451</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 135         2   884.043      7489</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 136         2   884.103      7490</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 137         2   889.513      7528</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 138         2   892.542      7551</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select spectra with a precursor m/z within [80, 90] [Mon Apr  7 11:32:18 2025] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Filter the object to MS2 spectra with an precursor m/z matching a</span></span></span>
<span class="r-in"><span><span class="co">## pre-defined value (given ppm and tolerance)</span></span></span>
<span class="r-in"><span><span class="fu">filterPrecursorMzValues</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="fl">85</span>, ppm <span class="op">=</span> <span class="fl">5</span>, tolerance <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 14 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           2   428.076      3664</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           2   513.070      4648</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           2   601.733      5307</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           2   620.762      5455</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           2   632.691      5542</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...       ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10          2   746.243      6390</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11          2   788.320      6695</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12          2   821.767      6939</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13          2   838.156      7056</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14          2   844.176      7105</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select spectra with precursor m/z matching 85 [Mon Apr  7 11:32:18 2025] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The `filterRanges()` function allows to filter a `Spectra` based on</span></span></span>
<span class="r-in"><span><span class="co">## numerical ranges of any of its (numerical) spectra variables.</span></span></span>
<span class="r-in"><span><span class="co">## First, determine the variable(s) on which to base the filtering:</span></span></span>
<span class="r-in"><span><span class="va">sv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"precursorMz"</span>, <span class="st">"peaksCount"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Note that ANY variables can be chosen here, and as many as wanted.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Define the ranges (pairs of values with lower and upper boundary) to be</span></span></span>
<span class="r-in"><span><span class="co">## used for the individual spectra variables. The first two values will be</span></span></span>
<span class="r-in"><span><span class="co">## used for the first spectra variable (e.g., `"rtime"` here), the next two</span></span></span>
<span class="r-in"><span><span class="co">## for the second (e.g. `"precursorMz"` here) and so on:</span></span></span>
<span class="r-in"><span><span class="va">ranges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">350</span>, <span class="fl">200</span>, <span class="fl">500</span>, <span class="fl">350</span>, <span class="fl">600</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Input the parameters within the filterRanges function:</span></span></span>
<span class="r-in"><span><span class="va">filt_spectra</span> <span class="op">&lt;-</span> <span class="fu">filterRanges</span><span class="op">(</span><span class="va">sps_dda</span>, spectraVariables <span class="op">=</span> <span class="va">sv</span>,</span></span>
<span class="r-in"><span>                ranges <span class="op">=</span> <span class="va">ranges</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">filt_spectra</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 3 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         2   237.460      1810</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         2   343.322      2601</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         2   346.872      2629</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select spectra with a rtime within: [30, 350] [Mon Apr  7 11:32:18 2025]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select spectra with a precursorMz within: [200, 500] [Mon Apr  7 11:32:18 2025]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select spectra with a peaksCount within: [350, 600] [Mon Apr  7 11:32:18 2025] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## `filterRanges()` can also be used to filter a `Spectra` object with</span></span></span>
<span class="r-in"><span><span class="co">## multiple ranges for the same `spectraVariable` (e.g, here `"rtime"`)</span></span></span>
<span class="r-in"><span><span class="va">sv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"rtime"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ranges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">300</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">filt_spectra</span> <span class="op">&lt;-</span> <span class="fu">filterRanges</span><span class="op">(</span><span class="va">sps_dda</span>, spectraVariables <span class="op">=</span> <span class="va">sv</span>,</span></span>
<span class="r-in"><span>                ranges <span class="op">=</span> <span class="va">ranges</span>, match <span class="op">=</span> <span class="st">"any"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">filt_spectra</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 1252 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1            1    30.050       241</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            2    30.314       242</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3            1    30.452       243</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4            1    30.601       244</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5            1    30.721       245</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ...        ...       ...       ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1248         1   299.176      2266</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1249         1   299.304      2267</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1250         2   299.575      2268</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1251         1   299.713      2269</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1252         2   299.985      2270</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select spectra with a rtime within: [30, 100] [Mon Apr  7 11:32:18 2025]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select spectra with a rtime within: [200, 300] [Mon Apr  7 11:32:18 2025] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## While `filterRanges()` filtered on numeric ranges, `filterValues()`</span></span></span>
<span class="r-in"><span><span class="co">## allows to filter an object matching spectra variable values to user</span></span></span>
<span class="r-in"><span><span class="co">## provided values (allowing to configure allowed differences using the</span></span></span>
<span class="r-in"><span><span class="co">## `ppm` and `tolerance` parameters).</span></span></span>
<span class="r-in"><span><span class="co">## First determine the variable(s) on which to base the filtering:</span></span></span>
<span class="r-in"><span><span class="va">sv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rtime"</span>, <span class="st">"precursorMz"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Note that ANY variables can be chosen here, and as many as wanted.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Define the values that will be used to filter the spectra based on their</span></span></span>
<span class="r-in"><span><span class="co">## similarities to their respective `spectraVariables`.</span></span></span>
<span class="r-in"><span><span class="co">## The first values in the parameters values, tolerance and ppm will be</span></span></span>
<span class="r-in"><span><span class="co">## used for the first spectra variable (e.g. `"rtime"` here), the next for</span></span></span>
<span class="r-in"><span><span class="co">## the second (e.g. `"precursorMz"` here) and so on:</span></span></span>
<span class="r-in"><span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">350</span>, <span class="fl">80</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tolerance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ppm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Input the parameters within the `filterValues()` function:</span></span></span>
<span class="r-in"><span><span class="va">filt_spectra</span> <span class="op">&lt;-</span> <span class="fu">filterValues</span><span class="op">(</span><span class="va">sps_dda</span>, spectraVariables <span class="op">=</span> <span class="va">sv</span>,</span></span>
<span class="r-in"><span>                values <span class="op">=</span> <span class="va">values</span>, tolerance <span class="op">=</span> <span class="va">tolerance</span>, ppm <span class="op">=</span> <span class="va">ppm</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">filt_spectra</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 1 spectra in a MsBackendMzR backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         2   427.546      3657</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 34 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> file(s):</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PestMix1_DDA.mzML</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select spectra with a rtime similar to: 350 [Mon Apr  7 11:32:18 2025]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Filter: select spectra with a precursorMz similar to: 80 [Mon Apr  7 11:32:18 2025] </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##  --------  FILTER SPECTRA DATA  --------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Remove spectra variables without content (i.e. with only missing values)</span></span></span>
<span class="r-in"><span><span class="va">sps_noNA</span> <span class="op">&lt;-</span> <span class="fu">dropNaSpectraVariables</span><span class="op">(</span><span class="va">sps_dda</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## This reduced the size of the object slightly</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">sps_dda</span><span class="op">)</span>, unit <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2.3 Mb</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">sps_noNA</span><span class="op">)</span>, unit <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Mb</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## With the `selectSpectraVariables()` function it is in addition possible</span></span></span>
<span class="r-in"><span><span class="co">## to subset the data of a `Spectra` to the selected columns/variables,</span></span></span>
<span class="r-in"><span><span class="co">## keeping only their data:</span></span></span>
<span class="r-in"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">selectSpectraVariables</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"msLevel"</span>, <span class="st">"mz"</span>, <span class="st">"intensity"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"scanIndex"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html" class="external-link">object.size</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span>, units <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.1 Mb</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Except the selected variables, all data is now removed. Accessing</span></span></span>
<span class="r-in"><span><span class="co">## core spectra variables still works, but returns only NA</span></span></span>
<span class="r-in"><span><span class="fu"><a href="spectraData.html">rtime</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] NA NA NA NA NA NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##  --------  FILTER PEAKS DATA  --------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## `filterMzValues()` filters the mass peaks data of a `Spectra` retaining</span></span></span>
<span class="r-in"><span><span class="co">## only those mass peaks with an m/z value matching the provided value(s).</span></span></span>
<span class="r-in"><span><span class="va">sps_sub</span> <span class="op">&lt;-</span> <span class="fu">filterMzValues</span><span class="op">(</span><span class="va">sps_dda</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">103</span>, <span class="fl">104</span><span class="op">)</span>, tolerance <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The filtered `Spectra` has the same length</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sps_dda</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 7602</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sps_sub</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 7602</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## But the number of mass peaks changed</span></span></span>
<span class="r-in"><span><span class="fu"><a href="spectraData.html">lengths</a></span><span class="op">(</span><span class="va">sps_dda</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 223 211 227 210 220 228</span>
<span class="r-in"><span><span class="fu"><a href="spectraData.html">lengths</a></span><span class="op">(</span><span class="va">sps_sub</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2 2 1 2 2 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## This function can also be used to remove specific peaks from a spectrum</span></span></span>
<span class="r-in"><span><span class="co">## by setting `keep = FALSE`.</span></span></span>
<span class="r-in"><span><span class="va">sps_sub</span> <span class="op">&lt;-</span> <span class="fu">filterMzValues</span><span class="op">(</span><span class="va">sps_dda</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">103</span>, <span class="fl">104</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    tolerance <span class="op">=</span> <span class="fl">0.3</span>, keep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="spectraData.html">lengths</a></span><span class="op">(</span><span class="va">sps_sub</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 221 209 226 208 218 226</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## With the `filterMzRange()` function it is possible to keep (or remove)</span></span></span>
<span class="r-in"><span><span class="co">## mass peaks with m/z values within a specified numeric range.</span></span></span>
<span class="r-in"><span><span class="va">sps_sub</span> <span class="op">&lt;-</span> <span class="fu">filterMzRange</span><span class="op">(</span><span class="va">sps_dda</span>, mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="spectraData.html">lengths</a></span><span class="op">(</span><span class="va">sps_sub</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 54 55 52 59 60 52</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## See also the `filterPeaksRanges()` function for a more flexible framework</span></span></span>
<span class="r-in"><span><span class="co">## to filter mass peaks</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Removing fourier transform artefacts seen in Orbitra data.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Loading an Orbitrap spectrum with artefacts.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">fft_spectrum</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="spectra-plotting.html">plotSpectra</a></span><span class="op">(</span><span class="va">fft_spectrum</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">264.5</span>, <span class="fl">265.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="filterMsLevel-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="spectra-plotting.html">plotSpectra</a></span><span class="op">(</span><span class="va">fft_spectrum</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">264.5</span>, <span class="fl">265.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5e6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="filterMsLevel-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fft_spectrum</span> <span class="op">&lt;-</span> <span class="fu"><a href="filterFourierTransformArtefacts.html">filterFourierTransformArtefacts</a></span><span class="op">(</span><span class="va">fft_spectrum</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fft_spectrum</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 1 spectra in a MsBackendDataFrame backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1   367.665       195</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 33 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lazy evaluation queue: 1 processing step(s)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Switch backend from MsBackendMzR to MsBackendDataFrame [Mon Nov 22 14:14:45 2021]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Remove fast fourier artefacts. [Mon Apr  7 11:32:21 2025] </span>
<span class="r-in"><span><span class="fu"><a href="spectra-plotting.html">plotSpectra</a></span><span class="op">(</span><span class="va">fft_spectrum</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">264.5</span>, <span class="fl">265.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5e6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="filterMsLevel-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Using a few examples peaks in your data you can optimize the parameters</span></span></span>
<span class="r-in"><span><span class="va">fft_spectrum_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="filterFourierTransformArtefacts.html">filterFourierTransformArtefacts</a></span><span class="op">(</span><span class="va">fft_spectrum</span>,</span></span>
<span class="r-in"><span>                                               halfWindowSize <span class="op">=</span> <span class="fl">0.2</span>,</span></span>
<span class="r-in"><span>                                               threshold <span class="op">=</span> <span class="fl">0.005</span>,</span></span>
<span class="r-in"><span>                                               keepIsotopes <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                                               maxCharge <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>                                               isotopeTolerance <span class="op">=</span> <span class="fl">0.005</span></span></span>
<span class="r-in"><span>                                               <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fft_spectrum_filtered</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 1 spectra in a MsBackendDataFrame backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         1   367.665       195</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 33 more variables/columns.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Lazy evaluation queue: 2 processing step(s)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Processing:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Switch backend from MsBackendMzR to MsBackendDataFrame [Mon Nov 22 14:14:45 2021]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Remove fast fourier artefacts. [Mon Apr  7 11:32:21 2025]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Remove fast fourier artefacts. [Mon Apr  7 11:32:21 2025] </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="spectraData.html">mz</a></span><span class="op">(</span><span class="va">fft_spectrum_filtered</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 297</span>
<span class="r-in"><span><span class="fu"><a href="spectra-plotting.html">plotSpectra</a></span><span class="op">(</span><span class="va">fft_spectrum_filtered</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">264.5</span>, <span class="fl">265.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5e6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="filterMsLevel-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## *Reducing* a `Spectra` keeping for groups of mass peaks (characterized</span></span></span>
<span class="r-in"><span><span class="co">## by similarity of their m/z values) only one representative peak. This</span></span></span>
<span class="r-in"><span><span class="co">## function helps cleaning fragment spectra.</span></span></span>
<span class="r-in"><span><span class="co">## Filter the data set to MS2 spectra</span></span></span>
<span class="r-in"><span><span class="va">ms2</span> <span class="op">&lt;-</span> <span class="fu">filterMsLevel</span><span class="op">(</span><span class="va">sps_dda</span>, <span class="fl">2L</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## For groups of fragment peaks with a difference in m/z &lt; 0.1, keep only</span></span></span>
<span class="r-in"><span><span class="co">## the largest one.</span></span></span>
<span class="r-in"><span><span class="va">ms2_red</span> <span class="op">&lt;-</span> <span class="fu">reduceSpectra</span><span class="op">(</span><span class="va">ms2</span>, ppm <span class="op">=</span> <span class="fl">0</span>, tolerance <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="spectraData.html">lengths</a></span><span class="op">(</span><span class="va">ms2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 23  3  1 35  2  7</span>
<span class="r-in"><span><span class="fu"><a href="spectraData.html">lengths</a></span><span class="op">(</span><span class="va">ms2_red</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 19  2  1 27  1  7</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by RforMassSpectrometry Package Maintainer, Laurent Gatto, Johannes Rainer, Sebastian Gibb, Philippine Louail.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

