<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="These functions map peaks from two spectra with each other if the difference
between their m/z values is smaller than defined with parameters tolerance
and ppm. All functions take two matrices
joinPeaks: maps peaks from two spectra allowing to specify the type of
join that should be performed: type = &quot;outer&quot; each peak in x will be
matched with each peak in y, for peaks that do not match any peak in the
other spectra an NA intensity is returned. With type = &quot;left&quot; all peaks
from the left spectrum (x) will be matched with peaks in y. Peaks in
y that do not match any peak in x are omitted. type = &quot;right&quot; is the
same as type = &quot;left&quot; only for y. Only peaks that can be matched
between x and y are returned by type = &quot;inner&quot;, i.e. only
peaks present in both spectra are reported.
joinPeaksGnps matches/maps peaks between spectra with the same approach
used in GNPS: peaks are considered matching if a) the
difference in their m/z values is smaller than defined by tolerance
and ppm (this is the same as joinPeaks) and b) the difference of
their m/z adjusted for the difference of the spectras' precursor is
smaller than defined by tolerance and ppm. Based on this definition,
peaks in x can match up to two peaks in y hence peaks in the returned
matrices might be reported multiple times. Note that if one of
xPrecursorMz or yPrecursorMz are NA or if both are the same, the
results are the same as with joinPeaks(). To calculate GNPS similarity
scores, gnps() should be called on the aligned peak matrices (i.e.
compareSpectra should be called with MAPFUN = joinPeaksGnps and
FUN = MsCoreUtils::gnps).

"><title>Join (map) peaks of two spectra — joinPeaks • Spectra</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Join (map) peaks of two spectra — joinPeaks"><meta property="og:description" content="These functions map peaks from two spectra with each other if the difference
between their m/z values is smaller than defined with parameters tolerance
and ppm. All functions take two matrices
joinPeaks: maps peaks from two spectra allowing to specify the type of
join that should be performed: type = &quot;outer&quot; each peak in x will be
matched with each peak in y, for peaks that do not match any peak in the
other spectra an NA intensity is returned. With type = &quot;left&quot; all peaks
from the left spectrum (x) will be matched with peaks in y. Peaks in
y that do not match any peak in x are omitted. type = &quot;right&quot; is the
same as type = &quot;left&quot; only for y. Only peaks that can be matched
between x and y are returned by type = &quot;inner&quot;, i.e. only
peaks present in both spectra are reported.
joinPeaksGnps matches/maps peaks between spectra with the same approach
used in GNPS: peaks are considered matching if a) the
difference in their m/z values is smaller than defined by tolerance
and ppm (this is the same as joinPeaks) and b) the difference of
their m/z adjusted for the difference of the spectras' precursor is
smaller than defined by tolerance and ppm. Based on this definition,
peaks in x can match up to two peaks in y hence peaks in the returned
matrices might be reported multiple times. Note that if one of
xPrecursorMz or yPrecursorMz are NA or if both are the same, the
results are the same as with joinPeaks(). To calculate GNPS similarity
scores, gnps() should be called on the aligned peak matrices (i.e.
compareSpectra should be called with MAPFUN = joinPeaksGnps and
FUN = MsCoreUtils::gnps).

"><meta property="og:image" content="https://rformassspectrometry.github.io/Spectra/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Spectra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/Spectra.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/Spectra/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Join (map) peaks of two spectra</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/Spectra/blob/HEAD/R/peaks-functions.R" class="external-link"><code>R/peaks-functions.R</code></a></small>
      <div class="d-none name"><code>joinPeaks.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>These functions map peaks from two spectra with each other if the difference
between their m/z values is smaller than defined with parameters <code>tolerance</code>
and <code>ppm</code>. All functions take two matrices</p><ul><li><p><code>joinPeaks</code>: maps peaks from two spectra allowing to specify the type of
<em>join</em> that should be performed: <code>type = "outer"</code> each peak in <code>x</code> will be
matched with each peak in <code>y</code>, for peaks that do not match any peak in the
other spectra an <code>NA</code> intensity is returned. With <code>type = "left"</code> all peaks
from the left spectrum (<code>x</code>) will be matched with peaks in <code>y</code>. Peaks in
<code>y</code> that do not match any peak in <code>x</code> are omitted. <code>type = "right"</code> is the
same as <code>type = "left"</code> only for <code>y</code>. Only peaks that can be matched
between <code>x</code> and <code>y</code> are returned by <code>type = "inner"</code>, i.e. only
peaks present in both spectra are reported.</p></li>
<li><p><code>joinPeaksGnps</code> matches/maps peaks between spectra with the same approach
used in GNPS: peaks are considered matching if a) the
difference in their m/z values is smaller than defined by <code>tolerance</code>
and <code>ppm</code> (this is the same as <code>joinPeaks</code>) <strong>and</strong> b) the difference of
their m/z <em>adjusted</em> for the difference of the spectras' precursor is
smaller than defined by <code>tolerance</code> and <code>ppm</code>. Based on this definition,
peaks in <code>x</code> can match up to two peaks in <code>y</code> hence peaks in the returned
matrices might be reported multiple times. Note that if one of
<code>xPrecursorMz</code> or <code>yPrecursorMz</code> are <code>NA</code> or if both are the same, the
results are the same as with <code>joinPeaks()</code>. To calculate GNPS similarity
scores, <code>gnps()</code> should be called on the aligned peak matrices (i.e.
<code>compareSpectra</code> should be called with <code>MAPFUN = joinPeaksGnps</code> and
<code>FUN = MsCoreUtils::gnps</code>).</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">joinPeaks</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, type <span class="op">=</span> <span class="st">"outer"</span>, tolerance <span class="op">=</span> <span class="fl">0</span>, ppm <span class="op">=</span> <span class="fl">10</span>, <span class="va">...</span><span class="op">)</span>

<span class="fu">joinPeaksGnps</span><span class="op">(</span>
  <span class="va">x</span>,
  <span class="va">y</span>,
  xPrecursorMz <span class="op">=</span> <span class="cn">NA_real_</span>,
  yPrecursorMz <span class="op">=</span> <span class="cn">NA_real_</span>,
  tolerance <span class="op">=</span> <span class="fl">0</span>,
  ppm <span class="op">=</span> <span class="fl">0</span>,
  type <span class="op">=</span> <span class="st">"outer"</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p><code>matrix</code> with two columns <code>"mz"</code> and <code>"intensity"</code> containing the
m/z and intensity values of the mass peaks of a spectrum.</p></dd>


<dt>y</dt>
<dd><p><code>matrix</code> with two columns <code>"mz"</code> and <code>"intensity"</code> containing the
m/z and intensity values of the mass peaks of a spectrum.</p></dd>


<dt>type</dt>
<dd><p>For <code>joinPeaks</code> and <code>joinPeaksGnps</code>: <code>character(1)</code> specifying
the type of join that should be performed. See function description for
details.</p></dd>


<dt>tolerance</dt>
<dd><p><code>numeric(1)</code> defining a constant maximal accepted difference
between m/z values of peaks from the two spectra to be matched/mapped.</p></dd>


<dt>ppm</dt>
<dd><p><code>numeric(1)</code> defining a relative, m/z-dependent, maximal accepted
difference between m/z values of peaks from the two spectra to be
matched/mapped.</p></dd>


<dt>...</dt>
<dd><p>optional parameters passed to the <code><a href="https://rdrr.io/pkg/MsCoreUtils/man/matching.html" class="external-link">MsCoreUtils::join()</a></code> function.</p></dd>


<dt>xPrecursorMz</dt>
<dd><p>for <code>joinPeaksGnps</code>: <code>numeric(1)</code> with the precursor m/z
of the spectrum <code>x</code>.</p></dd>


<dt>yPrecursorMz</dt>
<dd><p>for <code>joinPeaksGnps</code>: <code>numeric(1)</code> with the precursor m/z
of the spectrum <code>y</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>All functions return a <code>list</code> of elements <code>"x"</code> and <code>"y"</code> each being a two
column matrix with m/z (first column) and intensity values (second column).
The two matrices contain the matched peaks between input matrices <code>x</code> and <code>y</code></p>


<p>and hence have the same number of rows. Peaks present in <code>x</code> but not in the
<code>y</code> input matrix have m/z and intensity values of <code>NA</code> in the result matrix
for <code>y</code> (and <em>vice versa</em>).</p>
    </div>
    <div class="section level2">
    <h2 id="implementation-notes">Implementation notes<a class="anchor" aria-label="anchor" href="#implementation-notes"></a></h2>
    


<p>A mapping function must take two numeric matrices <code>x</code> and <code>y</code> as input and
must return <code>list</code> with two elements named <code>"x"</code> and <code>"y"</code> that represent
the aligned input matrices. The function should also have <code>...</code> in its
definition. Parameters <code>ppm</code> and <code>tolerance</code> are suggested but not required.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code>gnps()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Johannes Rainer, Michael Witting</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">31.34</span>, <span class="fl">50.14</span>, <span class="fl">60.3</span>, <span class="fl">120.9</span>, <span class="fl">230</span>, <span class="fl">514.13</span>, <span class="fl">874.1</span><span class="op">)</span>,</span>
<span class="r-in">    <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span></span>
<span class="r-in"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">31.35</span>, <span class="fl">70.3</span>, <span class="fl">120.9</span> <span class="op">+</span> <span class="fu"><a href="hidden_aliases.html">ppm</a></span><span class="op">(</span><span class="fl">120.9</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span class="r-in">    <span class="fl">230</span> <span class="op">+</span> <span class="fu"><a href="hidden_aliases.html">ppm</a></span><span class="op">(</span><span class="fl">230</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">315</span>, <span class="fl">514.14</span>, <span class="fl">901</span>, <span class="fl">1202</span><span class="op">)</span>,</span>
<span class="r-in">    <span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## No peaks with identical m/z</span></span>
<span class="r-in"><span class="fu">joinPeaks</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, ppm <span class="op">=</span> <span class="fl">0</span>, type <span class="op">=</span> <span class="st">"inner"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## With ppm 10 two peaks are overlapping</span></span>
<span class="r-in"><span class="fu">joinPeaks</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, ppm <span class="op">=</span> <span class="fl">10</span>, type <span class="op">=</span> <span class="st">"inner"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 120.9    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 230.0    5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 120.9006    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 230.0023    5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Outer join: contain all peaks from x and y</span></span>
<span class="r-in"><span class="fu">joinPeaks</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, ppm <span class="op">=</span> <span class="fl">10</span>, type <span class="op">=</span> <span class="st">"outer"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,]     NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,]  31.34    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,]     NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,]  50.14    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,]  60.30    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,]     NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,] 120.90    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,] 230.00    5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,]     NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,] 514.13    6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11,]     NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [12,] 874.10    7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13,]     NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [14,]     NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,]   12.0000    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,]        NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,]   31.3500    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,]        NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,]        NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,]   70.3000    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,]  120.9006    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,]  230.0023    5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,]  315.0000    6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,]        NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11,]  514.1400    7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [12,]        NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13,]  901.0000    8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [14,] 1202.0000    9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Left join: keep all peaks from x and those from y that match</span></span>
<span class="r-in"><span class="fu">joinPeaks</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, ppm <span class="op">=</span> <span class="fl">10</span>, type <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  31.34    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  50.14    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]  60.30    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] 120.90    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,] 230.00    5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,] 514.13    6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7,] 874.10    7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]       NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]       NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]       NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] 120.9006    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,] 230.0023    5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,]       NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7,]       NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Right join: keep all peaks from y and those from x that match. Using</span></span>
<span class="r-in"><span class="co">## a constant tolerance of 0.01</span></span>
<span class="r-in"><span class="fu">joinPeaks</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, tolerance <span class="op">=</span> <span class="fl">0.01</span>, type <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,]     NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,]  31.34    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,]     NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,] 120.90    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,] 230.00    5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,]     NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,] 514.13    6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,]     NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,]     NA   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            [,1] [,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,]   12.0000    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,]   31.3500    2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,]   70.3000    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,]  120.9006    4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,]  230.0023    5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,]  315.0000    6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,]  514.1400    7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,]  901.0000    8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,] 1202.0000    9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## GNPS-like peak matching</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Define spectra</span></span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">36</span>, <span class="fl">63</span>, <span class="fl">91</span>, <span class="fl">93</span><span class="op">)</span>, intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>, <span class="fl">15</span>, <span class="fl">999</span>, <span class="fl">650</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">12</span>, <span class="fl">50</span>, <span class="fl">63</span>, <span class="fl">105</span><span class="op">)</span>, intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">5</span>, <span class="fl">16</span>, <span class="fl">999</span>, <span class="fl">450</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="co">## The precursor m/z</span></span>
<span class="r-in"><span class="va">pmz_x</span> <span class="op">&lt;-</span> <span class="fl">91</span></span>
<span class="r-in"><span class="va">pmz_y</span> <span class="op">&lt;-</span> <span class="fl">105</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Plain joinPeaks identifies only 2 matching peaks: 1 and 5</span></span>
<span class="r-in"><span class="fu">joinPeaks</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      mz intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 10        14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 36        15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,] 63       999</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,] 91       650</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7,] 93         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [8,] NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       mz intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  10        35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  12         5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]  NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]  50        16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,]  63       999</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,]  NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7,]  NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [8,] 105       450</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## joinPeaksGnps finds 4 matches</span></span>
<span class="r-in"><span class="fu">joinPeaksGnps</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">pmz_x</span>, <span class="va">pmz_y</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       mz intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,] 10        14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,] 36        15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,] 36        15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,] 63       999</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,] 91       650</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,] 91       650</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,] 93         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,] NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,] NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,] NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        mz intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,]  10        35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,]  NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,]  50        16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,]  63       999</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,]  NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,] 105       450</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,]  NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,]  12         5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,]  50        16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,] 105       450</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## with one of the two precursor m/z being NA, the result are the same as</span></span>
<span class="r-in"><span class="co">## with joinPeaks (with type = "left").</span></span>
<span class="r-in"><span class="fu">joinPeaksGnps</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">pmz_x</span>, yPrecursorMz <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      mz intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 10        14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 36        15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,] 63       999</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,] 91       650</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7,] 93         1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [8,] NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       mz intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  10        35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  12         5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]  NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]  50        16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,]  63       999</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,]  NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7,]  NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [8,] 105       450</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by RforMassSpectrometry Package Maintainer, Laurent Gatto, Johannes Rainer, Sebastian Gibb.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.9000.</p>
</div>

    </footer></div>

  

  

  </body></html>

