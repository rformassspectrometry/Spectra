<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='combinePeaksData aggregates provided peak matrices into a single peak
matrix. Peaks are grouped by their m/z values with the group() function
from the MsCoreUtils package. In brief, all peaks in all provided
spectra are first ordered by their m/z and consecutively grouped into one
group if the (pairwise) difference between them is smaller than specified
with parameter tolerance and ppm (see group() for grouping details
and examples).
The m/z and intensity values for the resulting peak matrix are calculated
using the mzFun and intensityFun on the grouped m/z and intensity values.
Note that only the grouped m/z and intensity values are used in the
aggregation functions (mzFun and intensityFun) but not the number of
spectra.
The function supports also different strategies for peak combinations which
can be specified with the peaks parameter:
peaks = "union" (default): report all peaks from all input spectra.
peaks = "intersect": keep only peaks in the resulting peak matrix that
are present in &amp;gt;= minProp proportion of input spectra. This would
generate a consensus or representative spectra from a set of e.g.
fragment spectra measured from the same precursor ion.


As a special case it is possible to report only peaks in the resulting
matrix from peak groups that contain a peak from one of the input spectra,
which can be specified with parameter main. Thus, if e.g. main = 2 is
specified, only (grouped) peaks that have a peak in the second input matrix
are returned.
Setting timeDomain to TRUE causes grouping to be performed on the square
root of the m/z values (assuming a TOF instrument was used to create the
data).'><title>Combine peaks with similar m/z across spectra — combinePeaksData • Spectra</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Combine peaks with similar m/z across spectra — combinePeaksData"><meta property="og:description" content='combinePeaksData aggregates provided peak matrices into a single peak
matrix. Peaks are grouped by their m/z values with the group() function
from the MsCoreUtils package. In brief, all peaks in all provided
spectra are first ordered by their m/z and consecutively grouped into one
group if the (pairwise) difference between them is smaller than specified
with parameter tolerance and ppm (see group() for grouping details
and examples).
The m/z and intensity values for the resulting peak matrix are calculated
using the mzFun and intensityFun on the grouped m/z and intensity values.
Note that only the grouped m/z and intensity values are used in the
aggregation functions (mzFun and intensityFun) but not the number of
spectra.
The function supports also different strategies for peak combinations which
can be specified with the peaks parameter:
peaks = "union" (default): report all peaks from all input spectra.
peaks = "intersect": keep only peaks in the resulting peak matrix that
are present in &amp;gt;= minProp proportion of input spectra. This would
generate a consensus or representative spectra from a set of e.g.
fragment spectra measured from the same precursor ion.


As a special case it is possible to report only peaks in the resulting
matrix from peak groups that contain a peak from one of the input spectra,
which can be specified with parameter main. Thus, if e.g. main = 2 is
specified, only (grouped) peaks that have a peak in the second input matrix
are returned.
Setting timeDomain to TRUE causes grouping to be performed on the square
root of the m/z values (assuming a TOF instrument was used to create the
data).'><meta property="og:image" content="https://rformassspectrometry.github.io/Spectra/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Spectra</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.11.10</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/Spectra.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/MsBackend.html">Creating new `MsBackend` classes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/Spectra/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Combine peaks with similar m/z across spectra</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/Spectra/blob/HEAD/R/peak-list-functions.R" class="external-link"><code>R/peak-list-functions.R</code></a></small>
      <div class="d-none name"><code>combinePeaksData.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>combinePeaksData</code> aggregates provided peak matrices into a single peak
matrix. Peaks are grouped by their m/z values with the <code>group()</code> function
from the <code>MsCoreUtils</code> package. In brief, all peaks in all provided
spectra are first ordered by their m/z and consecutively grouped into one
group if the (pairwise) difference between them is smaller than specified
with parameter <code>tolerance</code> and <code>ppm</code> (see <code><a href="https://rdrr.io/r/grDevices/plotmath.html" class="external-link">group()</a></code> for grouping details
and examples).</p>
<p>The m/z and intensity values for the resulting peak matrix are calculated
using the <code>mzFun</code> and <code>intensityFun</code> on the grouped m/z and intensity values.</p>
<p>Note that only the grouped m/z and intensity values are used in the
aggregation functions (<code>mzFun</code> and <code>intensityFun</code>) but not the number of
spectra.</p>
<p>The function supports also different strategies for peak combinations which
can be specified with the <code>peaks</code> parameter:</p><ul><li><p><code>peaks = "union"</code> (default): report all peaks from all input spectra.</p></li>
<li><p><code>peaks = "intersect"</code>: keep only peaks in the resulting peak matrix that
are present in <code>&gt;= minProp</code> proportion of input spectra. This would
generate a <em>consensus</em> or <em>representative</em> spectra from a set of e.g.
fragment spectra measured from the same precursor ion.</p></li>
</ul><p>As a special case it is possible to report only peaks in the resulting
matrix from peak groups that contain a peak from one of the input spectra,
which can be specified with parameter <code>main</code>. Thus, if e.g. <code>main = 2</code> is
specified, only (grouped) peaks that have a peak in the second input matrix
are returned.</p>
<p>Setting <code>timeDomain</code> to <code>TRUE</code> causes grouping to be performed on the square
root of the m/z values (assuming a TOF instrument was used to create the
data).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">combinePeaksData</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  intensityFun <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span>,</span>
<span>  mzFun <span class="op">=</span> <span class="fu">base</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span>,</span>
<span>  weighted <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  ppm <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  timeDomain <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  peaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"union"</span>, <span class="st">"intersect"</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  minProp <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p><code>list</code> of peak matrices.</p></dd>


<dt>intensityFun</dt>
<dd><p><code>function</code> to be used to combine intensity values for
matching peaks. By default the mean intensity value is returned.</p></dd>


<dt>mzFun</dt>
<dd><p><code>function</code> to be used to combine m/z values for matching peaks.
By default the mean m/z value is returned.</p></dd>


<dt>weighted</dt>
<dd><p><code>logical(1)</code> defining whether m/z values for matching peaks
should be calculated by an intensity-weighted average of the individuak
m/z values. This overrides parameter <code>mzFun</code>.</p></dd>


<dt>tolerance</dt>
<dd><p><code>numeric(1)</code> defining the (absolute) maximal accepted
difference between mass peaks to group them into the same final peak.</p></dd>


<dt>ppm</dt>
<dd><p><code>numeric(1)</code> defining the m/z-relative maximal accepted
difference between mass peaks (expressed in parts-per-million) to group
them into the same final peak.</p></dd>


<dt>timeDomain</dt>
<dd><p><code>logical(1)</code> whether grouping of mass peaks is performed
on the m/z values (<code>timeDomain = FALSE</code>) or on <code>sqrt(mz)</code>
(<code>timeDomain = TRUE</code>).</p></dd>


<dt>peaks</dt>
<dd><p><code>character(1)</code> specifying how peaks should be combined. Can be
either <code>"peaks = "union"</code> (default) or <code>peaks = "intersect"</code>. See
function description for details.</p></dd>


<dt>main</dt>
<dd><p>optional <code>integer(1)</code> to force the resulting peak list to
contain only peaks that are present in the specified input spectrum. See
description for details.</p></dd>


<dt>minProp</dt>
<dd><p><code>numeric(1)</code> for `peaks = "intersect": the minimal required
proportion of input spectra (peak matrices) a mass peak has to be
present to be included in the consensus peak matrix.</p></dd>


<dt>...</dt>
<dd><p>additional parameters to the <code>mzFun</code> and <code>intensityFun</code> functions.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Peaks <code>matrix</code> with m/z and intensity values representing the aggregated
values across the provided peak matrices.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For general merging of spectra, the <code>tolerance</code> and/or <code>ppm</code> should be
manually specified based on the precision of the MS instrument. Peaks
from spectra with a difference in their m/z being smaller than <code>tolerance</code>
or smaller than <code>ppm</code> of their m/z are grouped into the same final peak.</p>
<p>Some details for the combination of consecutive spectra of an LC-MS run:</p>
<p>The m/z values of the same ion in consecutive scans (spectra) of a LC-MS run
will not be identical. Assuming that this random variation is much smaller
than the resolution of the MS instrument (i.e. the difference between
m/z values within each single spectrum), m/z value groups are defined
across the spectra and those containing m/z values of the <code>main</code> spectrum
are retained.
Intensities and m/z values falling within each of these m/z groups are
aggregated using the <code>intensityFun</code> and <code>mzFun</code>, respectively. It is
highly likely that all QTOF profile data is collected with a timing circuit
that collects data points with regular intervals of time that are then later
converted into m/z values based on the relationship <code>t = k * sqrt(m/z)</code>. The
m/z scale is thus non-linear and the m/z scattering (which is in fact caused
by small variations in the time circuit) will thus be different in the lower
and upper m/z scale. m/z-intensity pairs from consecutive scans to be
combined are therefore defined by default on the square root of the m/z
values. With <code>timeDomain = FALSE</code>, the actual m/z values will be used.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Johannes Rainer</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mzs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">20</span>, <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ints1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mzs</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ints1</span><span class="op">[</span><span class="fl">11</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">30</span>, <span class="fl">90</span>, <span class="fl">200</span>, <span class="fl">500</span>, <span class="fl">300</span>, <span class="fl">100</span>, <span class="fl">70</span>, <span class="fl">40</span>, <span class="fl">20</span><span class="op">)</span> <span class="co"># add peak</span></span></span>
<span class="r-in"><span><span class="va">ints2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mzs</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ints2</span><span class="op">[</span><span class="fl">11</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">30</span>, <span class="fl">60</span>, <span class="fl">120</span>, <span class="fl">300</span>, <span class="fl">200</span>, <span class="fl">90</span>, <span class="fl">60</span>, <span class="fl">30</span>, <span class="fl">23</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ints3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mzs</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ints3</span><span class="op">[</span><span class="fl">11</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>, <span class="fl">20</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">100</span>, <span class="fl">80</span>, <span class="fl">40</span>, <span class="fl">30</span>, <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create the peaks matrices</span></span></span>
<span class="r-in"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>mz <span class="op">=</span> <span class="va">mzs</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mzs</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    intensity <span class="op">=</span> <span class="va">ints1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>mz <span class="op">=</span> <span class="va">mzs</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mzs</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    intensity <span class="op">=</span> <span class="va">ints2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>mz <span class="op">=</span> <span class="va">mzs</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mzs</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.009</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    intensity <span class="op">=</span> <span class="va">ints3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Combine the spectra. With `tolerance = 0` and `ppm = 0` only peaks with</span></span></span>
<span class="r-in"><span><span class="co">## **identical** m/z are combined. The result will be a single spectrum</span></span></span>
<span class="r-in"><span><span class="co">## containing the *union* of mass peaks from the individual input spectra.</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">combinePeaksData</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Plot the spectra before and after combining</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.3</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p1</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">p1</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mzs</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"h"</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">p2</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">p2</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"h"</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">p3</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">p3</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"h"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">p</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mzs</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"h"</span>,</span></span>
<span class="r-in"><span>    col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="combinePeaksData-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">## The peaks were not merged, because their m/z differs too much.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Combine spectra with `tolerance = 0.05`. This will merge all triplets.</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">combinePeaksData</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span>, tolerance <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Plot the spectra before and after combining</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.3</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p1</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">p1</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mzs</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"h"</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">p2</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">p2</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"h"</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">p3</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">p3</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"h"</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">p</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mzs</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"h"</span>,</span></span>
<span class="r-in"><span>    col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="combinePeaksData-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## With `intensityFun = max` the maximal intensity per peak is reported.</span></span></span>
<span class="r-in"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">combinePeaksData</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span>, tolerance <span class="op">=</span> <span class="fl">0.05</span>,</span></span>
<span class="r-in"><span>    intensityFun <span class="op">=</span> <span class="va">max</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create *consensus*/representative spectrum from a set of spectra</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">45</span>, <span class="fl">64</span>, <span class="fl">70</span><span class="op">)</span>, intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17</span>, <span class="fl">45.1</span>, <span class="fl">63.9</span>, <span class="fl">70.2</span><span class="op">)</span>, intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">11</span>, <span class="fl">21</span>, <span class="fl">31</span>, <span class="fl">41</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>mz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12.1</span>, <span class="fl">44.9</span>, <span class="fl">63</span><span class="op">)</span>, intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">22</span>, <span class="fl">32</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## No mass peaks identical thus consensus peaks are empty</span></span></span>
<span class="r-in"><span><span class="fu">combinePeaksData</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span>, peaks <span class="op">=</span> <span class="st">"intersect"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      mz intensity</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Reducing the minProp to 0.2. The consensus spectrum will contain all</span></span></span>
<span class="r-in"><span><span class="co">## peaks</span></span></span>
<span class="r-in"><span><span class="fu">combinePeaksData</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span>, peaks <span class="op">=</span> <span class="st">"intersect"</span>, minProp <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mz intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,] 12.0        10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,] 12.1        12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,] 17.0        11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,] 44.9        22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,] 45.0        20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,] 45.1        21</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,] 63.0        32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,] 63.9        31</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,] 64.0        30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,] 70.0        40</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11,] 70.2        41</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## With a tolerance of 0.1 mass peaks can be matched across spectra</span></span></span>
<span class="r-in"><span><span class="fu">combinePeaksData</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span>, peaks <span class="op">=</span> <span class="st">"intersect"</span>, tolerance <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         mz intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 12.05      11.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 45.00      21.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 63.95      30.5</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Report the minimal m/z and intensity</span></span></span>
<span class="r-in"><span><span class="fu">combinePeaksData</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span><span class="op">)</span>, peaks <span class="op">=</span> <span class="st">"intersect"</span>, tolerance <span class="op">=</span> <span class="fl">0.1</span>,</span></span>
<span class="r-in"><span>    intensityFun <span class="op">=</span> <span class="va">min</span>, mzFun <span class="op">=</span> <span class="va">min</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        mz intensity</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 12.0        10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 44.9        20</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 63.9        30</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by RforMassSpectrometry Package Maintainer, Laurent Gatto, Johannes Rainer, Sebastian Gibb.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer></div>

  

  

  </body></html>

